# CLAUDE.md - AI開発チームのルールとガイドライン

## 目的
このファイルは、AI開発チーム（Kenji、Yuki、Takashi）が効率的に協働するためのルールとガイドラインを記載します。

## 基本原則

### 1. コミュニケーションの原則
- **質問を恐れない**: 不明点があれば必ず質問する
- **より良い提案を積極的に**: 指示内容より良いやり方があるときは必ず提案する
- **チーム全体で意見交換**: 重要な決定は独断せず、チームで議論してより良いゴールを目指す

### 2. 開発の原則
- **動くものを優先**: 完璧を求めすぎず、まず動くものを作る
- **段階的な改善**: MVP（最小限の製品）から始めて、徐々に改善する
- **テストの重要性**: 実装したら必ずテストする

### 3. ドキュメント管理
- **作業ログの記録**: 重要な作業は`/docs/worklog/`に記録
- **進捗の共有**: 各自の進捗は`report_[名前].md`に記載
- **コミュニケーション**: チーム間の連絡は`to_[名前].md`ファイルを使用

## コミュニケーションファイル
- `temp.md` - 一時的なメモ
- `to_all.md` - チーム全体への連絡
- `to_kenji.md` - Kenjiへの連絡
- `to_yuki.md` - Yukiへの連絡
- `to_takashi.md` - Takashiへの連絡
- `report_kenji.md` - Kenjiからの報告
- `report_yuki.md` - Yukiからの報告
- `report_takashi.md` - Takashiからの報告

## 技術的なルール

### 作業ログのルール
- **保存場所**: `/docs/worklog/YYYY/MM/` ディレクトリに保存
  - 例: `/docs/worklog/2025/08/2025-08-11-shopify-api-cleanup.md`
- **ファイル名形式**: `YYYY-MM-DD-作業内容の簡潔な説明.md`
  - YYYY-MM-DDは日付（例：2025-08-11）
  - 作業内容は英語のkebab-caseで記載
- **記録タイミング**: 重要な作業完了時には必ず作業ログを作成

### コーディング規約
- **コメントは最小限**: コードは自己文書化を心がける
- **既存のパターンに従う**: 新しいコードは既存のコード規約に合わせる
- **セキュリティ重視**: APIキーやパスワードは絶対にハードコードしない

### Git運用
- **こまめなコミット**: 機能単位でコミット
- **わかりやすいコミットメッセージ**: 何を変更したか明確に記載
- **ブランチ戦略**: develop → staging → main の流れを守る

### 環境変数
- **環境別の設定**: development、staging、productionで設定を分ける
- **秘密情報の管理**: Azure Key Vaultや環境変数を使用
- **ドキュメント化**: 必要な環境変数は必ずドキュメントに記載

## プロジェクト固有のルール

### Shopifyアプリ開発
- **OAuth認証**: Shopifyの標準的なOAuthフローに従う
- **Webhook**: GDPR関連のWebhookは必須実装
- **マルチテナント**: ストアごとのデータ分離を確実に行う

### Azure環境
- **リソース管理**: 不要なリソースは削除してコストを抑える
- **監視**: Application Insightsでエラーを監視
- **セキュリティ**: Managed Identityを活用

## アーキテクチャ決定記録（ADR）

### ADRとは
Architecture Decision Records（ADR）は、重要な技術的決定を記録し、なぜその決定をしたのかを文書化するための仕組みです。

### なぜADRを使うのか
- **決定の経緯を記録**: なぜその技術を選んだのか、他の選択肢は何だったのかを記録
- **新メンバーの理解促進**: 後から参加したメンバーも過去の決定理由を理解できる
- **同じ議論の繰り返しを防ぐ**: 一度決定したことを再度議論することを防ぐ
- **決定の見直し**: 状況が変わった時に、過去の前提条件を確認できる

### ADRの保存場所
- `/docs/adr/`フォルダに保存
- ファイル名は`ADR-XXX-タイトル.md`の形式（XXXは3桁の連番）
- テンプレートは`ADR-000-template.md`を参照

### ADRを書くタイミング
- 重要な技術選定を行うとき
- アーキテクチャの大きな変更を行うとき
- 複数の選択肢から一つを選ぶ必要があるとき

## データベースマイグレーション管理

### 重要：マイグレーション実行時の必須ルール
データベースの変更を行う際は、以下のルールを必ず守ってください。

#### 1. マイグレーションスクリプトの作成
- ファイル名: `YYYY-MM-DD-説明.sql`（例：2025-08-05-AddInitialSetupFeature.sql）
- 保存場所: `/docs/04-development/database-migrations/`
- スクリプト内に以下のコメントを必ず記載：
  ```sql
  -- 作成日: YYYY-MM-DD
  -- 作成者: 名前
  -- 目的: 変更の目的
  -- 影響: 影響範囲の説明
  ```

#### 2. マイグレーション管理ドキュメントの更新
**必須**: マイグレーションを作成または実行したら、即座に `/docs/04-development/database-migration-tracking.md` を更新する

更新内容：
- スクリプト名
- 作成日
- 作成者
- 変更内容の説明
- 各環境（Development/Staging/Production）への適用状況
- 適用日時を記録（例：✅ 適用済 (2025-08-05 10:00)）

#### 3. マイグレーションが必要なケース
- 新しいテーブルの追加
- 既存テーブルへのカラム追加・削除
- インデックスの追加・削除
- データ型の変更
- 制約（外部キー、ユニーク制約など）の追加・削除

### なぜこのルールが重要か
1. **トレーサビリティ**: いつ、誰が、何を変更したかを追跡できる
2. **環境間の整合性**: 各環境のデータベース状態を正確に把握できる
3. **トラブルシューティング**: 問題発生時に原因を特定しやすい
4. **チーム連携**: 他のメンバーが変更内容を把握できる

## 更新履歴
- 2025-08-01: 初版作成
- 2025-08-02: ADRセクション追加
- 2025-08-05: データベースマイグレーション管理セクション追加