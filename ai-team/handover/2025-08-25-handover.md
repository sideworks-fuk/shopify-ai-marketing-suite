# 2025年8月25日 引継ぎ資料

## 作成者: Eris (AI開発サポート)
## 作成日時: 2025年8月25日 10:00
## 対象: 次回作業担当者

---

## 1. プロジェクト現状サマリー

### 1.1 全体進捗
- **フェーズ**: Development（申請準備段階）
- **課金システム**: バックエンド95%、フロントエンド90%完成
- **主要3機能**: 実装85%完成（AIマーケティング、メールキャンペーン、在庫管理）
- **Shopifyアプリ申請**: 2025年9月2日予定（当初8月8日から遅延）

### 1.2 本日の修正作業
- ✅ SQLマイグレーションエラー修正完了
- ✅ フロントエンド課金ページエラー修正完了
- ✅ 無料プラン機能制限テスト手順書作成完了

---

## 2. 残作業リスト（優先順位順）

### 2.1 【最優先】データベースマイグレーション実行
**担当推奨**: Takashi
**期限**: 2025年8月26日

#### 実行すべきマイグレーション（順序厳守）
1. `2025-08-13-AddWebhookEventsTable.sql`
2. `2025-08-24-CreateBillingTables.sql`
3. `2025-08-24-AddFeatureSelectionTables.sql`
4. `2025-08-24-AddGDPRTables.sql`
5. `2025-08-25-FIX-AddIdempotencyKeyToWebhookEvents.sql`
6. `2025-08-25-FIX2-free-plan-feature-selection.sql`
7. `2025-08-25-FIX-sp_GetCurrentFeatureSelection.sql`

**注意事項**:
- Development環境から順に適用
- 各スクリプト実行後、エラーがないことを確認
- `/docs/04-development/03-データベース/マイグレーション/database-migration-tracking.md`を即座に更新

### 2.2 【必須】GDPR Webhook実装
**担当推奨**: Takashi
**期限**: 2025年8月28日

#### 実装が必要なWebhook
1. `/api/webhook/customers/redact` - 顧客データ削除要求
2. `/api/webhook/customers/data_request` - 顧客データ開示要求
3. `/api/webhook/shop/redact` - ショップデータ削除要求
4. `/api/webhook/app/uninstalled` - アプリアンインストール処理

**実装ポイント**:
- HMAC署名検証の実装（既存のWebhookControllerを参考）
- IdempotencyKeyによる重複処理防止
- GDPRComplianceRequestsテーブルへの記録

### 2.3 【重要】無料プラン機能制限の統合テスト
**担当推奨**: Yuki + Takashi
**期限**: 2025年8月29日

#### テスト項目
1. 機能選択UIの動作確認
2. 月1回の変更制限確認
3. 選択外機能のアクセス制限確認
4. プランアップグレード後の全機能解放確認

**テストに使用するファイル**:
- `/docs/06-shopify/02-課金システム/05-無料プラン機能制限/無料プラン機能制限テスト手順書.md`

### 2.4 【申請準備】Shopifyアプリストア申請素材
**担当推奨**: Yuki + 浜地様
**期限**: 2025年8月30日

#### 必要な素材
1. **アプリアイコン**: 1024x1024px PNG
2. **スクリーンショット**: 最低5枚（1280x800px）
   - ダッシュボード画面
   - AIマーケティング分析画面
   - メールキャンペーン画面
   - 在庫管理画面
   - 設定/課金画面
3. **アプリ説明文**: 日本語・英語各500文字
4. **プライバシーポリシー**: URL必須
5. **利用規約**: URL必須

---

## 3. 技術的な注意事項

### 3.1 データベース関連

#### Stores vs Store テーブル名の不整合
**現状**: 
- コード内では`Store`テーブルを参照
- 一部のドキュメントで`Stores`と記載

**対応方針**:
- 実際のテーブル名は`Store`で統一
- 新規作成時は必ず`Store`を使用

#### マイグレーション実行時の注意
```sql
-- 必ず実行前にバックアップ
BACKUP DATABASE [ShopifyAnalytics] TO DISK = 'C:\Backup\ShopifyAnalytics_20250826.bak'

-- トランザクション内で実行
BEGIN TRANSACTION
-- マイグレーションスクリプト実行
-- エラーがない場合のみCOMMIT
COMMIT TRANSACTION
```

### 3.2 フロントエンド関連

#### SubscriptionProvider配置箇所
以下のページで必須：
- `/app/settings/billing/page.tsx` ✅ 修正済み
- `/app/dashboard/page.tsx` ⚠️ 要確認
- 各機能ページ（機能制限チェックが必要な箇所）

#### useFeatureAccessフック使用方法
```typescript
const { hasAccess, isLoading } = useFeatureAccess('ai-marketing');

if (isLoading) return <Loading />;
if (!hasAccess) return <UpgradePrompt feature="ai-marketing" />;
```

### 3.3 環境変数設定

#### 必須の環境変数（未設定の場合は追加）
```env
# Shopify設定
SHOPIFY_API_KEY=
SHOPIFY_API_SECRET=
SHOPIFY_SCOPES=read_products,write_products,read_customers
SHOPIFY_APP_URL=https://your-app.ngrok.io
SHOPIFY_WEBHOOK_PATH=/api/webhook

# データベース
DATABASE_CONNECTION_STRING=

# Azure
AZURE_KEY_VAULT_URL=
AZURE_CLIENT_ID=
```

---

## 4. 今週の作業スケジュール案

### 月曜日（8月26日）
- AM: データベースマイグレーション実行（Takashi）
- PM: GDPR Webhook実装開始（Takashi）
- 終日: アプリアイコン作成（浜地様）

### 火曜日（8月27日）
- AM: GDPR Webhook実装継続（Takashi）
- PM: 無料プラン機能制限UI実装（Yuki）
- 終日: スクリーンショット準備（Yuki）

### 水曜日（8月28日）
- AM: GDPR Webhook完成・テスト（Takashi）
- PM: 統合テスト開始（全員）
- 夕方: 進捗確認ミーティング

### 木曜日（8月29日）
- AM: 統合テスト継続
- PM: 不具合修正
- 終日: アプリ説明文作成（Kenji）

### 金曜日（8月30日）
- AM: 最終テスト
- PM: Staging環境デプロイ
- 夕方: 申請準備完了確認

---

## 5. エスカレーション事項

### 5.1 技術的判断が必要な事項
1. **Stores/Storeテーブル名統一**
   - 全体的なリファクタリングが必要か判断要
   
2. **課金テスト環境**
   - Shopify Partnersアカウントでのテストストア設定確認要

### 5.2 ビジネス判断が必要な事項
1. **料金プラン最終確定**
   - 現在の案: Starter $50/月、Professional $80/月、Enterprise $100/月
   - トライアル期間: 14日間
   
2. **無料プラン機能制限**
   - 月1回の変更制限の妥当性確認

---

## 6. リスクと対策

### 6.1 高リスク項目
| リスク | 影響度 | 対策 | 担当 |
|--------|--------|------|------|
| マイグレーション失敗 | 高 | バックアップ取得、段階実行 | Takashi |
| GDPR未実装での申請 | 高 | 8/28までに必須実装 | Takashi |
| 申請却下 | 高 | レビューガイドライン再確認 | Kenji |

### 6.2 中リスク項目
| リスク | 影響度 | 対策 | 担当 |
|--------|--------|------|------|
| 統合テスト不足 | 中 | テストケース網羅性確認 | 全員 |
| ドキュメント不備 | 中 | 申請前最終チェック | Kenji |

---

## 7. 参考資料

### 7.1 重要ドキュメント
- プロジェクト概要: `/docs/01-project-management/01-planning/PROJECT-OVERVIEW-2025.md`
- 課金システム仕様: `/docs/06-shopify/02-課金システム/`
- マイグレーション管理: `/docs/04-development/03-データベース/マイグレーション/database-migration-tracking.md`

### 7.2 テスト手順書
- 課金フロー: `/docs/04-development/06-Shopify連携/課金フロー検証チェックリスト.md`
- 無料プラン: `/docs/06-shopify/02-課金システム/05-無料プラン機能制限/無料プラン機能制限テスト手順書.md`

### 7.3 連絡先
- Kenji (PM): `ai-team/conversations/to_kenji.md`
- Yuki (Frontend): `ai-team/conversations/to_yuki.md`
- Takashi (Backend): `ai-team/conversations/to_takashi.md`
- Eris (Support): `ai-team/conversations/to_eris.md`
- 福田様: `ai-team/conversations/to_fukuda.md`

---

## 8. 申し送り事項

### 8.1 完了事項の確認
- SQLマイグレーションスクリプトは修正済み、実行待ち
- フロントエンド課金ページは修正済み、統合テスト待ち
- テスト手順書は作成済み、実施待ち

### 8.2 緊急度の再確認
1. **最優先**: データベースマイグレーション（ブロッカー解消）
2. **必須**: GDPR Webhook（申請要件）
3. **重要**: 統合テスト（品質保証）

### 8.3 次回作業開始時の確認事項
- gitの最新状態をpull
- 環境変数の設定確認
- データベース接続確認
- 本引継ぎ資料の熟読

---

## 終わりに

本引継ぎ資料は2025年8月25日時点の状況を反映しています。
作業中に新たな課題や変更が発生した場合は、適宜ドキュメントを更新し、チームメンバーに共有してください。

プロジェクトの成功に向けて、引き続きご協力をお願いいたします。

---

作成: Eris
確認: Kenji (PM)
最終更新: 2025年8月25日 10:00