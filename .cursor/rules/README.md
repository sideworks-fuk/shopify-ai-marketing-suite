# Cursor Rules ディレクトリガイド

このディレクトリには、Shopify AI Marketing Suite（EC Ranger）プロジェクトの開発ルールが含まれています。

**最終更新**: 2025-10-18  
**Cursor推奨形式**: MDC (Markdown Components)

## 📚 ルールファイル一覧

| ファイル名 | 用途 | 適用範囲 | 重要度 |
|-----------|------|---------|--------|
| **00-techstack.mdc** | 技術スタック完全定義 | 全ファイル | ★★★★★ |
| **01-core-rules.mdc** | 基本開発ルール | 全ファイル | ★★★★★ |
| **02-workflow.mdc** | 作業フロー・ログ管理 | 全ファイル | ★★★★ |
| **03-coding-standards.mdc** | コーディング規約 | TS/React/C# | ★★★★ |
| **04-database.mdc** | DB設計・マイグレーション | C#/DB関連 | ★★★★★ |
| **05-nextjs.mdc** | Next.js固有ルール | Next.js | ★★★ |
| **06-team-collaboration.mdc** | チームコラボレーション | ai-team | ★★ |

## 🚀 クイックスタート

### AIエージェント向け

**作業開始時の確認順序**:
1. `00-techstack.mdc` - 技術スタックの確認
2. `01-core-rules.mdc` - 基本ルールの確認
3. 該当する専門ルール（DB/Next.js等）の確認

**作業中の参照**:
- 不明点があれば該当ルールファイルを参照
- 複数ルールが関連する場合は横断的に確認
- 判断に迷ったら報告・確認
- 作業完了時は `docs/worklog/` に作業ログを記録（`@.cursor/rules/02-workflow.mdc` 準拠）

### 開発者向け

**新規参画時**:
1. 全ルールファイルを一読（約30-60分）
2. 自分の担当領域の専門ルールを重点確認
3. 不明点は報告ファイルで質問

**実装時**:
1. 該当するルールファイルを参照
2. コード例を活用
3. 迷った場合はチーム確認

## 📖 各ファイル詳細

### 00-techstack.mdc（技術スタック定義）

**目的**: プロジェクトの技術選定を完全定義

**主な内容**:
- Next.js 14.2.3, React 18.x, TypeScript 5
- Entity Framework Core 8.0.x
- Azure SQL Database
- 重要な開発方針・制約

**いつ参照するか**:
- 新しいライブラリ追加前
- 技術選定の判断時
- アーキテクチャ設計時

### 01-core-rules.mdc（基本開発ルール）

**目的**: プロジェクト全体の開発ルールを統一

**主な内容**:
- タスク分析の手順
- 重複実装の防止
- Git commitルール
- DBマイグレーション管理

**いつ参照するか**:
- すべての作業開始時
- 実装判断が必要な時
- エラー発生時

### 02-workflow.mdc（作業フロー・ログ管理）

**目的**: 作業フローと進捗管理を標準化

**主な内容**:
- 作業ログのフォーマット
- ブランチ戦略
- 進捗報告方法
- 日時記録のルール

**いつ参照するか**:
- 作業ログ作成時
- Git操作前
- 進捗報告時

### 03-coding-standards.mdc（コーディング規約）

**目的**: コード品質を統一

**主な内容**:
- TypeScript/React/C#の命名規則
- 関数定義のベストプラクティス
- パフォーマンス最適化
- セキュリティ対策

**いつ参照するか**:
- コード実装時
- コードレビュー時
- リファクタリング時

### 04-database.mdc（データベース設計・マイグレーション）

**目的**: データベース設計とマイグレーション管理を規定

**主な内容**:
- スキーマ設計ルール
- マイグレーション手順
- マルチテナント設計原則
- パフォーマンス最適化

**いつ参照するか**:
- テーブル設計時
- マイグレーション作成時
- DBクエリ最適化時

### 05-nextjs.mdc（Next.js固有ルール）

**目的**: Next.js App Routerのベストプラクティスを規定

**主な内容**:
- Server/Client Components使い分け
- API Routes方針（POST/PATCH/PUT/DELETEのみ、GETはOAuth等の例外）
- データフェッチング戦略
- パフォーマンス最適化
- ルートディレクトリ: `frontend/src/app`

**いつ参照するか**:
- Next.jsコンポーネント実装時
- ルーティング設計時
- API Route作成時

### 06-team-collaboration.mdc（チームコラボレーション）

**目的**: AIチーム（Kenji/Yuki/Takashi）の協力ルール

**主な内容**:
- 役割分担
- 報告フォーマット
- 会話ファイル管理
- エージェント運用ガイド

**いつ参照するか**:
- チーム連携が必要な時
- エージェント使用時
- 報告作成時

## 🔍 ルールの使い方

### MDC形式の理解

各ルールファイルは **MDC (Markdown Components)** 形式で記述されています。

**Frontmatter（メタデータ）**:
```yaml
---
description: ルールの説明
globs: 
  - "適用対象パターン"
alwaysApply: true/false
---
```

**適用タイミング**:
- `alwaysApply: true` - 常に適用される（技術スタック、基本ルール等）
- `alwaysApply: false` - 条件付き適用（専門ルール等）
- `globs` - ファイルパターンに一致する場合に自動適用

### ファイル参照（@）の活用

ルールファイル内では `@` を使用して他のファイルを参照できます：
```markdown
参考: @.cursor/rules/00-techstack.mdc
参考: @docs/02-architecture/system-architecture.md
```

Cursorはこれらの参照を認識し、必要に応じてコンテキストに含めます。

## 🎯 ルールの優先順位

複数のルールが競合する場合の優先順位：

1. **プロジェクト固有ルール**（このディレクトリ）
2. **チーム合意事項**（`ai-team/knowledge/CLAUDE.md`）
3. **一般的なベストプラクティス**

## 📝 ルール更新ガイドライン

### 更新が必要な場合

以下の場合はルールファイルの更新を検討：

1. 新しい技術スタックの追加
2. 開発プロセスの変更
3. 繰り返し発生する問題への対処
4. チームからのフィードバック

### 更新手順

1. **変更提案**: 理由と内容を明確に
2. **レビュー**: チーム（特にKenji）で確認
3. **更新**: 該当ルールファイルを修正
4. **周知**: チーム全員に通知
5. **このREADMEも更新**: 必要に応じて

## 🆘 トラブルシューティング

### ルールが適用されない場合

**確認事項**:
1. ファイルが `.cursor/rules/` 直下にあるか
2. ファイル拡張子が `.mdc` か
3. Frontmatterが正しく記述されているか
4. `globs` パターンが適切か

**解決策**:
- Cursorを再起動
- ルールファイルのフォーマットを確認
- エラーログを確認

### ルールの解釈が不明な場合

**対応手順**:
1. 該当ルールファイルの「参考ドキュメント」を確認
2. 関連するルールファイルを横断的に確認
3. プロジェクトドキュメント（`docs/`）を参照
4. チームメンバー（特にKenji）に質問

## 📚 関連ドキュメント

### プロジェクト内
- **AIチームガイドライン**: `ai-team/knowledge/CLAUDE.md`
- **エージェント定義**: `.claude/agents/`
- **プロジェクトドキュメント**: `docs/`
- **アーキテクチャ**: `docs/02-architecture/`

### 外部リンク
- **Cursor公式ドキュメント**: https://cursor.com/docs
- **Next.js公式**: https://nextjs.org/docs
- **Entity Framework Core**: https://learn.microsoft.com/en-us/ef/core/

## 📊 更新履歴

| 日付 | 変更内容 | 担当 |
|------|---------|------|
| 2025-10-18 | 初版作成（Phase 1 & 2完了） | AI Assistant + 福田 |

---

**質問・提案がある場合は `ai-team/conversations/to_kenji.md` または `to_all.md` に記載してください。**