# Shopify OAuth インストール機能 動作確認チェックリスト

## 📋 **動作確認項目**

### **1. 設定確認テスト**
- [ ] **`GET /api/shopify/test-config`**
  - [ ] API設定が正しく読み込まれている
  - [ ] フロントエンドURLが設定されている
  - [ ] ハイブリッド方式情報が表示される
  - [ ] CORS設定が正しい

### **2. ハイブリッド方式テスト**
- [ ] **`GET /api/shopify/test-hybrid-mode`**
  - [ ] フロントエンドURLが正しく生成される
  - [ ] リダイレクトURIが正しく設定される
  - [ ] OAuth URLが正しく生成される
  - [ ] フロー説明が表示される

### **3. OAuth URL生成テスト**
- [ ] **`GET /api/shopify/test-oauth-url`**
  - [ ] 有効なショップドメインで正常動作
  - [ ] 無効なショップドメインでエラー処理
  - [ ] OAuth URLの形式が正しい
  - [ ] パラメータが正しくエンコードされる

### **4. 暗号化テスト**
- [ ] **`POST /api/shopify/test-encryption`**
  - [ ] 暗号化が正常に動作
  - [ ] 復号化が正常に動作
  - [ ] 元のテキストと復号化結果が一致
  - [ ] エラーハンドリングが適切

### **5. インストール開始テスト**
- [ ] **`GET /api/shopify/install`**
  - [ ] 有効なショップドメインでリダイレクト
  - [ ] 無効なショップドメインでエラー
  - [ ] Stateパラメータが生成される
  - [ ] キャッシュにStateが保存される

### **6. プロセスコールバックテスト**
- [ ] **`POST /api/shopify/process-callback`**
  - [ ] 有効なパラメータで正常処理
  - [ ] 無効なStateでエラー処理
  - [ ] 必須パラメータ不足でエラー処理
  - [ ] HMAC検証の動作確認

## 🔧 **テスト環境準備**

### **必要な環境**
- [ ] .NET 8 SDK
- [ ] データベース接続
- [ ] Shopify Partner Dashboard設定
- [ ] ngrok（ローカルテスト用）

### **設定確認**
- [ ] `appsettings.Development.json`の設定
- [ ] 環境変数の設定
- [ ] CORS設定の確認
- [ ] データベース接続の確認

## 🚀 **実行手順**

### **1. アプリケーション起動**
```bash
cd backend/ShopifyAnalyticsApi
dotnet run
```

### **2. テスト実行**
```bash
# HTTPテストファイルを使用
# test-installation.http を実行
```

### **3. ブラウザテスト**
```bash
# 設定確認
https://localhost:7001/api/shopify/test-config

# ハイブリッド方式テスト
https://localhost:7001/api/shopify/test-hybrid-mode?shop=test-store.myshopify.com
```

## 📝 **期待される結果**

### **正常動作**
- すべてのテストエンドポイントが200 OKを返す
- 設定情報が正しく表示される
- エラーハンドリングが適切に動作する
- ログが適切に出力される

### **エラーケース**
- 無効なパラメータで適切なエラーレスポンス
- セキュリティ検証の失敗で適切なエラー
- データベースエラーで適切なエラーハンドリング

## 🔍 **トラブルシューティング**

### **よくある問題**
1. **CORSエラー**: フロントエンドURLの設定確認
2. **データベース接続エラー**: 接続文字列の確認
3. **暗号化エラー**: 暗号化キーの設定確認
4. **State検証エラー**: キャッシュ設定の確認

### **ログ確認**
- アプリケーションログの確認
- データベースログの確認
- エラーログの詳細確認

## ✅ **完了条件**

すべてのチェック項目が完了し、以下が確認できた場合：
- [ ] すべてのテストエンドポイントが正常動作
- [ ] エラーハンドリングが適切に動作
- [ ] セキュリティ機能が正常動作
- [ ] ログ出力が適切
- [ ] パフォーマンスが期待値を満たす

---

**作成日**: 2025-01-25  
**担当**: TAKASHI  
**次回更新**: 動作確認完了後 