# 無料プラン機能制限 - テスト手順書

作成日: 2025-08-25
担当: 福田様

## 🎯 テスト概要
無料プラン機能制限が正しく動作することを確認します。
所要時間: 約15分

## 📝 事前準備

### 1. ローカル環境の起動
```bash
# バックエンド起動（ターミナル1）
cd backend/ShopifyAnalyticsApi
dotnet run

# フロントエンド起動（ターミナル2）
cd frontend
npm run dev
```

### 2. ブラウザでアクセス
```
http://localhost:3000/dev-bookmarks
```

## ✅ テストシナリオ

### シナリオ1: 機能選択画面の確認（5分）

#### 手順
1. 開発用ブックマークページを開く
   - URL: `http://localhost:3000/dev-bookmarks`

2. 「無料プラン機能選択」をクリック
   - URL: `/billing/free-plan-setup`に遷移

3. 以下を確認
   - [ ] 3つの機能が表示されているか
     - 休眠顧客分析
     - 前年同月比分析
     - 購入回数詳細分析
   - [ ] 各機能の説明が表示されているか
   - [ ] 「選択する」ボタンが動作するか

#### 期待される結果
- 3つの機能がタブまたはカードで表示される
- 比較表が見やすく表示される
- 選択ボタンが機能する

---

### シナリオ2: 機能アクセス制御の確認（5分）

#### 手順
1. まず1つの機能を選択
   - 例: 「休眠顧客分析」を選択

2. 選択した機能にアクセス
   - URL: `/customers/dormant`
   - [ ] 正常に表示されるか確認

3. 選択していない機能にアクセス
   - URL: `/sales/year-over-year`（前年同月比）
   - [ ] ロック画面が表示されるか確認

4. ロック画面で以下を確認
   - [ ] なぜアクセスできないか説明がある
   - [ ] 機能選択ページへのリンクがある
   - [ ] アップグレードの提案がある

#### 期待される結果
- 選択した機能: 正常に分析画面が表示
- 未選択の機能: ロック画面が表示

---

### シナリオ3: 30日制限の確認（3分）

#### 手順
1. 機能選択画面に戻る
   - URL: `/billing/free-plan-setup`

2. 別の機能に変更を試みる
   - 現在選択中の機能とは別の機能を選択

3. 以下を確認
   - [ ] 「30日後まで変更できません」のメッセージ
   - [ ] 次回変更可能日時の表示
   - [ ] カウントダウン表示（あと○○日○○時間）

#### 期待される結果
- 30日制限のメッセージが表示される
- 次回変更可能日が明確に表示される

---

### シナリオ4: エラー処理の確認（2分）

#### 手順
1. バックエンドを停止
   - ターミナル1で`Ctrl+C`

2. 機能選択を試みる
   - [ ] エラーメッセージが表示されるか
   - [ ] 画面がクラッシュしないか

3. バックエンドを再起動
   - `dotnet run`

#### 期待される結果
- 適切なエラーメッセージが表示される
- 「接続エラー」や「しばらくしてから再試行」のメッセージ

---

## 🔍 チェックリスト

### UI/UX
- [ ] 機能選択画面が直感的
- [ ] ロック画面の説明が分かりやすい
- [ ] エラーメッセージが親切
- [ ] ローディング表示が適切

### 機能動作
- [ ] 機能選択が保存される
- [ ] アクセス制御が正しく動作
- [ ] 30日制限が機能
- [ ] エラー時のフォールバック

### パフォーマンス
- [ ] ページ遷移が速い（<2秒）
- [ ] API応答が速い（<500ms）
- [ ] エラー時も応答がある

---

## 🚨 問題発生時の対処

### よくある問題と解決方法

#### 1. 「Cannot connect to backend」エラー
```bash
# バックエンドが起動しているか確認
cd backend/ShopifyAnalyticsApi
dotnet run
```

#### 2. 機能選択が保存されない
```bash
# データベースマイグレーションを確認
# SQL Management Studioで以下を実行
SELECT * FROM UserFeatureSelections;
```

#### 3. ロック画面が表示されない
```bash
# ブラウザのキャッシュをクリア
# Ctrl + Shift + R（強制リロード）
```

---

## 📊 テスト結果記録

### テスト実施日時
- 日付: _______________
- 開始時刻: ___________
- 終了時刻: ___________

### テスト結果
| シナリオ | 結果 | 備考 |
|---------|------|------|
| 機能選択画面 | □ OK / □ NG | |
| アクセス制御 | □ OK / □ NG | |
| 30日制限 | □ OK / □ NG | |
| エラー処理 | □ OK / □ NG | |

### 発見した問題
1. _________________________________
2. _________________________________
3. _________________________________

### 改善提案
1. _________________________________
2. _________________________________

---

## 📞 サポート

問題が発生した場合は、以下の情報と共に連絡してください：
- エラーメッセージのスクリーンショット
- ブラウザのコンソールログ（F12 → Console）
- 実行した手順

連絡先: `to_kenji.md`に記載

---

## 次のステップ

テスト完了後:
1. テスト結果を記録
2. 問題があれば`to_kenji.md`に報告
3. ステージング環境でも同様のテストを実施

ご協力ありがとうございます！


