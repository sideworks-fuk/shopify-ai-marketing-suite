# 課金システムテストタスクリスト

**作成日**: 2026-01-07  
**作成者**: AI Assistant  
**目的**: 課金システムの実装状況を整理し、テストすべき項目を洗い出してタスク化

---

## 📊 実装状況サマリー（2026-01-07時点）

### 全体完成度: **85%**

| カテゴリ | 完成度 | 状態 |
|---------|--------|------|
| バックエンドAPI | 90% | ✅ 基本機能実装済み |
| フロントエンドUI | 75% | ✅ 基本画面実装済み |
| データベース | 90% | ✅ テーブル実装済み |
| Webhook処理 | 85% | ✅ 基本処理実装済み |
| 機能制限システム | 80% | ✅ 基本実装済み |
| テスト | 60% | ⏳ 一部未実装 |

---

## 🎯 テストタスク一覧

### Phase 1: 基本機能テスト（必須）

#### 1.1 プラン管理機能テスト

**タスクID**: `BILLING-TEST-001`  
**優先度**: 🔴 Critical  
**推定時間**: 2時間  
**担当**: Takashi / Yuki

##### テスト項目
- [ ] **プラン一覧取得テスト**
  - `GET /api/billing/plans` が正常に動作するか
  - 全プラン（Free, Basic, Professional, Enterprise）が返却されるか
  - プラン情報（価格、機能、トライアル日数）が正しいか
  - フロントエンドでプラン一覧が正しく表示されるか

- [ ] **プラン情報の整合性テスト**
  - データベースの`SubscriptionPlans`テーブルとAPIレスポンスが一致するか
  - プランID、名前、価格が正しく設定されているか
  - `Features`フィールド（JSON）が正しくパースされるか

##### 確認方法
```bash
# API直接テスト
curl -X GET https://localhost:7140/api/billing/plans \
  -H "Authorization: Bearer {token}"

# データベース確認
SELECT * FROM SubscriptionPlans WHERE IsActive = 1;
```

##### 期待結果
- ステータスコード: `200 OK`
- レスポンスに4つのプランが含まれる
- 各プランの`id`, `name`, `price`, `features`が正しく設定されている

---

#### 1.2 サブスクリプション作成フローテスト

**タスクID**: `BILLING-TEST-002`  
**優先度**: 🔴 Critical  
**推定時間**: 3時間  
**担当**: Takashi

##### テスト項目
- [ ] **新規サブスクリプション作成テスト**
  - `POST /api/billing/subscribe` が正常に動作するか
  - Shopify GraphQL APIへのリクエストが正しく送信されるか
  - `confirmationUrl`が返却されるか
  - データベースに`pending`状態のサブスクリプションが作成されるか

- [ ] **Shopify承認画面へのリダイレクトテスト**
  - `confirmationUrl`が有効なURLか
  - Shopifyの承認画面が正しく表示されるか
  - テストモード（`test: true`）で金額が`$0.00`になるか
  - プラン名、価格、トライアル日数が正しく表示されるか

- [ ] **承認後のコールバック処理テスト**
  - `GET /api/subscription/confirm?charge_id={id}&shop={domain}` が正常に動作するか
  - Shopifyからサブスクリプション情報が正しく取得できるか
  - データベースのサブスクリプション状態が`active`に更新されるか
  - フロントエンドに正しくリダイレクトされるか

##### 確認方法
```bash
# サブスクリプション作成
curl -X POST https://localhost:7140/api/billing/subscribe \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{"planId": "2", "returnUrl": "/billing"}'

# データベース確認
SELECT * FROM StoreSubscriptions WHERE StoreId = {storeId} ORDER BY CreatedAt DESC;
```

##### 期待結果
- サブスクリプション作成成功
- `confirmationUrl`が返却される
- Shopify承認画面でテストモード表示
- 承認後、データベース状態が`active`に更新

---

#### 1.3 Webhook処理テスト

**タスクID**: `BILLING-TEST-003`  
**優先度**: 🔴 Critical  
**推定時間**: 2時間  
**担当**: Takashi

##### テスト項目
- [ ] **app_subscriptions/update Webhookテスト**
  - `POST /api/webhook/subscriptions-update` が正常に受信できるか
  - HMAC署名検証が正しく動作するか
  - Webhookペイロードが正しくパースされるか
  - サブスクリプション状態が正しく更新されるか
  - `WebhookEvents`テーブルに記録されるか

- [ ] **app_subscriptions/cancel Webhookテスト**
  - `POST /api/webhook/subscriptions-cancel` が正常に受信できるか
  - サブスクリプション状態が`cancelled`に更新されるか
  - キャンセル日時が正しく記録されるか

- [ ] **Webhook冪等性テスト**
  - 同一WebhookIDの重複送信が正しく処理されるか
  - `IdempotencyKey`による重複防止が機能するか

##### 確認方法
```bash
# Webhook手動送信（ngrok使用）
curl -X POST https://{ngrok-url}/api/webhook/subscriptions-update \
  -H "Content-Type: application/json" \
  -H "X-Shopify-Topic: app_subscriptions/update" \
  -H "X-Shopify-Shop-Domain: test-store.myshopify.com" \
  -H "X-Shopify-Hmac-Sha256: {hmac}" \
  -d '{webhook_payload}'

# データベース確認
SELECT * FROM WebhookEvents WHERE Topic = 'app_subscriptions/update' ORDER BY CreatedAt DESC;
SELECT * FROM StoreSubscriptions WHERE StoreId = {storeId};
```

##### 期待結果
- Webhookが正常に受信・処理される
- HMAC署名検証が成功する
- サブスクリプション状態が正しく更新される
- 重複Webhookが正しく処理される

---

#### 1.4 プラン変更テスト

**タスクID**: `BILLING-TEST-004`  
**優先度**: 🟡 High  
**推定時間**: 2時間  
**担当**: Takashi

##### テスト項目
- [ ] **プランアップグレードテスト**
  - `POST /api/billing/change-plan` が正常に動作するか
  - 旧プランが自動的にキャンセルされるか
  - 新プランの承認URLが生成されるか
  - 承認後、新プランがアクティブになるか

- [ ] **プランダウングレードテスト**
  - ダウングレードが正常に動作するか
  - 次サイクルから反映されるか（即時反映でない場合）

##### 確認方法
```bash
# プラン変更
curl -X POST https://localhost:7140/api/billing/change-plan \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{"newPlanId": "3", "returnUrl": "/billing"}'
```

##### 期待結果
- プラン変更が正常に処理される
- 旧プランがキャンセルされ、新プランがアクティブになる

---

#### 1.5 サブスクリプションキャンセルテスト

**タスクID**: `BILLING-TEST-005`  
**優先度**: 🟡 High  
**推定時間**: 1時間  
**担当**: Takashi

##### テスト項目
- [ ] **キャンセル処理テスト**
  - `POST /api/billing/cancel` が正常に動作するか
  - Shopify APIでサブスクリプションがキャンセルされるか
  - データベースの状態が`cancelled`に更新されるか
  - キャンセル日時が正しく記録されるか

- [ ] **キャンセル後の機能制限テスト**
  - キャンセル後、有料機能が制限されるか
  - Freeプランに戻るか
  - 機能ロック画面が表示されるか

##### 確認方法
```bash
# キャンセル
curl -X POST https://localhost:7140/api/billing/cancel \
  -H "Authorization: Bearer {token}"
```

##### 期待結果
- サブスクリプションが正常にキャンセルされる
- データベース状態が`cancelled`に更新
- 機能制限が正しく適用される

---

### Phase 2: トライアル機能テスト

#### 2.1 トライアル開始テスト

**タスクID**: `BILLING-TEST-006`  
**優先度**: 🟡 High  
**推定時間**: 1.5時間  
**担当**: Takashi

##### テスト項目
- [ ] **トライアル開始テスト**
  - `POST /api/billing/start-trial` が正常に動作するか
  - トライアル期間が正しく設定されるか（デフォルト14日）
  - サブスクリプション状態が`trialing`になるか
  - `TrialEndsAt`が正しく設定されるか

- [ ] **トライアル期間中の機能確認**
  - トライアル期間中、全機能が利用可能か
  - トライアル残日数が正しく表示されるか
  - フロントエンドでトライアルバナーが表示されるか

##### 確認方法
```bash
# トライアル開始
curl -X POST https://localhost:7140/api/billing/start-trial \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{"trialDays": 14}'
```

##### 期待結果
- トライアルが正常に開始される
- トライアル期間が正しく設定される
- トライアル期間中、全機能が利用可能

---

#### 2.2 トライアル期限切れテスト

**タスクID**: `BILLING-TEST-007`  
**優先度**: 🟡 High  
**推定時間**: 2時間  
**担当**: Takashi

##### テスト項目
- [ ] **トライアル期限切れ処理テスト**
  - `CheckTrialExpirationsAsync`が正常に動作するか（HangFireジョブ）
  - 期限切れトライアルが正しく検出されるか
  - サブスクリプション状態が適切に更新されるか（`expired`または`cancelled`）
  - 機能制限が正しく適用されるか

- [ ] **期限切れ通知テスト**
  - 期限切れ前に通知が送信されるか（実装済みの場合）
  - 期限切れ後の動作が正しいか

##### 確認方法
```sql
-- テスト用にトライアル期限を過去に設定
UPDATE StoreSubscriptions 
SET TrialEndsAt = DATEADD(day, -1, GETUTCDATE())
WHERE Status = 'trialing' AND StoreId = {testStoreId};

-- HangFireジョブを手動実行または待機
```

##### 期待結果
- トライアル期限切れが正しく検出される
- サブスクリプション状態が適切に更新される
- 機能制限が正しく適用される

---

### Phase 3: 機能制限システムテスト

#### 3.1 無料プラン機能選択テスト

**タスクID**: `BILLING-TEST-008`  
**優先度**: 🟡 High  
**推定時間**: 2時間  
**担当**: Yuki / Takashi

##### テスト項目
- [ ] **機能選択APIテスト**
  - `GET /api/feature-selection/current` が正常に動作するか
  - `POST /api/feature-selection/select` が正常に動作するか
  - 選択可能な機能一覧が正しく返却されるか
  - 機能選択がデータベースに正しく保存されるか

- [ ] **30日制限テスト**
  - 機能選択後、30日以内の再変更が拒否されるか
  - `NextChangeAvailableDate`が正しく計算されるか
  - 30日経過後、再変更が可能になるか

- [ ] **機能選択UIテスト**
  - 機能選択画面が正しく表示されるか
  - 選択可能な機能が正しく表示されるか
  - 変更不可期間の表示が正しいか

##### 確認方法
```bash
# 現在の選択を取得
curl -X GET https://localhost:7140/api/feature-selection/current \
  -H "Authorization: Bearer {token}"

# 機能選択
curl -X POST https://localhost:7140/api/feature-selection/select \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{"featureId": "dormant_analysis"}'
```

##### 期待結果
- 機能選択が正常に動作する
- 30日制限が正しく適用される
- UIが正しく動作する

---

#### 3.2 機能アクセス制御テスト

**タスクID**: `BILLING-TEST-009`  
**優先度**: 🔴 Critical  
**推定時間**: 3時間  
**担当**: Takashi / Yuki

##### テスト項目
- [ ] **無料プラン機能制限テスト**
  - Freeプランで選択した機能のみアクセス可能か
  - 未選択機能へのアクセスが`403 Forbidden`で拒否されるか
  - `FeatureLockedScreen`が正しく表示されるか
  - アップグレード誘導が表示されるか

- [ ] **有料プラン機能アクセステスト**
  - Professional/Enterpriseプランで全機能がアクセス可能か
  - 機能制限が正しく解除されるか

- [ ] **機能制限ミドルウェアテスト**
  - `FeatureAccessMiddleware`が正しく動作するか
  - 未許可アクセスが正しくブロックされるか
  - エラーメッセージが適切か

##### 確認方法
```bash
# 無料プランで未選択機能にアクセス
curl -X GET https://localhost:7140/api/analysis/year-over-year \
  -H "Authorization: Bearer {token}"

# 期待: 403 Forbidden または機能ロック画面
```

##### 期待結果
- 無料プランで選択した機能のみアクセス可能
- 未選択機能へのアクセスが正しく拒否される
- 有料プランで全機能がアクセス可能

---

#### 3.3 機能使用ログテスト

**タスクID**: `BILLING-TEST-010`  
**優先度**: 🟢 Medium  
**推定時間**: 1.5時間  
**担当**: Takashi

##### テスト項目
- [ ] **使用ログ記録テスト**
  - 機能使用時に`FeatureUsageLogs`テーブルに記録されるか
  - ログ情報（機能ID、使用日時、ストアID）が正しいか
  - 未許可アクセスの試行が記録されるか

- [ ] **使用統計取得テスト**
  - 使用統計が正しく取得できるか
  - 月次/日次集計が正しいか

##### 確認方法
```sql
-- 使用ログ確認
SELECT * FROM FeatureUsageLogs 
WHERE StoreId = {storeId} 
ORDER BY CreatedAt DESC;

-- 使用統計確認
SELECT FeatureId, COUNT(*) as UsageCount, MAX(CreatedAt) as LastUsed
FROM FeatureUsageLogs
WHERE StoreId = {storeId}
GROUP BY FeatureId;
```

##### 期待結果
- 機能使用が正しく記録される
- 使用統計が正しく取得できる

---

### Phase 4: エラーハンドリング・エッジケーステスト

#### 4.1 エラーハンドリングテスト

**タスクID**: `BILLING-TEST-011`  
**優先度**: 🟡 High  
**推定時間**: 2時間  
**担当**: Takashi

##### テスト項目
- [ ] **無効なプランIDテスト**
  - 存在しないプランIDでサブスクリプション作成を試みた場合、エラーが返るか
  - エラーメッセージが適切か

- [ ] **重複サブスクリプションテスト**
  - 既にアクティブなサブスクリプションがある場合、新規作成が拒否されるか

- [ ] **Shopify APIエラーテスト**
  - Shopify APIがエラーを返した場合、適切にハンドリングされるか
  - エラーログが記録されるか
  - ユーザーに適切なエラーメッセージが表示されるか

- [ ] **ネットワークエラーテスト**
  - ネットワークエラー時にリトライが機能するか
  - タイムアウト処理が正しいか

##### 確認方法
```bash
# 無効なプランID
curl -X POST https://localhost:7140/api/billing/subscribe \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{"planId": "999"}'

# 期待: 400 Bad Request
```

##### 期待結果
- エラーが適切にハンドリングされる
- エラーメッセージが適切
- エラーログが記録される

---

#### 4.2 並行処理・冪等性テスト

**タスクID**: `BILLING-TEST-012`  
**優先度**: 🟡 High  
**推定時間**: 2時間  
**担当**: Takashi

##### テスト項目
- [ ] **Webhook重複送信テスト**
  - 同一WebhookIDの重複送信が正しく処理されるか
  - `IdempotencyKey`による重複防止が機能するか

- [ ] **並行サブスクリプション作成テスト**
  - 同一ストアで並行してサブスクリプション作成を試みた場合、正しく処理されるか
  - データベースの整合性が保たれるか

##### 確認方法
```bash
# 同一Webhookを2回送信
curl -X POST https://localhost:7140/api/webhook/subscriptions-update \
  -H "X-Shopify-Webhook-Id: {same_id}" \
  -d '{payload}'

curl -X POST https://localhost:7140/api/webhook/subscriptions-update \
  -H "X-Shopify-Webhook-Id: {same_id}" \
  -d '{payload}'

# 期待: 2回目は重複として処理される
```

##### 期待結果
- 重複Webhookが正しく処理される
- 並行処理が正しく動作する
- データベースの整合性が保たれる

---

### Phase 5: フロントエンド統合テスト

#### 5.1 課金管理画面テスト

**タスクID**: `BILLING-TEST-013`  
**優先度**: 🟡 High  
**推定時間**: 2時間  
**担当**: Yuki

##### テスト項目
- [ ] **課金管理画面表示テスト**
  - `/settings/billing` が正常に表示されるか
  - 現在のプラン情報が正しく表示されるか
  - プラン一覧が正しく表示されるか
  - トライアル残日数が正しく表示されるか

- [ ] **プラン選択UIテスト**
  - プラン選択ボタンが正常に動作するか
  - Shopify承認画面へのリダイレクトが正しく動作するか
  - 承認後のリダイレクトが正しく動作するか

- [ ] **キャンセルUIテスト**
  - キャンセルボタンが正常に動作するか
  - 確認ダイアログが表示されるか
  - キャンセル後の状態更新が正しいか

##### 確認方法
1. ブラウザで `/settings/billing` にアクセス
2. プラン選択を実行
3. Shopify承認画面で承認
4. アプリに戻り、状態を確認

##### 期待結果
- 課金管理画面が正常に表示される
- プラン選択・承認フローが正常に動作する
- キャンセル処理が正常に動作する

---

#### 5.2 機能ロック画面テスト

**タスクID**: `BILLING-TEST-014`  
**優先度**: 🟡 High  
**推定時間**: 1.5時間  
**担当**: Yuki

##### テスト項目
- [ ] **機能ロック画面表示テスト**
  - 未選択機能にアクセスした場合、`FeatureLockedScreen`が表示されるか
  - ロック画面のメッセージが適切か
  - アップグレードボタンが表示されるか
  - アップグレードボタンが正常に動作するか

- [ ] **機能選択画面テスト**
  - 無料プランで機能選択画面が表示されるか
  - 選択可能な機能が正しく表示されるか
  - 変更不可期間の表示が正しいか

##### 確認方法
1. 無料プランで未選択機能にアクセス
2. 機能ロック画面が表示されることを確認
3. 機能選択画面に遷移
4. 機能を選択

##### 期待結果
- 機能ロック画面が正しく表示される
- 機能選択が正常に動作する

---

### Phase 6: 本番環境テスト

#### 6.1 本番Shopify環境でのE2Eテスト

**タスクID**: `BILLING-TEST-015`  
**優先度**: 🔴 Critical  
**推定時間**: 4時間  
**担当**: Takashi / Yuki

##### テスト項目
- [ ] **カスタムアプリでのテスト**
  - カスタムアプリを作成
  - 最小金額（$0.01）でサブスクリプション作成
  - Shopify承認画面で承認
  - Webhook受信確認
  - サブスクリプション状態確認
  - 即座にキャンセル（課金最小化）

- [ ] **本番環境での動作確認**
  - 本番環境のAPI URLで動作するか
  - 本番環境のデータベースで動作するか
  - 本番環境のWebhook設定が正しいか

##### 確認方法
1. Shopify Partners Dashboardでカスタムアプリ作成
2. テストストアにアプリをインストール
3. 最小金額でサブスクリプション作成
4. Shopify承認画面で承認
5. Webhook受信を確認
6. 即座にキャンセル

##### 期待結果
- 本番環境で正常に動作する
- 最小金額でのテストが成功する
- Webhookが正常に受信される

---

#### 6.2 負荷テスト

**タスクID**: `BILLING-TEST-016`  
**優先度**: 🟢 Medium  
**推定時間**: 2時間  
**担当**: Takashi

##### テスト項目
- [ ] **API負荷テスト**
  - 複数のストアで同時にサブスクリプション作成を試みた場合、正常に処理されるか
  - レスポンスタイムが許容範囲内か（< 2秒）

- [ ] **Webhook負荷テスト**
  - 大量のWebhookを同時に受信した場合、正常に処理されるか
  - 処理遅延が許容範囲内か

##### 確認方法
```bash
# 負荷テストツール使用（例: Apache Bench）
ab -n 100 -c 10 -H "Authorization: Bearer {token}" \
  https://localhost:7140/api/billing/plans
```

##### 期待結果
- 負荷下でも正常に動作する
- レスポンスタイムが許容範囲内

---

### Phase 7: データ整合性テスト

#### 7.1 データベース整合性テスト

**タスクID**: `BILLING-TEST-017`  
**優先度**: 🟡 High  
**推定時間**: 2時間  
**担当**: Takashi

##### テスト項目
- [ ] **外部キー制約テスト**
  - `StoreSubscriptions.StoreId`が`Stores.Id`と正しく関連付けられているか
  - `StoreSubscriptions.PlanId`が`SubscriptionPlans.Id`と正しく関連付けられているか
  - 削除時のカスケード処理が正しいか

- [ ] **データ整合性テスト**
  - サブスクリプション作成時、関連データが正しく作成されるか
  - サブスクリプション更新時、関連データが正しく更新されるか
  - サブスクリプション削除時、関連データが正しく削除されるか

##### 確認方法
```sql
-- 外部キー制約確認
SELECT 
    ss.Id,
    ss.StoreId,
    s.Name as StoreName,
    ss.PlanId,
    sp.Name as PlanName
FROM StoreSubscriptions ss
LEFT JOIN Stores s ON ss.StoreId = s.Id
LEFT JOIN SubscriptionPlans sp ON ss.PlanId = sp.Id
WHERE ss.StoreId = {storeId};

-- データ整合性確認
SELECT 
    COUNT(*) as SubscriptionCount,
    COUNT(DISTINCT StoreId) as StoreCount,
    COUNT(DISTINCT PlanId) as PlanCount
FROM StoreSubscriptions
WHERE Status = 'active';
```

##### 期待結果
- 外部キー制約が正しく機能する
- データ整合性が保たれる

---

#### 7.2 トランザクションテスト

**タスクID**: `BILLING-TEST-018`  
**優先度**: 🟡 High  
**推定時間**: 1.5時間  
**担当**: Takashi

##### テスト項目
- [ ] **トランザクション処理テスト**
  - サブスクリプション作成時のトランザクションが正しく動作するか
  - エラー発生時にロールバックが正しく動作するか
  - 部分的な更新が発生しないか

##### 確認方法
```sql
-- トランザクション開始
BEGIN TRANSACTION;

-- サブスクリプション作成処理（エラーを発生させる）
-- ...

-- ロールバック確認
ROLLBACK TRANSACTION;

-- データが更新されていないことを確認
SELECT * FROM StoreSubscriptions WHERE StoreId = {storeId};
```

##### 期待結果
- トランザクションが正しく動作する
- エラー時にロールバックが正しく動作する

---

## 📋 テスト実施チェックリスト

### 事前準備
- [ ] テスト環境のセットアップ完了
- [ ] テストデータの準備完了
- [ ] テストストアの準備完了
- [ ] Webhook受信環境の準備完了（ngrok等）

### テスト実行
- [ ] Phase 1: 基本機能テスト完了
- [ ] Phase 2: トライアル機能テスト完了
- [ ] Phase 3: 機能制限システムテスト完了
- [ ] Phase 4: エラーハンドリングテスト完了
- [ ] Phase 5: フロントエンド統合テスト完了
- [ ] Phase 6: 本番環境テスト完了
- [ ] Phase 7: データ整合性テスト完了

### テスト結果記録
- [ ] 各テストケースの結果を記録
- [ ] 発見した問題を記録
- [ ] 修正内容を記録
- [ ] 再テスト結果を記録

---

## 🐛 既知の問題・未実装機能

### 未実装機能
1. **使用量ダッシュボード**
   - 推定時間: 3-5日
   - 優先度: 🟢 Nice to Have

2. **請求履歴表示**
   - 推定時間: 2-3日
   - 優先度: 🟢 Nice to Have

3. **顧客数ベースの使用量制限**
   - 推定時間: 1-2日
   - 優先度: 🟡 High Priority

4. **自動ダウングレード機能**
   - 推定時間: 2-3日
   - 優先度: 🟢 Nice to Have

### 既知の問題
- なし（2026-01-07時点）

---

## 📊 テスト進捗管理

### テスト実施状況

| Phase | タスク数 | 完了 | 進行中 | 未着手 | 完了率 |
|-------|---------|------|--------|--------|--------|
| Phase 1 | 5 | 0 | 0 | 5 | 0% |
| Phase 2 | 2 | 0 | 0 | 2 | 0% |
| Phase 3 | 3 | 0 | 0 | 3 | 0% |
| Phase 4 | 2 | 0 | 0 | 2 | 0% |
| Phase 5 | 2 | 0 | 0 | 2 | 0% |
| Phase 6 | 2 | 0 | 0 | 2 | 0% |
| Phase 7 | 2 | 0 | 0 | 2 | 0% |
| **合計** | **18** | **0** | **0** | **18** | **0%** |

---

## 🎯 優先順位とスケジュール

### Critical（必須・申請ブロッカー）
1. **BILLING-TEST-001**: プラン管理機能テスト（2時間）
2. **BILLING-TEST-002**: サブスクリプション作成フローテスト（3時間）
3. **BILLING-TEST-003**: Webhook処理テスト（2時間）
4. **BILLING-TEST-009**: 機能アクセス制御テスト（3時間）
5. **BILLING-TEST-015**: 本番Shopify環境でのE2Eテスト（4時間）

**合計時間**: 14時間

### High Priority（申請前推奨）
1. **BILLING-TEST-004**: プラン変更テスト（2時間）
2. **BILLING-TEST-005**: サブスクリプションキャンセルテスト（1時間）
3. **BILLING-TEST-006**: トライアル開始テスト（1.5時間）
4. **BILLING-TEST-007**: トライアル期限切れテスト（2時間）
5. **BILLING-TEST-008**: 無料プラン機能選択テスト（2時間）
6. **BILLING-TEST-011**: エラーハンドリングテスト（2時間）
7. **BILLING-TEST-012**: 並行処理・冪等性テスト（2時間）
8. **BILLING-TEST-013**: 課金管理画面テスト（2時間）
9. **BILLING-TEST-014**: 機能ロック画面テスト（1.5時間）
10. **BILLING-TEST-017**: データベース整合性テスト（2時間）
11. **BILLING-TEST-018**: トランザクションテスト（1.5時間）

**合計時間**: 19.5時間

### Medium Priority（申請後でも可）
1. **BILLING-TEST-010**: 機能使用ログテスト（1.5時間）
2. **BILLING-TEST-016**: 負荷テスト（2時間）

**合計時間**: 3.5時間

---

## 📝 テスト結果記録テンプレート

各テスト実施時に以下の形式で記録してください：

```markdown
## テスト実施記録: {タスクID}

**実施日時**: YYYY-MM-DD HH:MM:SS  
**実施者**: {担当者名}  
**環境**: {Development/Staging/Production}  
**テストストア**: {store-domain.myshopify.com}

### テスト結果
| テスト項目 | 結果 | 備考 |
|-----------|------|------|
| {項目1} | ✅/❌ | {詳細} |
| {項目2} | ✅/❌ | {詳細} |

### 発見した問題
1. {問題の詳細}
   - 影響度: {High/Medium/Low}
   - 対応状況: {対応済み/対応中/未対応}

### 改善提案
1. {提案内容}
```

---

## 🔗 関連ドキュメント

- [実装状況レポート](./billing-implementation-status-2025-10-06.md)
- [テストガイド](./課金機能テストガイド.md)
- [0円テスト手順書](../../08-shopify/02-課金システム/04-理解と運用/課金0円テスト完全手順書.md)
- [テスト仕様書](../../08-shopify/02-課金システム/03-実装管理/テスト仕様書-課金と無料プラン.md)

---

## 📞 サポート

テスト実施中に問題が発生した場合：
1. 問題を記録（上記テンプレート使用）
2. ログを確認（Application Insights / ローカルログ）
3. 必要に応じてチームに相談

---

**最終更新**: 2026-01-07  
**次回更新予定**: テスト実施後
