# 課金フロー検証チェックリスト

作成日: 2025-08-24  
作成者: ERIS（サポート: 福田）

## 前提条件
- [ ] テストストア準備済み
- [ ] アプリ再インストール可能な状態
- [ ] バックエンド起動・ログ確認可能
- [ ] 環境変数確認（SHOPIFY関連、フロントエンドURL系）

## 環境設定確認
- [ ] SHOPIFY_FRONTEND_BASEURL が環境ごとに正しい
- [ ] CORS/リダイレクト設定が正しい
- [ ] Webhook受信エンドポイント稼働

## バックエンド実装確認
- [ ] AppSubscriptionCreate mutation 実装/成功
- [ ] AppSubscriptionLineItemUpdate（プラン変更）実装/成功
- [ ] Webhook: app_subscriptions/update 受信/処理
- [ ] Webhook: app_subscriptions/cancelled 受信/処理
- [ ] 課金状態管理APIで現在ステータス取得可能

## フロントエンドUI確認
- [ ] プラン選択画面表示
- [ ] 現在のプラン表示
- [ ] アップグレード/ダウングレード操作
- [ ] トライアル残日数表示

## E2Eシナリオ
- [ ] 新規インストール→トライアル開始→承認URL遷移
- [ ] トライアル期限切れ→自動課金開始（シミュレーション）
- [ ] プラン変更（アップグレード/ダウングレード）
- [ ] キャンセル処理→ステータス反映

## 失敗系テスト
- [ ] 決済失敗時のハンドリング
- [ ] Webhook遅延/重複時の冪等処理
- [ ] レート制限時のリトライ/待機

## 記録・ドキュメント
- [ ] 実行ログ保存（時刻・店舗・結果）
- [ ] `docs/worklog/YYYY/MM/` に結果記録
- [ ] 未実装/課題は `ai-team/conversations/temp.md` に記載

---
参考: `ai-team/conversations/report_kenji_billing_plan.md` の計画・成功指標に準拠。

