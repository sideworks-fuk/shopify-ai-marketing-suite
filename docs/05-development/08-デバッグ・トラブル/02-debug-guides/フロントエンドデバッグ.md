# フロントエンドデバッグガイド

## 概要
Next.js + React アプリケーションのデバッグ方法について説明します。

---

## 1. ブラウザ開発者ツール

### 1.1 Console タブ
- **エラーログの確認**: JavaScript エラー、警告の確認
- **デバッグログの出力**: `console.log()`, `console.error()` の確認
- **ネットワークエラーの確認**: API 通信エラーの確認

```javascript
// デバッグログの例
console.log('🔍 デバッグ情報:', {
  state: currentState,
  props: componentProps,
  timestamp: new Date().toISOString()
});
```

### 1.2 Network タブ
- **API リクエストの確認**: リクエスト/レスポンスの詳細確認
- **ステータスコードの確認**: 200, 401, 500 などの確認
- **レスポンス時間の確認**: パフォーマンス問題の特定

### 1.3 Application タブ
- **LocalStorage の確認**: 保存されているデータの確認
- **SessionStorage の確認**: セッション情報の確認
- **Cookies の確認**: 認証情報の確認

---

## 2. React DevTools

### 2.1 コンポーネント状態の確認
- **Props の確認**: 親コンポーネントから渡される値
- **State の確認**: コンポーネント内部の状態
- **Hooks の確認**: useState, useEffect などの状態

### 2.2 パフォーマンス分析
- **レンダリング回数の確認**: 不要な再レンダリングの特定
- **メモ化の確認**: useMemo, useCallback の効果確認

---

## 3. よくある問題と解決策

### 3.1 認証エラー

#### 症状
- 401 Unauthorized エラー
- 認証画面が表示されない
- トークンが無効

#### 解決策
```javascript
// トークンの確認
const token = localStorage.getItem('access_token');
console.log('🔑 トークン:', token);

// トークンの有効期限確認
if (token) {
  const payload = JSON.parse(atob(token.split('.')[1]));
  const expiration = new Date(payload.exp * 1000);
  console.log('⏰ 有効期限:', expiration);
}
```

### 3.2 API接続エラー

#### 症状
- ネットワークエラー
- CORS エラー
- タイムアウトエラー

#### 解決策
```javascript
// API エンドポイントの確認
const apiUrl = process.env.NEXT_PUBLIC_API_URL;
console.log('🌐 API URL:', apiUrl);

// リクエストヘッダーの確認
const headers = {
  'Authorization': `Bearer ${token}`,
  'Content-Type': 'application/json'
};
console.log('📤 リクエストヘッダー:', headers);
```

### 3.3 状態管理エラー

#### 症状
- 状態が更新されない
- 予期しない状態の変化
- メモリリーク

#### 解決策
```javascript
// useEffect の依存配列確認
useEffect(() => {
  // 処理
}, [dependency1, dependency2]); // 依存配列を確認

// クリーンアップ関数の実装
useEffect(() => {
  const timer = setInterval(() => {
    // 処理
  }, 1000);

  return () => {
    clearInterval(timer); // クリーンアップ
  };
}, []);
```

---

## 4. デバッグツール

### 4.1 ブラウザ拡張機能
- **React Developer Tools**: React コンポーネントのデバッグ
- **Redux DevTools**: Redux 状態のデバッグ
- **Vue.js devtools**: Vue.js アプリケーションのデバッグ

### 4.2 VS Code 拡張機能
- **ES7+ React/Redux/React-Native snippets**: コードスニペット
- **Auto Rename Tag**: HTML タグの自動リネーム
- **Bracket Pair Colorizer**: 括弧の色分け

---

## 5. パフォーマンスデバッグ

### 5.1 レンダリングパフォーマンス
```javascript
// React.memo の使用
const MemoizedComponent = React.memo(({ data }) => {
  return <div>{data}</div>;
});

// useMemo の使用
const expensiveValue = useMemo(() => {
  return heavyCalculation(data);
}, [data]);

// useCallback の使用
const handleClick = useCallback(() => {
  // 処理
}, [dependency]);
```

### 5.2 ネットワークパフォーマンス
- **Bundle Analyzer**: バンドルサイズの分析
- **Lighthouse**: パフォーマンススコアの測定
- **WebPageTest**: 詳細なパフォーマンス分析

---

## 6. エラーハンドリング

### 6.1 Error Boundary
```javascript
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    console.error('🚨 エラーが発生しました:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return <h1>エラーが発生しました。</h1>;
    }

    return this.props.children;
  }
}
```

### 6.2 グローバルエラーハンドリング
```javascript
// 未処理のエラーをキャッチ
window.addEventListener('error', (event) => {
  console.error('🚨 グローバルエラー:', event.error);
});

// 未処理のPromise拒否をキャッチ
window.addEventListener('unhandledrejection', (event) => {
  console.error('🚨 未処理のPromise拒否:', event.reason);
});
```

---

## 7. デバッグのベストプラクティス

### 7.1 ログ出力
- **構造化ログ**: オブジェクト形式でログ出力
- **ログレベル**: 適切なログレベルを使用
- **本番環境**: 本番環境ではログ出力を制限

### 7.2 デバッグ情報
- **環境情報**: ブラウザ、OS、バージョン情報
- **ユーザー情報**: ユーザーID、セッション情報
- **エラー情報**: スタックトレース、エラーメッセージ

---

## 関連ドキュメント

- [バックエンドデバッグ](./バックエンドデバッグ.md)
- [認証デバッグ](./認証デバッグ.md)
- [APIデバッグ](./APIデバッグ.md)

---

**最終更新**: 2025年10月25日
**次回レビュー**: 2025年11月1日（週次）
