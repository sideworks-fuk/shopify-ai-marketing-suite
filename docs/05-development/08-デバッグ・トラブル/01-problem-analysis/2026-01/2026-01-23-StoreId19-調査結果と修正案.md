# StoreId=19 åŒæœŸæ™‚åˆ»ä¸ä¸€è‡´èª¿æŸ»çµæœã¨ä¿®æ­£æ¡ˆ

## ğŸ“‹ èª¿æŸ»çµæœã‚µãƒãƒªãƒ¼

### âœ… æœ€çµ‚åŒæœŸæ™‚åˆ»ã®ä¸ä¸€è‡´ â†’ **å•é¡Œãªã—**

**èª¿æŸ»çµæœ**:
- `Stores.LastSyncDate`: `2026-01-22 18:20:01.2274931`
- `SyncStatuses.LatestEndDate`: `2026-01-22 18:20:01.2273446`
- `TimeDifferenceSeconds`: **0ç§’**

**çµè«–**: æœ€çµ‚åŒæœŸæ™‚åˆ»ã¯ä¸€è‡´ã—ã¦ã„ã¾ã™ã€‚ä¸ä¸€è‡´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

---

### âŒ 16225åˆ†ã®è¨ˆç®— â†’ **ãƒã‚°ç™ºè¦‹**

**å•é¡Œã®åŸå› **:
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: `duration`ã‚’**ãƒŸãƒªç§’å˜ä½**ã§è¿”ã—ã¦ã„ã‚‹
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: `duration / 60`ã§åˆ†ã«å¤‰æ›ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹
- **çµæœ**: ãƒŸãƒªç§’ã‚’60ã§å‰²ã‚‹ã¨ã€æ­£ã—ã„åˆ†ã«ãªã‚‰ãªã„

**è¨ˆç®—ä¾‹**:
```
æ­£ã—ã„è¨ˆç®—:
973522ãƒŸãƒªç§’ Ã· 1000 Ã· 60 = 16.225åˆ† â‰ˆ 17åˆ† âœ…

ç¾åœ¨ã®è¨ˆç®—ï¼ˆé–“é•ã„ï¼‰:
973522ãƒŸãƒªç§’ Ã· 60 = 16225.37åˆ† âŒ
```

**å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿**:
- SyncStatusId 39: `duration` = 973522ãƒŸãƒªç§’ï¼ˆ17åˆ†ï¼‰
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¡¨ç¤º: `16225åˆ†`ï¼ˆé–“é•ã„ï¼‰

---

## ğŸ” è©³ç´°åˆ†æ

### 1. åŒæœŸãƒ‡ãƒ¼ã‚¿ã®å®Ÿéš›ã®çŠ¶æ…‹

| SyncStatusId | Status | StartDate | EndDate | DurationMinutes | å®Ÿéš›ã®æ‰€è¦æ™‚é–“ |
|--------------|--------|-----------|---------|----------------|--------------|
| 39 | completed | 2026-01-22 18:03:47 | 2026-01-22 18:20:01 | **17åˆ†** | æ­£å¸¸ |
| 37 | completed | 2026-01-22 17:58:37 | 2026-01-22 17:58:50 | **0åˆ†** | æ­£å¸¸ï¼ˆ13ç§’ï¼‰ |
| 23 | completed | 2026-01-20 01:58:04 | 2026-01-20 01:58:16 | **0åˆ†** | æ­£å¸¸ï¼ˆ11ç§’ï¼‰ |

**çµè«–**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åŒæœŸãƒ‡ãƒ¼ã‚¿ã¯æ­£å¸¸ã§ã™ã€‚å•é¡Œã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã«ã‚ã‚Šã¾ã™ã€‚

---

### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯

**ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰** (`frontend/src/app/setup/initial/page.tsx:777`):
```typescript
{history.duration && ` ï¼ˆæ‰€è¦æ™‚é–“: ${Math.floor(history.duration / 60)}åˆ†ï¼‰`}
```

**å•é¡Œç‚¹**:
- `duration`ã¯ãƒŸãƒªç§’å˜ä½ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰`TotalMilliseconds`ã§è¿”ã•ã‚Œã‚‹ï¼‰
- ãƒŸãƒªç§’ã‚’60ã§å‰²ã‚‹ã¨ã€æ­£ã—ã„åˆ†ã«ãªã‚‰ãªã„
- ä¾‹: 973522 Ã· 60 = 16225.37åˆ†ï¼ˆé–“é•ã„ï¼‰

---

### 3. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹

**ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰** (`backend/ShopifyAnalyticsApi/Controllers/SyncController.cs:376-377`):
```csharp
duration = s.EndDate.HasValue
    ? (int)(s.EndDate.Value - s.StartDate).TotalMilliseconds : 0,
```

**å•é¡Œç‚¹**:
- `duration`ãŒãƒŸãƒªç§’å˜ä½ã§è¿”ã•ã‚Œã¦ã„ã‚‹
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§æ­£ã—ãå¤‰æ›ã•ã‚Œã¦ã„ãªã„

---

## ğŸ”§ ä¿®æ­£æ¡ˆ

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§æ­£ã—ãå¤‰æ›ï¼ˆæ¨å¥¨ï¼‰

**ä¿®æ­£ç®‡æ‰€**: `frontend/src/app/setup/initial/page.tsx:777`

```typescript
// ä¿®æ­£å‰
{history.duration && ` ï¼ˆæ‰€è¦æ™‚é–“: ${Math.floor(history.duration / 60)}åˆ†ï¼‰`}

// ä¿®æ­£å¾Œ
{history.duration && ` ï¼ˆæ‰€è¦æ™‚é–“: ${Math.floor(history.duration / 1000 / 60)}åˆ†ï¼‰`}
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- æ—¢å­˜ã®APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒãªã„
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã¿ã®ä¿®æ­£ã§å¯¾å¿œå¯èƒ½

---

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰åˆ†å˜ä½ã§è¿”ã™

**ä¿®æ­£ç®‡æ‰€**: `backend/ShopifyAnalyticsApi/Controllers/SyncController.cs:376-377`

```csharp
// ä¿®æ­£å‰
duration = s.EndDate.HasValue
    ? (int)(s.EndDate.Value - s.StartDate).TotalMilliseconds : 0,

// ä¿®æ­£å¾Œ
duration = s.EndDate.HasValue
    ? (int)(s.EndDate.Value - s.StartDate).TotalMinutes : 0,
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å¤‰æ›ä¸è¦
- ã‚ˆã‚Šç›´æ„Ÿçš„ãªAPIãƒ¬ã‚¹ãƒãƒ³ã‚¹

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- æ—¢å­˜ã®APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ãŒå¤‰ã‚ã‚‹ï¼ˆäº’æ›æ€§ã®å•é¡Œï¼‰

---

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³3: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰ä¸¡æ–¹è¿”ã™ï¼ˆæœ€é©è§£ï¼‰

**ä¿®æ­£ç®‡æ‰€**: `backend/ShopifyAnalyticsApi/Controllers/SyncController.cs`

```csharp
duration = s.EndDate.HasValue
    ? (int)(s.EndDate.Value - s.StartDate).TotalMilliseconds : 0,
durationMinutes = s.EndDate.HasValue
    ? (int)(s.EndDate.Value - s.StartDate).TotalMinutes : 0,
```

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: `durationMinutes`ã‚’ä½¿ç”¨

```typescript
{history.durationMinutes && ` ï¼ˆæ‰€è¦æ™‚é–“: ${history.durationMinutes}åˆ†ï¼‰`}
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ãƒŸãƒªç§’ã¨åˆ†ã®ä¸¡æ–¹ã‚’æä¾›ï¼ˆæŸ”è»Ÿæ€§ï¼‰
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å¤‰æ›ä¸è¦
- æ—¢å­˜ã®`duration`ã‚‚ç¶­æŒï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰

---

## ğŸ“ æ¨å¥¨ä¿®æ­£æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ä¿®æ­£ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³3æ¨å¥¨ï¼‰

`backend/ShopifyAnalyticsApi/Controllers/SyncController.cs`ã‚’ä¿®æ­£:

```csharp
.Select(s => new
{
    id = s.Id.ToString(),
    type = string.IsNullOrEmpty(s.EntityType) || s.EntityType == "All" ? "all" : s.EntityType.ToLower() + "s",
    status = s.Status == "completed" ? "success" :
            s.Status == "failed" ? "error" :
            s.Status == "running" ? "syncing" : "warning",
    startedAt = s.StartDate.ToString("o"),
    completedAt = s.EndDate.HasValue ? s.EndDate.Value.ToString("o") : null,
    duration = s.EndDate.HasValue
        ? (int)(s.EndDate.Value - s.StartDate).TotalMilliseconds : 0,
    durationMinutes = s.EndDate.HasValue  // ğŸ†• è¿½åŠ 
        ? (int)(s.EndDate.Value - s.StartDate).TotalMinutes : 0,
    recordsProcessed = s.ProcessedRecords ?? 0,
    message = s.ErrorMessage ?? (s.Status == "completed" ?
        $"{s.EntityType ?? "å…¨ãƒ‡ãƒ¼ã‚¿"}ã®åŒæœŸãŒå®Œäº†ã—ã¾ã—ãŸ" : null),
    error = s.Status == "failed" ? s.ErrorMessage : null
})
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å‹å®šç¾©ã‚’æ›´æ–°

`frontend/src/app/setup/initial/page.tsx`ã®`SyncHistory`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æ›´æ–°:

```typescript
interface SyncHistory {
  id: string
  startTime: string
  endTime?: string
  status: 'running' | 'completed' | 'failed'
  recordsProcessed: number
  syncType: 'initial' | 'manual' | 'scheduled'
  duration?: number
  durationMinutes?: number  // ğŸ†• è¿½åŠ 
}
```

### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®è¡¨ç¤ºã‚’ä¿®æ­£

`frontend/src/app/setup/initial/page.tsx:777`ã‚’ä¿®æ­£:

```typescript
// ä¿®æ­£å‰
{history.duration && ` ï¼ˆæ‰€è¦æ™‚é–“: ${Math.floor(history.duration / 60)}åˆ†ï¼‰`}

// ä¿®æ­£å¾Œ
{history.durationMinutes && ` ï¼ˆæ‰€è¦æ™‚é–“: ${history.durationMinutes}åˆ†ï¼‰`}
```

---

## âœ… ä¿®æ­£å¾Œã®æœŸå¾…çµæœ

| åŒæœŸID | å®Ÿéš›ã®æ‰€è¦æ™‚é–“ | ä¿®æ­£å‰ã®è¡¨ç¤º | ä¿®æ­£å¾Œã®è¡¨ç¤º |
|--------|--------------|------------|------------|
| 39 | 17åˆ† | 16225åˆ† âŒ | 17åˆ† âœ… |
| 37 | 0åˆ†ï¼ˆ13ç§’ï¼‰ | 0åˆ† âœ… | 0åˆ† âœ… |
| 23 | 0åˆ†ï¼ˆ11ç§’ï¼‰ | 0åˆ† âœ… | 0åˆ† âœ… |

---

## ğŸ”— é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `backend/ShopifyAnalyticsApi/Controllers/SyncController.cs` (376-377è¡Œç›®)
- `frontend/src/app/setup/initial/page.tsx` (777è¡Œç›®)
- `docs/05-development/08-ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒˆãƒ©ãƒ–ãƒ«/01-problem-analysis/2026-01/2026-01-23-StoreId19-åŒæœŸæ™‚åˆ»ä¸ä¸€è‡´èª¿æŸ»SQL.sql`

---

## ğŸ“ æ›´æ–°å±¥æ­´

- 2026-01-23: åˆç‰ˆä½œæˆï¼ˆèª¿æŸ»çµæœã¨ä¿®æ­£æ¡ˆï¼‰
