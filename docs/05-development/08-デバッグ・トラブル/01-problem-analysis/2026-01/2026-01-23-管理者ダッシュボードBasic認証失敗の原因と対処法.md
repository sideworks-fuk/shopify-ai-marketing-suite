# ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰Basicèªè¨¼å¤±æ•—ã®åŸå› ã¨å¯¾å‡¦æ³•

## ğŸ“‹ å•é¡Œæ¦‚è¦

æœ¬ç•ªç’°å¢ƒã§ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆ`/admin`ï¼‰ã«`admin`/`Admin2025!`ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„ã€‚

## ğŸ” åŸå› 

### è¨­å®šã®å„ªå…ˆé †ä½ã®å•é¡Œ

`AdminBasicAuthMiddleware`ã¯ä»¥ä¸‹ã®å„ªå…ˆé †ä½ã§èªè¨¼æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ï¼š

1. `Admin:BasicAuth:Username` / `Admin:BasicAuth:Password`
2. `Swagger:BasicAuth:Username` / `Swagger:BasicAuth:Password`
3. `Hangfire:Dashboard:Username` / `Hangfire:Dashboard:Password`
4. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆ`admin` / `Admin2025!`ï¼‰

### å•é¡Œã®è©³ç´°

`appsettings.Production.json`ã«ã¯ä»¥ä¸‹ã®è¨­å®šãŒã‚ã‚Šã¾ã™ï¼š

```json
{
  "Swagger": {
    "BasicAuth": {
      "Username": "admin",
      "Password": "Will be overridden by environment variable"
    }
  },
  "Hangfire": {
    "Dashboard": {
      "Username": "admin",
      "Password": "Will be overridden by environment variable"
    }
  }
}
```

**å•é¡Œç‚¹**:
- `Admin:BasicAuth`ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„
- `Swagger:BasicAuth:Password`ãŒ`"Will be overridden by environment variable"`ã¨ã„ã†æ–‡å­—åˆ—
- ã“ã®æ–‡å­—åˆ—ãŒæœŸå¾…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ã—ã¦ä½¿ã‚ã‚Œã€`Admin2025!`ã¨ä¸€è‡´ã—ãªã„

## âœ… è§£æ±ºç­–

### ä¿®æ­£å†…å®¹

`AdminBasicAuthMiddleware`ã«`GetConfigValue`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã€ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼æ–‡å­—åˆ—ï¼ˆ`"Will be overridden by environment variable"`ï¼‰ã‚’ç„¡è¦–ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

```csharp
private string GetConfigValue(string? adminValue, string? swaggerValue, string? hangfireValue, string defaultValue)
{
    // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼æ–‡å­—åˆ—ã‚’ç„¡è¦–
    var placeholderStrings = new[] 
    { 
        "Will be overridden by environment variable",
        "will be overridden by environment variable",
        "WILL BE OVERRIDDEN BY ENVIRONMENT VARIABLE"
    };
    
    if (!string.IsNullOrEmpty(adminValue) && !placeholderStrings.Contains(adminValue))
        return adminValue;
    
    if (!string.IsNullOrEmpty(swaggerValue) && !placeholderStrings.Contains(swaggerValue))
        return swaggerValue;
    
    if (!string.IsNullOrEmpty(hangfireValue) && !placeholderStrings.Contains(hangfireValue))
        return hangfireValue;
    
    return defaultValue;
}
```

ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼æ–‡å­—åˆ—ã¯ç„¡è¦–ã•ã‚Œã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆ`admin` / `Admin2025!`ï¼‰ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

### æ¨å¥¨ã•ã‚Œã‚‹è¨­å®šæ–¹æ³•

#### æ–¹æ³•1: ç’°å¢ƒå¤‰æ•°ã§è¨­å®šï¼ˆæ¨å¥¨ï¼‰

Azure App Serviceã®è¨­å®šã§ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ ï¼š

```
Admin__BasicAuth__Username=admin
Admin__BasicAuth__Password=your-secure-password-here
```

#### æ–¹æ³•2: appsettings.Production.jsonã«è¿½åŠ 

```json
{
  "Admin": {
    "BasicAuth": {
      "Username": "admin",
      "Password": "your-secure-password-here"
    }
  }
}
```

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### èªè¨¼ãŒå¤±æ•—ã™ã‚‹å ´åˆã®ç¢ºèªäº‹é …

1. **ãƒ­ã‚°ã‚’ç¢ºèª**
   - Application Insightsã¾ãŸã¯ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã§ä»¥ä¸‹ã®ãƒ­ã‚°ã‚’ç¢ºèªï¼š
     - `Admin Basic authentication failed for path: {Path}, Username: {Username}`
     - `Admin Basic auth check - Username: {Username}, ExpectedUsername: {ExpectedUsername}, Password match: {PasswordMatch}`

2. **è¨­å®šå€¤ã‚’ç¢ºèª**
   - Azure Portal â†’ App Service â†’ æ§‹æˆ â†’ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
   - `Admin__BasicAuth__Username`ã¨`Admin__BasicAuth__Password`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

3. **HTTPSæ¥ç¶šã‚’ç¢ºèª**
   - Cookieã®`Secure`ãƒ•ãƒ©ã‚°ãŒæœ‰åŠ¹ãªãŸã‚ã€HTTPSæ¥ç¶šãŒå¿…é ˆ
   - HTTPã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹å ´åˆã€CookieãŒè¨­å®šã•ã‚Œãªã„

4. **ãƒ–ãƒ©ã‚¦ã‚¶ã®Cookieã‚’ç¢ºèª**
   - é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§`admin_auth_session`CookieãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - CookieãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€èªè¨¼ãŒå¤±æ•—ã—ã¦ã„ã‚‹å¯èƒ½æ€§

## ğŸ“ é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `backend/ShopifyAnalyticsApi/Middleware/AdminBasicAuthMiddleware.cs`
- `backend/ShopifyAnalyticsApi/appsettings.Production.json`
- `docs/05-development/08-ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒˆãƒ©ãƒ–ãƒ«/04-troubleshooting/ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä½¿ç”¨æ–¹æ³•.md`

## ğŸ”„ ä¿®æ­£æ—¥æ™‚

2026-01-23
