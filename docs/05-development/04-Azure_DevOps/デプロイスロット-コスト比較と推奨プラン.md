# デプロイスロット - コスト比較と推奨プラン

## 📋 概要

デプロイスロットを使用するには、**Standardプラン以上**が必要です。コストを抑えつつデプロイスロットを使用できる最小のプランは**Standard S1**です。

---

## 💰 コスト比較（2026年1月時点）

### 現在のプラン（Basic B1）

| 項目 | 値 |
|------|-----|
| **プラン名** | Basic B1 |
| **月額コスト** | 約$62.05（約9,300円） |
| **時間あたり** | $0.085 |
| **vCPU** | 1 |
| **メモリ** | 1.75 GB |
| **リモート記憶域** | 10 GB |
| **スケール（インスタンス）** | 最大3インスタンス |
| **SLA** | 99.95% |
| **デプロイスロット** | ❌ 利用不可 |

---

### デプロイスロット対応プラン（最小構成）

#### Standard S1（推奨・最小構成）

| 項目 | 値 |
|------|-----|
| **プラン名** | Standard S1 |
| **月額コスト** | 約$77.38（約11,600円） |
| **時間あたり** | $0.106 |
| **vCPU** | 1 |
| **メモリ** | 1.75 GB |
| **リモート記憶域** | 50 GB |
| **スケール（インスタンス）** | 最大10インスタンス |
| **SLA** | 99.95% |
| **デプロイスロット** | ✅ 5スロット利用可能 |
| **追加コスト** | 約$15.33/月（約2,300円/月） |

**メリット**:
- ✅ デプロイスロットが利用可能（ゼロダウンタイムデプロイ）
- ✅ リモート記憶域が10GB → 50GBに増加
- ✅ スケール可能なインスタンス数が3 → 10に増加
- ✅ カスタムドメインのSSL証明書（無料）
- ✅ 自動バックアップ機能

---

#### Premium v3 P0V3（高性能オプション）

| 項目 | 値 |
|------|-----|
| **プラン名** | Premium v3 P0V3 |
| **月額コスト** | 約$132.50（約19,900円） |
| **時間あたり** | $0.182 |
| **vCPU** | 1 |
| **メモリ** | 4 GB |
| **リモート記憶域** | 250 GB |
| **スケール（インスタンス）** | 最大30インスタンス |
| **SLA** | 99.95% |
| **デプロイスロット** | ✅ 20スロット利用可能 |
| **追加コスト** | 約$70.45/月（約10,600円/月） |

**メリット**:
- ✅ より高いパフォーマンス（ACU/vCPU: 195）
- ✅ より多くのメモリ（4 GB）
- ✅ より多くのリモート記憶域（250 GB）
- ✅ より多くのデプロイスロット（20スロット）

**デメリット**:
- ⚠️ コストが約2倍

---

## 📊 コスト比較表

| プラン | 月額コスト | 追加コスト | デプロイスロット | 推奨度 |
|--------|-----------|-----------|----------------|--------|
| **Basic B1**（現在） | $62.05 | - | ❌ 利用不可 | - |
| **Standard S1** | $77.38 | +$15.33 | ✅ 5スロット | ⭐⭐⭐ 推奨 |
| **Standard S2** | $154.76 | +$92.71 | ✅ 5スロット | ⭐⭐ |
| **Premium v3 P0V3** | $132.50 | +$70.45 | ✅ 20スロット | ⭐ |

---

## 🎯 推奨プラン: Standard S1

### 理由

1. **最小コストでデプロイスロットを利用可能**
   - 追加コスト: 約$15.33/月（約2,300円/月）
   - Basic B1と比較して約25%のコスト増

2. **十分な機能**
   - デプロイスロット: 5スロット（通常は1-2スロットで十分）
   - リモート記憶域: 50GB（Basic B1の5倍）
   - スケール可能: 最大10インスタンス（Basic B1の約3倍）

3. **パフォーマンス**
   - vCPU: 1（Basic B1と同じ）
   - メモリ: 1.75 GB（Basic B1と同じ）
   - 現在のワークロードで十分

---

## 🔄 アップグレード手順

### ステップ1: App Serviceプランを確認

1. **Azure Portalを開く**
   - https://portal.azure.com

2. **App Serviceを開く**
   - リソースグループ: `ec-ranger-prod`
   - App Service: `ec-ranger-backend-prod-ghf3bbarghcwh4gn`

3. **App Serviceプランを確認**
   - 左メニュー → 「設定」→ 「App Service プラン」
   - 現在のプラン名を確認（例: `ec-ranger-backend-prod-plan`）

---

### ステップ2: プランをアップグレード

1. **App Serviceプランを開く**
   - App Serviceの「設定 → App Service プラン」から直接リンクをクリック

2. **スケールアップを選択**
   - 左メニュー → 「スケールアップ (App Service プラン)」

3. **Standard S1を選択**
   - 「実稼働」セクション → 「Standard S1」を選択
   - または「レガシ」セクション → 「Standard S1」を選択

4. **適用をクリック**
   - 確認ダイアログで「はい」をクリック
   - アップグレードには数分かかります

---

### ステップ3: デプロイスロットを作成

1. **App Serviceに戻る**
   - ブラウザの戻るボタン、またはリソースグループからApp Serviceを開く

2. **デプロイスロットを作成**
   - 左メニュー → 「デプロイ」→ 「デプロイ スロット」
   - 「+ 追加」をクリック

3. **スロット情報を入力**
   ```
   名前: staging
   構成ソース: 現在の本番スロットから複製
   ```

4. **追加をクリック**
   - スロットが作成されるまで待機（数分）

---

### ステップ4: GitHub Secretsの設定

1. **ステージングスロット用のPublish Profileを取得**
   - デプロイスロット一覧で`staging`をクリック
   - 「概要」→ 「発行プロファイルのダウンロード」
   - `.PublishSettings`ファイルの内容をコピー

2. **GitHub Secretsに追加**
   - GitHub → Settings → Secrets and variables → Actions
   - 新しいシークレットを追加:
     ```
     名前: AZURE_WEBAPP_PUBLISH_PROFILE_PRODUCTION_STAGING
     値: [ダウンロードしたPublish Profileの内容]
     ```

3. **Azure認証情報の設定**（既に設定済みの場合はスキップ）
   ```
   名前: AZURE_CREDENTIALS
   値: [サービスプリンシパルのJSON形式の認証情報]
   ```

---

## 💡 コスト最適化のヒント

### 1. リザーブドインスタンスの使用

**1年コミット**:
- 約20%の割引
- 月額: 約$62（約9,300円）→ 約$50（約7,500円）

**3年コミット**:
- 約40%の割引
- 月額: 約$62（約9,300円）→ 約$37（約5,600円）

**注意**: リザーブドインスタンスは長期コミットが必要

---

### 2. 開発環境の分離

**推奨構成**:
- **本番環境**: Standard S1（デプロイスロット使用）
- **開発環境**: Basic B1（デプロイスロット不要）

**コスト削減**:
- 開発環境でStandard S1を使用しないことで、コストを削減

---

### 3. 自動スケーリングの設定

Standard S1では、自動スケーリングが利用可能です。

**設定例**:
- **最小インスタンス**: 1
- **最大インスタンス**: 3-5（必要に応じて）
- **スケールアウト条件**: CPU使用率 > 70%
- **スケールイン条件**: CPU使用率 < 30%

**メリット**:
- 通常時は1インスタンスでコストを最小化
- 負荷が高い時だけスケールアウト

---

## 📈 コスト試算（年間）

### Basic B1（現在）
- **月額**: $62.05
- **年間**: $744.60（約111,700円）

### Standard S1（推奨）
- **月額**: $77.38
- **年間**: $928.56（約139,300円）
- **追加コスト**: $183.96/年（約27,600円/年）

### リザーブドインスタンス（1年コミット）
- **月額**: 約$62（約20%割引）
- **年間**: 約$744（約111,600円）
- **追加コスト**: ほぼゼロ（Basic B1と同等）

---

## ✅ 推奨事項

### 短期（1-3ヶ月）

**推奨**: **Standard S1**にアップグレード

**理由**:
- 追加コスト: 約$15/月（約2,300円/月）
- デプロイスロットが利用可能
- ゼロダウンタイムデプロイが可能
- ファイルロック問題を完全に解決

---

### 中期（3-12ヶ月）

**推奨**: **Standard S1 + リザーブドインスタンス（1年コミット）**

**理由**:
- 約20%の割引で、Basic B1とほぼ同等のコスト
- デプロイスロットが利用可能
- 長期運用に適している

---

### 長期（1年以上）

**推奨**: **Standard S1 + リザーブドインスタンス（3年コミット）**

**理由**:
- 約40%の割引で、Basic B1より安い
- デプロイスロットが利用可能
- 最もコスト効率が良い

---

## 🚨 注意事項

### 1. アップグレードの影響

- **ダウンタイム**: プランの変更中に短時間のダウンタイムが発生する可能性があります
- **推奨時間**: メンテナンス時間帯（深夜など）に実施することを推奨

---

### 2. ダウングレードの制限

- **Standard → Basic**: 可能ですが、デプロイスロットが削除されます
- **データ損失**: デプロイスロット内のデータは失われます

---

### 3. リザーブドインスタンスの注意点

- **コミット期間**: 1年または3年のコミットが必要
- **キャンセル**: コミット期間中はキャンセルできない
- **プラン変更**: 同じプラン内でのサイズ変更は可能

---

## 📝 決定フローチャート

```
現在: Basic B1
  ↓
デプロイスロットが必要？
  ├─ NO → Basic B1を継続（app_offline.htmを使用）
  └─ YES → Standard S1にアップグレード
            ↓
            長期運用（1年以上）？
            ├─ NO → Standard S1（従量課金）
            └─ YES → Standard S1 + リザーブドインスタンス（3年コミット）
```

---

## 📚 関連ドキュメント

- [デプロイスロット-プラン要件とアップグレード手順](./デプロイスロット-プラン要件とアップグレード手順.md)
- [デプロイスロットを使用した本番デプロイ方法](../08-デバッグ・トラブル/01-problem-analysis/2026-01/2026-01-19-デプロイスロットを使用した本番デプロイ方法.md)
- [app_offline.htmを使用したデプロイ対策](./app_offline-htm-デプロイ対策.md)

---

**最終更新**: 2026年1月19日  
**作成者**: 福田  
**修正者**: AI Assistant
