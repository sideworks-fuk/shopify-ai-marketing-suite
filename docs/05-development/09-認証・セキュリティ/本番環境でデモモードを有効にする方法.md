# 本番環境でデモモードを有効にする方法

## 概要

本番環境では、セキュリティ上の理由からデフォルトでデモモードが無効になっています。デモモードを有効にするには、環境変数で明示的に許可する必要があります。

## 設定手順

### 1. Azure App Service の環境変数を設定

Azure Portal または Azure CLI を使用して、以下の環境変数を設定します：

```bash
# Azure CLI の場合
az webapp config appsettings set \
  --name <アプリ名> \
  --resource-group <リソースグループ名> \
  --settings \
    Authentication__Mode="DemoAllowed" \
    Authentication__AllowDemoInProduction="true"
```

### 2. 環境変数の説明

- **`Authentication__Mode`**: 認証モードを `"DemoAllowed"` に設定
- **`Authentication__AllowDemoInProduction`**: 本番環境でデモモードを許可するフラグ（`"true"` に設定）

### 3. セキュリティ上の注意事項

⚠️ **重要**: 本番環境でデモモードを有効にすることは、セキュリティリスクを伴います。

- デモモードは認証が緩いため、本番環境での使用は推奨されません
- デモモードはテスト・デモ目的でのみ使用してください
- 本番環境でデモモードを使用する場合は、適切なアクセス制御と監視を実施してください

### 4. 動作確認

環境変数を設定後、アプリケーションを再起動し、デモモードでログインできることを確認してください。

## トラブルシューティング

### デモモードでログインできない場合

1. **環境変数が正しく設定されているか確認**
   ```bash
   az webapp config appsettings list \
     --name <アプリ名> \
     --resource-group <リソースグループ名> \
     --query "[?name=='Authentication__Mode' || name=='Authentication__AllowDemoInProduction']"
   ```

2. **アプリケーションログを確認**
   - `Authentication:AllowDemoInProduction` が `true` になっているか
   - `Authentication:Mode` が `DemoAllowed` になっているか
   - エラーメッセージがないか

3. **アプリケーションを再起動**
   - 環境変数の変更は、アプリケーションの再起動が必要な場合があります

## 関連ドキュメント

- [認証システムの概要](../09-認証・セキュリティ/README.md)
- [デモモード認証の仕様](../09-認証・セキュリティ/デモモード認証仕様.md)
