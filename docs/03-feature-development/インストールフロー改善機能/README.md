# インストールフロー改善機能

## 概要
Shopifyアプリのインストールフローに関する設計、実装、問題調査のドキュメントをまとめています。

---

## 📁 ドキュメント構成

### 設計・要件定義
- [インストール機能設計書.md](./インストール機能設計書.md) ⭐ **最新**

### 調査・デバッグ
- [インストール機能-調査対象シーケンス.md](./インストール機能-調査対象シーケンス.md) ⭐ **新規**
- [インストール機能-ソースコード洗い出し.md](./インストール機能-ソースコード洗い出し.md) ⭐ **新規**
- [インストール機能-トラブルシューティング.md](./インストール機能-トラブルシューティング.md) ⭐ **新規**

### 技術解説
- [スコープ設定方法ガイド.md](./スコープ設定方法ガイド.md) ⭐ **最新**

---

## 🔍 現状の問題

### 症状
1. ルートページ（`/`）で「認証状態を確認中...」と表示されたまま進まない
2. `Stores`テーブルにレコードが作成されない
3. 401エラーが発生する（`/api/store`、`/api/subscription/status`など）
4. トークン暗号化エラーが発生する（`Error occurred during token encryption`）
5. hostパラメータのデコード失敗が発生する（`hostパラメータのデコードに失敗`）

### 調査方法
- [インストール機能-調査対象シーケンス.md](./インストール機能-調査対象シーケンス.md)を参照
  - OAuth認証フロー全体の各ステップでの確認ポイント
  - 調査手順とログ確認方法
  - 調査結果の記録方法

### ソースコード調査
- [インストール機能-ソースコード洗い出し.md](./インストール機能-ソースコード洗い出し.md)を参照
  - 各ステップで使用されるソースコードの一覧
  - 調査・リファクタ対象の優先度
  - 調査チェックリスト

---

## 🚀 次のステップ

### 調査・対応手順

1. **調査対象シーケンスの確認**
   - [インストール機能-調査対象シーケンス.md](./インストール機能-調査対象シーケンス.md)を参照
   - OAuth認証フロー全体の各ステップでの確認ポイントを確認

2. **ソースコードの洗い出し**
   - [インストール機能-ソースコード洗い出し.md](./インストール機能-ソースコード洗い出し.md)を参照
   - 各ステップで使用されるソースコードを確認

3. **調査の実施**
   - ブラウザの開発者ツールで確認（Network、Console、Applicationタブ）
   - バックエンドのログを確認（Application Insightsまたはログファイル）
   - データベースを確認（`Stores`、`ShopifyApps`、`Subscriptions`テーブル）

4. **調査結果の記録**
   - 各ステップでの調査結果を記録
   - 問題点を特定
   - 対応策を提案

5. **対応策の実装**
   - 問題点を修正
   - 動作確認

---

## 📚 関連ドキュメント

### トラブルシューティング
- [インストール機能-トラブルシューティング.md](./インストール機能-トラブルシューティング.md) ⭐ **新規**
  - 症状別フローチャート
  - よくある問題と解決策
  - ログ確認のポイント

### デバッグ・トラブルシューティング（アーカイブ）
以下のドキュメントは `docs/05-development/08-デバッグ・トラブル/01-problem-analysis/2025-12/` にあります：

- [インストール関連ソースファイル一覧.md](../../../05-development/08-デバッグ・トラブル/01-problem-analysis/2025-12/インストール関連ソースファイル一覧.md)
- [インストールフロー問題の根本原因調査.md](../../../05-development/08-デバッグ・トラブル/01-problem-analysis/2025-12/インストールフロー問題の根本原因調査.md)
- [インストールフロー問題の詳細デバッグ手順.md](../../../05-development/08-デバッグ・トラブル/01-problem-analysis/2025-12/インストールフロー問題の詳細デバッグ手順.md)
- [インストールフロー問題のデバッグ手順.md](../../../05-development/08-デバッグ・トラブル/01-problem-analysis/2025-12/インストールフロー問題のデバッグ手順.md)

### OAuth認証
- [OAuth認証機能/アプリインストールガイド.md](../OAuth認証機能/アプリインストールガイド.md)

### マルチアプリ対応
- [マルチアプリ対応/インストール時のAPI Key判定方法.md](../マルチアプリ対応/インストール時のAPI Key判定方法.md)

---

## 📝 更新履歴

- 2025-12-29: README作成
- 2025-12-29: 設計書を最新のソースコードに合わせて修正
- 2025-12-29: スコープ設定方法ガイドを更新（`shopify.app.toml`は現在使用していないことを明記）
- 2025-12-29: 調査対象シーケンスドキュメントを作成
- 2025-12-29: ソースコード洗い出しドキュメントを作成
- 2025-12-29: トラブルシューティングガイドを作成
- 2025-12-29: 設計書に問題4・問題5を追記（トークン暗号化エラー、hostパラメータデコード失敗）
- 2025-12-29: 調査対象シーケンスに環境設定確認項目を追加
- 2025-12-29: ソースコード洗い出しにデバッグ用ログ追加ガイドとリファクタ計画を追加
