# インストールフロー改善機能

## 概要
Shopifyアプリのインストールフローに関する設計、実装、問題調査のドキュメントをまとめています。

---

## 📁 ドキュメント構成

### 設計・要件定義
- [Shopify-インストールフロー改善-要件定義.md](./Shopify-インストールフロー改善-要件定義.md)
- [Shopify-インストールフロー改善-設計書.md](./Shopify-インストールフロー改善-設計書.md)
- [現状のインストール機能設計書.md](./現状のインストール機能設計書.md) ⭐ **最新**

### 実装計画
- [Shopify-インストールフロー改善-実装計画.md](./Shopify-インストールフロー改善-実装計画.md)

### テスト計画
- [Shopify-インストールフロー改善-テスト計画.md](./Shopify-インストールフロー改善-テスト計画.md)

### 問題調査・対応
- [問題調査・対応計画.md](./問題調査・対応計画.md)
- [現状設計の問題点と修正方針.md](./現状設計の問題点と修正方針.md) ⭐ **最新**

### 技術解説
- [shopify.app.toml-デプロイ解説.md](./shopify.app.toml-デプロイ解説.md) ⭐ **新規**
- [スコープ設定方法ガイド.md](./スコープ設定方法ガイド.md) ⭐ **新規**
- [Phase1-テスト手順.md](./Phase1-テスト手順.md) ⭐ **新規**

---

## 🔍 現状の問題

### 症状
1. ルートページ（`/`）で「認証状態を確認中...」と表示されたまま進まない
2. `Stores`テーブルにレコードが作成されない
3. 401エラーが発生する（`/api/store`、`/api/subscription/status`など）

### 調査状況
- [問題調査・対応計画.md](./問題調査・対応計画.md)を参照

### 設計上の問題点
- [現状設計の問題点と修正方針.md](./現状設計の問題点と修正方針.md)を参照
  - Shopify公式ドキュメントとの比較
  - 7つの主要な問題点
  - 修正方針と実装手順

---

## 📚 関連ドキュメント

### デバッグ・トラブルシューティング
以下のドキュメントは `docs/05-development/08-デバッグ・トラブル/01-problem-analysis/2025-12/` にあります：

- [インストール関連ソースファイル一覧.md](../../../05-development/08-デバッグ・トラブル/01-problem-analysis/2025-12/インストール関連ソースファイル一覧.md)
- [インストールフロー問題の根本原因調査.md](../../../05-development/08-デバッグ・トラブル/01-problem-analysis/2025-12/インストールフロー問題の根本原因調査.md)
- [インストールフロー問題の詳細デバッグ手順.md](../../../05-development/08-デバッグ・トラブル/01-problem-analysis/2025-12/インストールフロー問題の詳細デバッグ手順.md)
- [インストールフロー問題のデバッグ手順.md](../../../05-development/08-デバッグ・トラブル/01-problem-analysis/2025-12/インストールフロー問題のデバッグ手順.md)

### OAuth認証
- [OAuth認証機能/アプリインストールガイド.md](../OAuth認証機能/アプリインストールガイド.md)

### マルチアプリ対応
- [マルチアプリ対応/インストール時のAPI Key判定方法.md](../マルチアプリ対応/インストール時のAPI Key判定方法.md)

---

## 🚀 次のステップ

### 即座に修正すべき項目（優先度: 高）

1. **リダイレクトURIの統一**
   - バックエンドURLを常に使用
   - Shopify Partners Dashboardの設定を確認

2. **ExitIframeページの追加**
   - iframe脱出処理を正しく実装

3. **バックエンドのリダイレクト先の修正**
   - 埋め込みアプリURLに正しくリダイレクト

詳細は [現状設計の問題点と修正方針.md](./現状設計の問題点と修正方針.md) を参照

### 調査・対応

1. [問題調査・対応計画.md](./問題調査・対応計画.md)に従って調査を実施
2. 調査結果を記録
3. 根本原因を特定
4. 対応策を実装
5. 動作確認

---

## 📝 更新履歴

- 2025-12-26: README作成、現状の設計書と調査計画を追加
- 2025-12-26: 現状設計の問題点と修正方針を追加（Shopify公式ドキュメントとの比較）
- 2025-12-26: shopify.app.tomlのデプロイ解説ドキュメントを追加
- 2025-12-26: スコープ設定方法ガイドを追加（Shopify Partners Dashboardでの設定方法を含む）
- 2025-12-26: Phase1-テスト手順を追加（開発環境からローカルバックエンドへの接続テスト手順）
