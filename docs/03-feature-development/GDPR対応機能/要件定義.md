# GDPRå¯¾å¿œæ©Ÿèƒ½ - è¦ä»¶å®šç¾©

**ä½œæˆæ—¥**: 2025-12-31
**æœ€çµ‚æ›´æ–°**: 2025-12-31
**èƒŒæ™¯**: Shopifyå…¬é–‹ã‚¢ãƒ—ãƒªã¨ã—ã¦ç”³è«‹ã™ã‚‹ãŸã‚ã«å¿…é ˆ

---

## 1. æ¦‚è¦

### 1.1 GDPRã¨ã¯

GDPRï¼ˆGeneral Data Protection Regulationï¼‰ã¯ã€EUä¸€èˆ¬ãƒ‡ãƒ¼ã‚¿ä¿è­·è¦å‰‡ã§ã‚ã‚Šã€å€‹äººãƒ‡ãƒ¼ã‚¿ã®ä¿è­·ã¨ç§»å‹•ã«é–¢ã™ã‚‹æ³•çš„æ çµ„ã¿ã§ã™ã€‚Shopifyã‚¢ãƒ—ãƒªã¯ã€GDPRã«æº–æ‹ ã™ã‚‹ãŸã‚ã«ç‰¹å®šã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### 1.2 ShopifyãŒæ±‚ã‚ã‚‹GDPRå¯¾å¿œ

Shopifyã¯**ã™ã¹ã¦ã®å…¬é–‹ã‚¢ãƒ—ãƒª**ã«å¯¾ã—ã€ä»¥ä¸‹ã®å¯¾å¿œã‚’å¿…é ˆã¨ã—ã¦ã„ã¾ã™ï¼š

1. **å¿…é ˆWebhookï¼ˆ3ç¨®ï¼‰** ã®å®Ÿè£…
2. **app/uninstalled Webhook** ã®å®Ÿè£…
3. **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼** ã®å…¬é–‹
4. **ãƒ‡ãƒ¼ã‚¿å‰Šé™¤æœŸé™** ã®éµå®ˆ

---

## 2. å¿…é ˆWebhookä¸€è¦§

### 2.1 Webhookæ¦‚è¦è¡¨

| Webhook | ç›®çš„ | å¿œç­”æœŸé™ | ãƒ‡ãƒ¼ã‚¿å‡¦ç†æœŸé™ | å„ªå…ˆåº¦ |
|---------|------|---------|---------------|--------|
| `app/uninstalled` | ã‚¢ãƒ—ãƒªã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«é€šçŸ¥ | 5ç§’ | 48æ™‚é–“ä»¥å†…ã«ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ | æœ€é«˜ |
| `customers/redact` | é¡§å®¢ãƒ‡ãƒ¼ã‚¿å‰Šé™¤è¦æ±‚ | 5ç§’ | 30æ—¥ä»¥å†…ã«å‰Šé™¤å®Œäº† | é«˜ |
| `shop/redact` | ã‚·ãƒ§ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿å‰Šé™¤è¦æ±‚ | 5ç§’ | 90æ—¥ä»¥å†…ã«å‰Šé™¤å®Œäº† | é«˜ |
| `customers/data_request` | é¡§å®¢ãƒ‡ãƒ¼ã‚¿é–‹ç¤ºè¦æ±‚ | 5ç§’ | 10æ—¥ä»¥å†…ã«ãƒ‡ãƒ¼ã‚¿æä¾› | ä¸­ |

### 2.2 å„Webhookã®è©³ç´°

#### 2.2.1 app/uninstalled

**ãƒˆãƒªã‚¬ãƒ¼**: ã‚¹ãƒˆã‚¢ã‚ªãƒ¼ãƒŠãƒ¼ãŒã‚¢ãƒ—ãƒªã‚’ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

**å¿…é ˆå¯¾å¿œ**:
- ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å³åº§ã«ç„¡åŠ¹åŒ–
- ã‚¹ãƒˆã‚¢ãƒ‡ãƒ¼ã‚¿ã‚’48æ™‚é–“ä»¥å†…ã«å‰Šé™¤
- èª²é‡‘ã‚’åœæ­¢

**ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ä¾‹**:
```json
{
  "id": 123456789,
  "name": "Example Shop",
  "email": "shop@example.com",
  "domain": "example.myshopify.com",
  "created_at": "2023-01-01T00:00:00Z"
}
```

#### 2.2.2 customers/redact

**ãƒˆãƒªã‚¬ãƒ¼**: é¡§å®¢ãŒã‚¹ãƒˆã‚¢ã«å¯¾ã—ã¦ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã‚’è¦æ±‚

**å¿…é ˆå¯¾å¿œ**:
- æŒ‡å®šã•ã‚ŒãŸé¡§å®¢ã®å€‹äººæƒ…å ±ã‚’å‰Šé™¤
- é–¢é€£ã™ã‚‹æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã®å€‹äººæƒ…å ±ã‚’åŒ¿ååŒ–
- 30æ—¥ä»¥å†…ã«å®Œäº†

**ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ä¾‹**:
```json
{
  "shop_id": 954889,
  "shop_domain": "example.myshopify.com",
  "customer": {
    "id": 191167,
    "email": "john@example.com",
    "phone": "+16135551111"
  },
  "orders_to_redact": [299938, 280263]
}
```

#### 2.2.3 shop/redact

**ãƒˆãƒªã‚¬ãƒ¼**: ã‚¹ãƒˆã‚¢ãŒShopifyã‹ã‚‰å‰Šé™¤ã•ã‚Œã‚‹ã‹ã€ã‚¹ãƒˆã‚¢ã‚ªãƒ¼ãƒŠãƒ¼ãŒãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã‚’è¦æ±‚

> âš ï¸ **é‡è¦**: ã“ã®Webhookã¯**ã‚¢ãƒ—ãƒªã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œ48æ™‚é–“å¾Œ**ã«Shopifyã‹ã‚‰é€ä¿¡ã•ã‚Œã¾ã™ã€‚
> ã¤ã¾ã‚Šã€`app/uninstalled` å—ä¿¡æ™‚ã§ã¯ãªãã€`shop/redact` å—ä¿¡æ™‚ã«ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã‚’é–‹å§‹ã—ã¾ã™ã€‚

**å¿…é ˆå¯¾å¿œ**:
- ã‚¹ãƒˆã‚¢ã«é–¢é€£ã™ã‚‹ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
- 90æ—¥ä»¥å†…ã«å®Œäº†ï¼ˆWebhookå—ä¿¡å¾Œã‹ã‚‰èµ·ç®—ï¼‰

**ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ä¾‹**:
```json
{
  "shop_id": 954889,
  "shop_domain": "example.myshopify.com"
}
```

#### 2.2.4 customers/data_request

**ãƒˆãƒªã‚¬ãƒ¼**: é¡§å®¢ãŒã‚¹ãƒˆã‚¢ã«å¯¾ã—ã¦ãƒ‡ãƒ¼ã‚¿é–‹ç¤ºã‚’è¦æ±‚

**å¿…é ˆå¯¾å¿œ**:
- ä¿æŒã—ã¦ã„ã‚‹é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- ã‚¹ãƒˆã‚¢ã‚ªãƒ¼ãƒŠãƒ¼ã«æä¾›
- 10æ—¥ä»¥å†…ã«å®Œäº†

**ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ä¾‹**:
```json
{
  "shop_id": 954889,
  "shop_domain": "example.myshopify.com",
  "customer": {
    "id": 191167,
    "email": "john@example.com"
  },
  "data_request": {
    "id": 123456
  },
  "orders_requested": [299938, 280263]
}
```

---

## 3. æŠ€è¡“è¦ä»¶

### 3.1 Webhookå—ä¿¡è¦ä»¶

| é …ç›® | è¦ä»¶ | å‚™è€ƒ |
|------|------|------|
| å¿œç­”æ™‚é–“ | **5ç§’ä»¥å†…ã«200 OK** | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã§å†é€ã•ã‚Œã‚‹ |
| HMACæ¤œè¨¼ | **X-Shopify-Hmac-SHA256** ãƒ˜ãƒƒãƒ€ãƒ¼ã§ç½²åæ¤œè¨¼ | API Secretã‚’ä½¿ç”¨ |
| ã‚µã‚¤ã‚ºä¸Šé™ | 256KBæ¨å¥¨ | å¤§ãã„ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¯æ‹’å¦å¯ |
| å†ªç­‰æ€§ | åŒä¸€Webhookã®é‡è¤‡å‡¦ç†ã‚’é˜²æ­¢ | IdempotencyKeyã§ç®¡ç† |
| ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚200 | ã‚¨ãƒ©ãƒ¼ã§ã‚‚200 OKã‚’è¿”ã™ | ä¾‹å¤–æ™‚ã®ãƒªãƒˆãƒ©ã‚¤ãƒ«ãƒ¼ãƒ—é˜²æ­¢ |

### 3.2 HMACæ¤œè¨¼

Shopifyã¯å„Webhookã« `X-Shopify-Hmac-SHA256` ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä»˜ä¸ã—ã¾ã™ã€‚

**æ¤œè¨¼æ‰‹é †**:
1. ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’å–å¾—
2. ã‚¢ãƒ—ãƒªã® `API Secret` ã‚’ä½¿ç”¨ã—ã¦HMAC-SHA256ã‚’è¨ˆç®—
3. è¨ˆç®—çµæœã¨ãƒ˜ãƒƒãƒ€ãƒ¼å€¤ã‚’Base64ã§æ¯”è¼ƒ
4. å›ºå®šæ™‚é–“æ¯”è¼ƒï¼ˆã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒé˜²æ­¢ï¼‰

```csharp
using var hmac = new HMACSHA256(Encoding.UTF8.GetBytes(apiSecret));
var computedHashBytes = hmac.ComputeHash(Encoding.UTF8.GetBytes(requestBody));
var receivedHmacBytes = Convert.FromBase64String(hmacHeader);
return CryptographicOperations.FixedTimeEquals(computedHashBytes, receivedHmacBytes);
```

### 3.3 ãƒãƒ«ãƒã‚¢ãƒ—ãƒªå¯¾å¿œ

è¤‡æ•°ã®Shopifyã‚¢ãƒ—ãƒªã‚’1ã¤ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ç®¡ç†ã™ã‚‹å ´åˆï¼š

1. `X-Shopify-Shop-Domain` ãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ã‚¹ãƒˆã‚¢ã‚’ç‰¹å®š
2. ã‚¹ãƒˆã‚¢ã«ç´ã¥ã `ShopifyApp` ã® `ApiSecret` ã‚’å–å¾—
3. ãã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã§HMACæ¤œè¨¼

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¦ä»¶

### 4.1 å¿…è¦ãªãƒ†ãƒ¼ãƒ–ãƒ«

| ãƒ†ãƒ¼ãƒ–ãƒ«å | ç›®çš„ |
|-----------|------|
| `GDPRRequests` | GDPRè¦æ±‚ã®ç®¡ç† |
| `GDPRDeletionLogs` | å‰Šé™¤å‡¦ç†ã®ç›£æŸ»è¨¼è·¡ |
| `GDPRStatistics` | çµ±è¨ˆãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆç”¨ |
| `WebhookEvents` | Webhookå—ä¿¡å±¥æ­´ï¼ˆå†ªç­‰æ€§ç®¡ç†ï¼‰ |

### 4.2 GDPRRequestsãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE GDPRRequests (
    Id INT IDENTITY(1,1) PRIMARY KEY,
    StoreId INT NULL,
    ShopDomain NVARCHAR(255) NOT NULL,
    RequestType NVARCHAR(50) NOT NULL,
    Status NVARCHAR(50) NOT NULL DEFAULT 'pending',
    ReceivedAt DATETIME2 NOT NULL,
    DueDate DATETIME2 NOT NULL,
    ScheduledFor DATETIME2 NULL,
    CompletedAt DATETIME2 NULL,
    RetryCount INT DEFAULT 0,
    IdempotencyKey NVARCHAR(255),
    WebhookPayload NVARCHAR(MAX),
    CreatedAt DATETIME2 DEFAULT GETUTCDATE()
);
```

---

## 5. æ³•çš„è¦ä»¶

### 5.1 ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼

ä»¥ä¸‹ã®å†…å®¹ã‚’å«ã‚€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’å…¬é–‹ï¼š

- åé›†ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡
- ãƒ‡ãƒ¼ã‚¿ã®ä½¿ç”¨ç›®çš„
- ãƒ‡ãƒ¼ã‚¿ã®ä¿ç®¡å ´æ‰€ã¨æœŸé–“
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©åˆ©ï¼ˆã‚¢ã‚¯ã‚»ã‚¹ã€ä¿®æ­£ã€å‰Šé™¤ï¼‰
- é€£çµ¡å…ˆæƒ…å ±

**ç¾çŠ¶**: 
- æ—¥æœ¬èªç‰ˆ: âœ… ä½œæˆæ¸ˆã¿ (`docs/08-shopify/05-æ³•çš„æ–‡æ›¸/ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼æ¡ˆ.md`)
- è‹±èªç‰ˆ: âŒ æœªä½œæˆ

### 5.2 åˆ©ç”¨è¦ç´„

**ç¾çŠ¶**:
- æ—¥æœ¬èªç‰ˆ: âœ… ä½œæˆæ¸ˆã¿ (`docs/08-shopify/05-æ³•çš„æ–‡æ›¸/åˆ©ç”¨è¦ç´„æ¡ˆ.md`)
- è‹±èªç‰ˆ: âŒ æœªä½œæˆ

---

## 6. ç›£è¦–ãƒ»é‹ç”¨è¦ä»¶

### 6.1 ç›£è¦–é …ç›®

| é …ç›® | é–¾å€¤ | ã‚¢ãƒ©ãƒ¼ãƒˆ |
|------|------|---------|
| Webhookå¿œç­”æ™‚é–“ | > 4ç§’ | è­¦å‘Š |
| HMACæ¤œè¨¼å¤±æ•— | é€£ç¶š3å› | ã‚¨ãƒ©ãƒ¼ |
| å‡¦ç†å¤±æ•— | ç™ºç”Ÿæ™‚ | ã‚¨ãƒ©ãƒ¼ |
| æœŸé™è¶…éãƒªã‚¹ã‚¯ | æœŸé™24æ™‚é–“å‰ | è­¦å‘Š |
| æœŸé™è¶…é | ç™ºç”Ÿæ™‚ | ç·Šæ€¥ |

### 6.2 Application Insightsã‚¯ã‚¨ãƒª

```kql
// Webhookå‡¦ç†æ™‚é–“ã®åˆ†æ
traces
| where message contains "WebhookEvent"
| project timestamp, operation_Name, customDimensions.LatencyMs
| summarize avg(todouble(customDimensions_LatencyMs)) by bin(timestamp, 1h)
```

---

## 7. å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒªãƒ³ã‚¯é›†

### ğŸ”´ ã‚¢ãƒ—ãƒªé–‹ç™ºè€…å‘ã‘ï¼ˆå¿…èª­ï¼‰

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | URL | æ¦‚è¦ |
|-------------|-----|------|
| **Privacy requirements** | https://shopify.dev/docs/apps/launch/privacy-requirements | ã‚¢ãƒ—ãƒªå…¬é–‹ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼è¦ä»¶ |
| **Customer data** | https://shopify.dev/docs/apps/build/privacy-and-data-handling/customer-data | é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šæ‰±ã„è¦ä»¶ |
| **Mandatory webhooks** | https://shopify.dev/docs/apps/build/privacy-and-data-handling/customer-data#webhooks | å¿…é ˆWebhookä»•æ§˜ |
| **Webhook topics** | https://shopify.dev/docs/api/webhooks | Webhookãƒˆãƒ”ãƒƒã‚¯ä¸€è¦§ |
| **HMAC verification** | https://shopify.dev/docs/apps/build/webhooks/verify | HMACç½²åæ¤œè¨¼ã®å®Ÿè£…æ–¹æ³• |
| **App submission** | https://shopify.dev/docs/apps/launch/submit | ã‚¢ãƒ—ãƒªç”³è«‹ãƒ—ãƒ­ã‚»ã‚¹ |

### ğŸŸ¡ ãƒãƒ¼ãƒãƒ£ãƒ³ãƒˆå‘ã‘ï¼ˆå‚è€ƒï¼‰

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | URL | æ¦‚è¦ |
|-------------|-----|------|
| GDPRæ¦‚è¦ï¼ˆæ—¥æœ¬èªï¼‰ | https://help.shopify.com/ja/manual/privacy-and-security/privacy/gdpr | GDPRåŸºæœ¬æƒ…å ± |
| GDPRéµå®ˆæ‰‹é †ï¼ˆæ—¥æœ¬èªï¼‰ | https://help.shopify.com/ja/manual/privacy-and-security/privacy/gdpr/comply-with-gdpr | éµå®ˆæ‰‹é † |
| ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼è¨­å®š | https://help.shopify.com/ja/manual/privacy-and-security/privacy/customer-privacy-settings/privacy-settings | è¨­å®šæ–¹æ³• |

### ğŸ“‹ å¿…é ˆWebhookè©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| Webhook | å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ |
|---------|-----------------|
| `customers/data_request` | https://shopify.dev/docs/api/webhooks#topic-customers-data_request |
| `customers/redact` | https://shopify.dev/docs/api/webhooks#topic-customers-redact |
| `shop/redact` | https://shopify.dev/docs/api/webhooks#topic-shop-redact |
| `app/uninstalled` | https://shopify.dev/docs/api/webhooks#topic-app-uninstalled |

### ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- æ—¢å­˜ä»•æ§˜æ›¸: `docs/00-production-release/03-gdpr-compliance/GDPR_Webhookä»•æ§˜.md`
- æ³•çš„æ–‡æ›¸ï¼ˆæ—¥æœ¬èªï¼‰: `docs/08-shopify/05-æ³•çš„æ–‡æ›¸/`
- ç”³è«‹ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ: `docs/08-shopify/01-ç”³è«‹é–¢é€£/ç”³è«‹ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ.md`