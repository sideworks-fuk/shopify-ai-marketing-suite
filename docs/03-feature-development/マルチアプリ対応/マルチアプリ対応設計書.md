# マルチアプリ対応設計書

## 1. 概要

### 1.1 目的
公開アプリとカスタムアプリの両方に対応するため、1つのバックエンド・データベースで複数のShopifyアプリ（異なるAPI Key/Secret）を管理できるようにする。

### 1.2 設計方針
- **データベースベースのCredentials管理**（推奨アプローチ）
- ストアごとに異なるAPI Key/Secretをデータベースで管理
- 後方互換性を維持（既存ストアはデフォルトCredentialsで動作）

### 1.3 前提条件
- `ShopifyApps`テーブルを新規作成（EF Core Migrationで実装）
- `Store`テーブルに`ShopifyAppId`フィールドを追加（外部キー）
- 既存のOAuth認証フローが動作している
- フロントエンドから`apiKey`をクエリパラメータで受け取る
- `Store.ApiKey`/`ApiSecret`は後方互換性のため残すが、新規設定は非推奨

---

## 2. 現在の実装状況

### 2.1 データベーススキーマ
```sql
-- ShopifyAppsテーブル（新規作成）
Id          INT IDENTITY(1,1) PRIMARY KEY
Name        NVARCHAR(100) NOT NULL
DisplayName NVARCHAR(200) NULL
AppType     NVARCHAR(50) NOT NULL  -- 'Public' / 'Custom'
ApiKey      NVARCHAR(255) NOT NULL
ApiSecret   NVARCHAR(255) NOT NULL
AppUrl      NVARCHAR(500) NULL
RedirectUri NVARCHAR(500) NULL
Scopes      NVARCHAR(500) NULL
IsActive    BIT NOT NULL DEFAULT 1
CreatedAt   DATETIME2 NOT NULL
UpdatedAt   DATETIME2 NOT NULL

-- Storesテーブル（変更）
ShopifyAppId INT NULL  -- 新規追加（外部キー）
ApiKey       NVARCHAR(255) NULL  -- 非推奨（後方互換性のため残す）
ApiSecret    NVARCHAR(255) NULL  -- 非推奨（後方互換性のため残す）
AccessToken  NVARCHAR(MAX) NULL  -- アクセストークン（暗号化済み）
```

詳細は `ShopifyAppsテーブル設計書.md` を参照してください。

### 2.2 既存実装
- ✅ `GetShopifyCredentialsAsync`メソッドが実装済み
  - データベース優先、フォールバックは設定ファイル/環境変数
  - エラーハンドリングとログ出力も実装済み
  - ⚠️ **要修正**: ShopifyAppsテーブルを優先的に検索するように変更が必要
- ✅ `SaveOrUpdateStore`メソッドが実装済み
  - アクセストークンの保存機能あり（暗号化済み）
  - ✅ API Key/Secretの保存機能も実装済み（既存Credentials保護機能付き）
  - ⚠️ **要修正**: `ShopifyAppId`の設定機能を追加する必要がある
- ✅ `EncryptToken`メソッドが実装済み
  - AES暗号化を使用（AccessToken用）
  - ApiSecretの暗号化は未実装（Phase 2で対応予定）

### 2.3 実装が必要な項目
- [ ] `ShopifyApps`テーブルの作成（EF Core Migration）
- [ ] `Store`テーブルに`ShopifyAppId`カラムを追加（EF Core Migration）
- [ ] `DbContext`の修正（ShopifyAppのDbSet追加、リレーション設定）
- [ ] `GetShopifyCredentialsAsync`メソッドの修正（ShopifyAppsテーブル優先）
- [ ] `Install`メソッドの修正（apiKeyパラメータの追加、ShopifyAppsテーブル検索）
- [ ] `Callback`メソッドの修正（stateからShopifyAppIdを取得）
- [ ] `SaveOrUpdateStore`メソッドの修正（ShopifyAppIdの設定）

### 2.4 設定ファイル（フォールバック用）
```json
// appsettings.Production.json
{
  "Shopify": {
    "ApiKey": "[デフォルトのAPI Key]",
    "ApiSecret": "[環境変数で設定]",
    "Scopes": "read_orders,read_products,read_customers"
  }
}
```

**注意**: 新規実装では`ShopifyApps`テーブルを優先的に使用し、設定ファイルはフォールバックとして使用します。

---

## 3. 設計詳細

### 3.1 アーキテクチャ概要

```
┌─────────────────────────────────────────────────────────┐
│ Shopifyアプリ                                            │
│  ├─ EC Ranger（公開）→ API Key: AAA                      │
│  └─ EC Ranger-demo（カスタム）→ API Key: BBB             │
└─────────────────────────────────────────────────────────┘
            ↓                    ↓
┌───────────────────┐   ┌───────────────────┐
│ フロントエンド（公開）│   │ フロントエンド（カスタム）│
│ NEXT_PUBLIC_      │   │ NEXT_PUBLIC_      │
│ SHOPIFY_API_KEY=  │   │ SHOPIFY_API_KEY=  │
│ AAA               │   │ BBB               │
└───────────────────┘   └───────────────────┘
            ↓                    ↓
┌─────────────────────────────────────────────────────────┐
│ バックエンド（共有）                                      │
│                                                         │
│ 1. Install: フロントエンドからapiKeyを受け取る          │
│    → ShopifyAppsテーブルから取得（優先）                 │
│    → 見つからない場合は環境変数から取得（フォールバック） │
│                                                         │
│ 2. Callback: ExchangeCodeForAccessToken(code, shop)     │
│    → stateから取得したAPI Key/Secretでトークン取得       │
│                                                         │
│ 3. SaveOrUpdateStore(shop, token, apiKey, apiSecret, shopifyAppId) │
│    → ストア情報とShopifyAppIdを保存                       │
└─────────────────────────────────────────────────────────┘
            ↓
┌─────────────────────────────────────────────────────────┐
│ データベース（共有）                                      │
│                                                         │
│ ShopifyAppsテーブル:                                    │
│  - EC Ranger（Public）→ ApiKey: AAA, ApiSecret: XXX     │
│  - EC Ranger-demo（Custom）→ ApiKey: BBB, ApiSecret: YYY │
│                                                         │
│ Storesテーブル:                                         │
│  - store1.myshopify.com → ShopifyAppId: 1（EC Ranger）  │
│  - store2.myshopify.com → ShopifyAppId: 2（EC Ranger-demo）│
│  - store3.myshopify.com → ShopifyAppId: NULL（後方互換性）│
└─────────────────────────────────────────────────────────┘
```

### 3.2 データフロー

#### 3.2.1 インストール開始時（`/api/shopify/install`）

```
1. ユーザーが /install?shop=store1.myshopify.com&apiKey=AAA にアクセス
   ↓
2. InstallメソッドでapiKeyパラメータを受け取る
   ↓
3. ShopifyAppsテーブルからapiKeyで検索
   ├─ 見つかった → ApiKey/ApiSecret/ShopifyAppIdを取得
   └─ 見つからない → 環境変数から取得（フォールバック）
   ↓
4. stateにshop/apiKey/apiSecret/shopifyAppIdを保存
   ↓
5. Shopify OAuth URLを構築（取得したAPI Keyを使用）
   ↓
6. ユーザーをShopify認証ページにリダイレクト
```

#### 3.2.2 OAuth認証完了時（`/api/shopify/callback`）

```
1. Shopifyからコールバック（code, shop, state）
   ↓
2. stateからapiKey/apiSecret/shopifyAppIdを取得
   ↓
3. ExchangeCodeForAccessToken(code, shop, apiKey, apiSecret)
   ├─ アクセストークンを取得
   └─ stateから取得したAPI Key/Secretを使用
   ↓
4. SaveOrUpdateStore(shop, accessToken, apiKey, apiSecret, shopifyAppId)
   ├─ ストア情報を保存/更新
   ├─ アクセストークンを暗号化して保存
   ├─ ShopifyAppIdを設定（優先）
   └─ ApiKey/ApiSecretは後方互換性のため、ShopifyAppIdが設定されていない場合のみ保存
   ↓
5. Webhook登録
```

### 3.3 クラス設計

#### 3.3.1 `GetShopifyCredentialsAsync`メソッド

**責務**: ストアドメインに基づいてShopify Credentialsを取得

**優先順位**:
1. ShopifyAppsテーブルから取得（Store.ShopifyAppId経由）
2. Store.ApiKey/ApiSecretから取得（後方互換性）
3. 存在しない場合は設定ファイル/環境変数から取得（フォールバック）

**シグネチャ**:
```csharp
private async Task<(string ApiKey, string ApiSecret)> GetShopifyCredentialsAsync(string shopDomain)
```

**実装ロジック**:
```csharp
1. データベースからストア情報を取得（Domainで検索、ShopifyAppを含む）
2. ShopifyAppテーブルから取得（優先）
   - Store.ShopifyAppIdが設定されている場合
   - Store.ShopifyApp.ApiKey, Store.ShopifyApp.ApiSecretを返す
3. Store.ApiKey/ApiSecretから取得（後方互換性）
   - Store.ShopifyAppIdがNULLの場合
   - Store.ApiKey, Store.ApiSecretを返す
4. 存在しない場合:
   - ログ出力: "デフォルトCredentialsを使用"
   - GetShopifySetting("ApiKey") / GetShopifySetting("ApiSecret") を返す
5. エラー時:
   - ログ出力: "エラー発生、フォールバックを使用"
   - 設定ファイルから取得して返す
```

#### 3.3.2 `SaveOrUpdateStore`メソッド

**責務**: ストア情報とOAuth認証情報をデータベースに保存/更新

**シグネチャ**:
```csharp
private async Task SaveOrUpdateStore(
    string shopDomain, 
    string accessToken, 
    string? apiKey = null, 
    string? apiSecret = null,
    int? shopifyAppId = null)
```

**実装ロジック**:
```csharp
1. 既存のストアを検索（Domainで検索）
2. 存在しない場合:
   - 新規ストアを作成
3. ShopifyAppIdを設定（優先）
   - shopifyAppIdが提供されている場合、Store.ShopifyAppIdに設定
4. 後方互換性: ApiKey/ApiSecretの設定
   - shopifyAppIdが設定されていない場合のみ
   - ApiKey/ApiSecretが提供され、かつ既存値がNULLの場合のみ保存
     （既存のCredentialsを保護）
5. アクセストークンを暗号化して保存
6. UpdatedAtを更新
7. データベースに保存
```

**重要な設計判断**:
- **ShopifyAppIdを優先**: shopifyAppIdが提供されている場合は、これを優先的に設定
- **既存のCredentialsは上書きしない**: データベースに既に保存されているApiKey/ApiSecretは保護する
- **後方互換性**: shopifyAppIdが設定されていない場合のみ、ApiKey/ApiSecretを使用
- **オプショナルパラメータ**: apiKey/apiSecret/shopifyAppIdはオプション（後方互換性のため）

#### 3.3.3 `ExchangeCodeForAccessToken`メソッド

**責務**: 認証コードをアクセストークンに交換

**変更点**: 既存実装を維持（`GetShopifyCredentialsAsync`を使用）

**実装ロジック**:
```csharp
1. GetShopifyCredentialsAsync(shop) でAPI Key/Secretを取得
2. Shopify APIにリクエスト送信
3. アクセストークンを取得
4. トークンを返す
```

---

## 4. セキュリティ考慮事項

### 4.1 現在の実装（Phase 1）

#### 4.1.1 データベース保存
- **ApiKey**: 平文で保存（nvarchar(255)）
- **ApiSecret**: 平文で保存（nvarchar(255)）
- **AccessToken**: 暗号化して保存（`EncryptToken`メソッド使用）

#### 4.1.2 セキュリティ対策
- ✅ データベースアクセス制限（Azure SQL Databaseのファイアウォール設定）
- ✅ ログにAPI Secretが出力されないように注意
- ⚠️ ApiSecretの暗号化は未実装（Phase 2で対応予定）

### 4.2 将来の改善（Phase 2）

#### 4.2.1 ApiSecretの暗号化
```csharp
// ASP.NET Core Data Protectionを使用
public class StoreService
{
    private readonly IDataProtector _protector;
    
    public StoreService(IDataProtectionProvider provider)
    {
        _protector = provider.CreateProtector("ShopifyApiSecrets");
    }
    
    public string EncryptSecret(string secret) => _protector.Protect(secret);
    public string DecryptSecret(string encrypted) => _protector.Unprotect(encrypted);
}
```

#### 4.2.2 Azure Key Vaultの活用（Phase 3）
- 各ストアのAPI SecretをAzure Key Vaultに保存
- 動的なシークレットローテーション

---

## 5. エラーハンドリング

### 5.1 エラーケースと対応

| エラーケース | 対応方法 |
|------------|---------|
| データベースからストア情報取得失敗 | ログ出力後、設定ファイルから取得（フォールバック） |
| API Keyが見つからない | エラーログ出力、500エラーを返す |
| API Secretが見つからない | エラーログ出力、500エラーを返す |
| アクセストークン取得失敗 | リトライ機能を使用（既存実装） |
| ストア情報保存失敗 | エラーログ出力、例外をスロー |

### 5.2 ログ出力方針

```csharp
// 正常系
_logger.LogInformation("ストア固有のCredentialsを使用. Shop: {Shop}", shopDomain);
_logger.LogInformation("デフォルトCredentialsを使用（設定ファイル/環境変数）. Shop: {Shop}", shopDomain);
_logger.LogInformation("ストア情報を保存しました. Shop: {Shop}, HasApiKey: {HasApiKey}, HasApiSecret: {HasApiSecret}", 
    shopDomain, !string.IsNullOrEmpty(store.ApiKey), !string.IsNullOrEmpty(store.ApiSecret));

// エラー系
_logger.LogError("API Keyが見つかりません. Shop: {Shop}", shopDomain);
_logger.LogError(ex, "Credentials取得中にエラーが発生. Shop: {Shop}, フォールバックを使用", shopDomain);
_logger.LogError(ex, "ストア情報の保存中にエラーが発生. Shop: {Shop}", shopDomain);
```

---

## 6. データベース操作

### 6.1 ストア作成時のCredentials設定

#### 6.1.1 初期データの投入（ShopifyAppsテーブル）

```sql
-- 公開アプリの登録
INSERT INTO [dbo].[ShopifyApps] 
    ([Name], [DisplayName], [AppType], [ApiKey], [ApiSecret], [AppUrl], [IsActive], [CreatedAt], [UpdatedAt])
VALUES 
    ('EC Ranger', 'EC Ranger - 公開アプリ', 'Public', 
     '[YOUR_PUBLIC_APP_API_KEY]', '[YOUR_PUBLIC_APP_API_SECRET]', 
     'https://ec-ranger-frontend-public.azurestaticapps.net', 
     1, GETUTCDATE(), GETUTCDATE());

-- カスタムアプリの登録
INSERT INTO [dbo].[ShopifyApps] 
    ([Name], [DisplayName], [AppType], [ApiKey], [ApiSecret], [AppUrl], [IsActive], [CreatedAt], [UpdatedAt])
VALUES 
    ('EC Ranger Demo', 'EC Ranger - カスタムアプリ', 'Custom', 
     '[YOUR_CUSTOM_APP_API_KEY]', '[YOUR_CUSTOM_APP_API_SECRET]', 
     'https://ec-ranger-frontend-custom.azurestaticapps.net', 
     1, GETUTCDATE(), GETUTCDATE());
```

#### 6.1.2 ストアへのShopifyAppId設定（推奨）

```sql
-- 公開アプリを使用するストア
UPDATE Stores 
SET ShopifyAppId = (SELECT TOP 1 [Id] FROM [dbo].[ShopifyApps] WHERE [AppType] = 'Public')
WHERE Domain = 'public-store.myshopify.com';

-- カスタムアプリを使用するストア
UPDATE Stores 
SET ShopifyAppId = (SELECT TOP 1 [Id] FROM [dbo].[ShopifyApps] WHERE [AppType] = 'Custom')
WHERE Domain = 'custom-store.myshopify.com';
```

#### 6.1.3 後方互換性のための手動設定（非推奨）

```sql
-- 注意: この方法は非推奨です。ShopifyAppIdを使用してください。
-- 公開アプリ用ストア
UPDATE Stores 
SET ApiKey = '[YOUR_PUBLIC_APP_API_KEY]',
    ApiSecret = '[YOUR_PUBLIC_APP_API_SECRET]'
WHERE Domain = 'public-store.myshopify.com';
```

#### 6.1.4 自動設定（OAuth認証時）

- 初回インストール時に、使用したAPI Key/SecretからShopifyAppIdを特定
- ShopifyAppIdを優先的に設定
- 既存ストアのCredentialsは上書きしない（保護）

### 6.2 クエリパフォーマンス

- `Domain`カラムにインデックスが必要（既存実装で確認済み）
- `FirstOrDefaultAsync`を使用して1件のみ取得（効率的）

---

## 7. 実装手順

### 7.1 Phase 1: 基本実装（現在）

#### ステップ1: `SaveOrUpdateStore`メソッドの拡張
- [x] メソッドシグネチャに`apiKey`と`apiSecret`パラメータを追加
- [x] 既存のCredentialsを保護するロジックを実装
- [x] 新規ストアの場合のみ、API Key/Secretを保存

#### ステップ2: OAuth認証フローの修正
- [x] `Callback`メソッドで使用したAPI Key/Secretを取得
- [x] `ProcessCallback`メソッドで使用したAPI Key/Secretを取得
- [x] `SaveOrUpdateStore`にAPI Key/Secretを渡す

#### ステップ3: 動作確認（実装前の確認事項）
- [ ] 実装の動作確認とテスト計画の策定
- [ ] 異なるAPI Key/Secretを持つストアでOAuth認証をテスト
- [ ] データベースにCredentialsが正しく保存されることを確認
- [ ] 既存ストアのCredentialsが保護されることを確認
- [ ] エラーハンドリングの動作確認

### 7.2 Phase 2: セキュリティ強化（将来）

#### ステップ1: ApiSecretの暗号化
- [ ] ASP.NET Core Data Protectionを設定
- [ ] `StoreService`に暗号化/復号化メソッドを追加
- [ ] `SaveOrUpdateStore`で暗号化して保存

#### ステップ2: 既存データの移行
- [ ] 既存の平文ApiSecretを暗号化
- [ ] データ移行スクリプトの作成

### 7.3 Phase 3: 高度な機能（将来）

#### ステップ1: Azure Key Vault統合
- [ ] Azure Key Vaultへの接続設定
- [ ] 各ストアのAPI SecretをKey Vaultに保存
- [ ] 動的なシークレット取得機能

---

## 8. テスト方針

### 8.1 単体テスト

#### 8.1.1 `GetShopifyCredentialsAsync`メソッド
- データベースにストア固有のCredentialsが存在する場合
- データベースにCredentialsが存在しない場合（フォールバック）
- データベースアクセスエラーの場合

#### 8.1.2 `SaveOrUpdateStore`メソッド
- 新規ストア作成時にAPI Key/Secretを保存
- 既存ストアのCredentialsを保護（上書きしない）
- アクセストークンの暗号化保存

### 8.2 統合テスト

#### 8.2.1 OAuth認証フロー
- 公開アプリ用API Key/Secretでの認証
- カスタムアプリ用API Key/Secretでの認証
- デフォルトCredentialsでの認証（後方互換性）

#### 8.2.2 データベース操作
- ストア情報の保存/更新
- Credentialsの保存/保護

### 8.3 エンドツーエンドテスト

#### 8.3.1 インストールフロー
1. 公開アプリ用ストアでインストール
2. カスタムアプリ用ストアでインストール
3. デフォルトCredentialsでインストール

#### 8.3.2 動作確認
- 各ストアで正しいAPI Key/Secretが使用されること
- データベースにCredentialsが正しく保存されること

---

## 9. 移行計画

### 9.1 既存ストアへの対応

#### 9.1.1 後方互換性
- 既存ストアはデフォルトCredentialsで動作（変更不要）
- データベースにShopifyAppIdがNULLの場合は、Store.ApiKey/ApiSecretから取得
- Store.ApiKey/ApiSecretもNULLの場合は、設定ファイルから取得

#### 9.1.2 段階的移行
1. **Phase 1**: ShopifyAppsテーブルを作成し、初期データを投入
2. **Phase 2**: 新規ストアのみ、ShopifyAppIdを設定
3. **Phase 3**: 既存ストアにも必要に応じてShopifyAppIdを設定
4. **Phase 4**: すべてのストアがShopifyAppIdを使用（Store.ApiKey/ApiSecretは非推奨）

### 9.2 データ移行

#### 9.2.1 手動設定（推奨）
- 管理画面またはSQLで既存ストアにShopifyAppIdを設定
- 設定後は、次回のOAuth認証からShopifyAppのCredentialsが使用される

#### 9.2.2 自動移行（オプション）
- 初回のOAuth認証時に、使用したAPI KeyからShopifyAppIdを特定
- ShopifyAppIdを自動設定
- 既存のCredentialsは保護（上書きしない）

---

## 10. 運用・保守

### 10.1 モニタリング

#### 10.1.1 ログ監視
- Credentials取得時のログ（ストア固有 vs デフォルト）
- エラー発生時のログ
- ストア情報保存時のログ

#### 10.1.2 メトリクス
- ストア固有Credentials使用率
- デフォルトCredentials使用率
- エラー発生率

### 10.2 トラブルシューティング

#### 10.2.1 よくある問題

**問題**: ストア固有のCredentialsが使用されない
- **原因**: データベースにShopifyAppIdが設定されていない、またはStore.ApiKey/ApiSecretが保存されていない
- **対応**: SQLでShopifyAppIdを設定、またはOAuth認証を再実行

**問題**: OAuth認証が失敗する
- **原因**: API Key/Secretが無効、またはShopifyAppが無効（IsActive=false）
- **対応**: Shopify PartnersでAPI Key/Secretを確認、ShopifyAppsテーブルを更新

### 10.3 ドキュメント

#### 10.3.1 運用マニュアル
- Credentials設定方法
- トラブルシューティング手順
- セキュリティベストプラクティス

---

## 11. 関連ドキュメント

- `ShopifyAppsテーブル設計書.md` - **メイン設計書**（ShopifyAppsテーブルの詳細設計）
- `インストール時のAPI Key判定方法.md` - インストールフローの詳細
- `マルチアプリ対応アーキテクチャ.md` - 全体アーキテクチャ
- `公開アプリとカスタムアプリの構成パターン.md` - 構成パターンの比較
- `アプリインストールガイド.md` - OAuth認証フローの詳細
- `参考資料/マルチCredentials管理方法.md` - 旧設計の参考資料

---

## 12. 実装前の確認事項

### 12.1 設計の要点

#### 12.1.1 重要な設計判断

1. **既存Credentialsの保護**
   - データベースに既に保存されているApiKey/ApiSecretは上書きしない
   - 新規ストアまたはNULLの場合のみ保存
   - 理由: 手動で設定したCredentialsを誤って上書きすることを防ぐ

2. **フォールバック機構**
   - データベースにCredentialsが存在しない場合は、設定ファイル/環境変数から取得
   - 理由: 既存ストアの後方互換性を維持

3. **オプショナルパラメータ**
   - `SaveOrUpdateStore`の`apiKey`と`apiSecret`はオプショナル
   - 理由: 既存コードとの互換性を維持

#### 12.1.2 セキュリティ考慮事項

**Phase 1（現在）**:
- ApiKey: 平文で保存（nvarchar(255)）
- ApiSecret: 平文で保存（nvarchar(255)）
- AccessToken: 暗号化して保存（既存実装）

**Phase 2（将来）**:
- ApiSecretの暗号化を実装
- ASP.NET Core Data Protectionを使用

**Phase 3（将来）**:
- Azure Key Vaultに移行

### 12.2 実装前チェックリスト

#### 12.2.1 コード実装
- [x] `GetShopifyCredentialsAsync`メソッドの実装確認
- [x] `SaveOrUpdateStore`メソッドの拡張確認
- [x] OAuth認証フローの修正確認
- [ ] エラーハンドリングの確認
- [ ] ログ出力の確認

#### 12.2.2 データベース
- [x] `Store`テーブルに`ApiKey`と`ApiSecret`フィールドが存在
- [ ] `Domain`カラムにインデックスが設定されているか確認
- [ ] 既存データのバックアップ

#### 12.2.3 設定
- [ ] デフォルトのAPI Key/Secretが環境変数に設定されているか確認
- [ ] テスト用のAPI Key/Secretが準備されているか確認

### 12.3 実装後の検証項目

#### 12.3.1 機能検証
1. **新規ストアのインストール**
   - データベースにCredentialsが保存されること
   - 次回のOAuth認証で保存されたCredentialsが使用されること

2. **既存ストアの再認証**
   - 既存のCredentialsが保護されること（上書きされないこと）
   - デフォルトCredentialsが使用されること（データベースにNULLの場合）

3. **エラーケース**
   - API Keyが見つからない場合のエラーハンドリング
   - データベースアクセスエラー時のフォールバック

#### 12.3.2 パフォーマンス検証
- データベースクエリの実行時間
- ログ出力のパフォーマンス影響

---

## 13. 更新履歴

| 日付 | バージョン | 変更内容 | 作成者 |
|------|----------|---------|--------|
| 2025-01-XX | 1.0 | 初版作成 | 福田＋AI Assistant |

