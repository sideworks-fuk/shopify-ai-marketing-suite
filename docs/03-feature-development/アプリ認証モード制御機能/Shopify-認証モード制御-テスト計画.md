# Shopify „Ç¢„Éó„É™Ë™çË®º„É¢„Éº„ÉâÂà∂Âæ°Ê©üËÉΩ „ÉÜ„Çπ„ÉàË®àÁîªÊõ∏

## Ê¶ÇË¶Å

Shopify „Ç¢„Éó„É™Ë™çË®º„É¢„Éº„ÉâÂà∂Âæ°Ê©üËÉΩ„ÅÆÂåÖÊã¨ÁöÑ„Å™„ÉÜ„Çπ„ÉàË®àÁîªÊõ∏„Åß„Åô„ÄÇ3ÊÆµÈöéË™çË®º„É¨„Éô„É´ÔºàOAuth/Demo/DeveloperÔºâ„ÄÅÁí∞Â¢ÉÂà•Ë™çË®ºÂà∂Âæ°„ÄÅ„Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÄÅ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÄÅ„É¶„Éº„Ç∂„Éì„É™„ÉÜ„Ç£„ÅÆË¶≥ÁÇπ„Åã„Çâ„ÉÜ„Çπ„Éà„ÇíÂÆüÊñΩ„Åó„Åæ„Åô„ÄÇ

**ÊúÄÁµÇÊõ¥Êñ∞Êó•**: 2025Âπ¥10Êúà27Êó•  
**„Éê„Éº„Ç∏„Éß„É≥**: 2.0Ôºà3ÊÆµÈöéË™çË®º„É¨„Éô„É´Áµ±ÂêàÁâàÔºâ

---

## üéØ „ÉÜ„Çπ„ÉàÁõÆÊ®ô

### ‰∏ªË¶ÅÁõÆÊ®ô
- 3ÊÆµÈöéË™çË®º„É¨„Éô„É´ÔºàLevel 3/2/1Ôºâ„ÅÆÊ≠£Á¢∫ÊÄßÁ¢∫‰øù
- read_only„ÇØ„É¨„Éº„É†„Éô„Éº„Çπ„ÅÆ„Ç¢„ÇØ„Çª„ÇπÂà∂Èôê„ÅÆÊ§úË®º
- ÈñãÁô∫ËÄÖ„É¢„Éº„ÉâÔºàLevel 1Ôºâ„ÅÆÁí∞Â¢ÉÂàÜÈõ¢Á¢∫Ë™ç
- „Çª„Ç≠„É•„É™„ÉÜ„Ç£Ë¶Å‰ª∂„ÅÆÂÆåÂÖ®„Å™Ê∫ÄË∂≥ÔºàNEXT_PUBLIC_DEV_PASSWORDÂâäÈô§Á¢∫Ë™çÔºâ
- „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπË¶Å‰ª∂„ÅÆÈÅîÊàê
- „É¶„Éº„Ç∂„Éì„É™„ÉÜ„Ç£„ÅÆÂêë‰∏ä

### ÊàêÂäüÂü∫Ê∫ñ
- ÂÖ®„ÉÜ„Çπ„Éà„Ç±„Éº„Çπ„ÅÆ95%‰ª•‰∏ä„ÅåÊàêÂäü
- 3ÊÆµÈöéË™çË®º„É¨„Éô„É´„ÅÆÂãï‰Ωú„Åå100%Ê≠£Á¢∫
- read_only„ÇØ„É¨„Éº„É†„Å´„Çà„ÇãÊõ∏„ÅçËæº„ÅøÂà∂Èôê„Åå100%Ê©üËÉΩ
- ÈñãÁô∫ËÄÖ„É¢„Éº„Éâ„ÅåÊú¨Áï™„Éª„Çπ„ÉÜ„Éº„Ç∏„É≥„Ç∞„Åß100%„Éñ„É≠„ÉÉ„ÇØ
- „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„Éà„Åß0‰ª∂„ÅÆËÑÜÂº±ÊÄß
- „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà„ÅßÂÖ®ÊåáÊ®ô„Çí„ÇØ„É™„Ç¢
- „É¶„Éº„Ç∂„Éì„É™„ÉÜ„Ç£„ÉÜ„Çπ„Éà„Åß4.0/5.0‰ª•‰∏ä„ÅÆË©ï‰æ°

---

## üìã „ÉÜ„Çπ„ÉàÊà¶Áï•

### „ÉÜ„Çπ„Éà„Éî„É©„Éü„ÉÉ„Éâ

```
        E2E Tests (Â∞ëÊï∞)
       /              \
   Integration Tests (‰∏≠Á®ãÂ∫¶)
  /                        \
Unit Tests (Â§öÊï∞)          Performance Tests
```

### „ÉÜ„Çπ„Éà„ÅÆÁ®ÆÈ°û

#### 1. Âçò‰Ωì„ÉÜ„Çπ„ÉàÔºàUnit TestsÔºâ
- **ÁõÆÁöÑ**: ÂÄãÂà•„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„ÅÆÂãï‰ΩúÁ¢∫Ë™ç
- **ÂØæË±°**: Èñ¢Êï∞„ÄÅ„É°„ÇΩ„ÉÉ„Éâ„ÄÅ„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
- **„ÉÑ„Éº„É´**: Jest, xUnit, NUnit
- **ÁõÆÊ®ô**: „Ç≥„Éº„Éâ„Ç´„Éê„É¨„ÉÉ„Ç∏80%‰ª•‰∏ä

#### 2. Áµ±Âêà„ÉÜ„Çπ„ÉàÔºàIntegration TestsÔºâ
- **ÁõÆÁöÑ**: Ë§áÊï∞„Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàÈñì„ÅÆÈÄ£Êê∫Á¢∫Ë™ç
- **ÂØæË±°**: APIÈÄ£Êê∫„ÄÅ„Éá„Éº„Çø„Éô„Éº„ÇπÊé•Á∂ö„ÄÅË™çË®º„Éï„É≠„Éº
- **„ÉÑ„Éº„É´**: Supertest, TestContainers
- **ÁõÆÊ®ô**: ‰∏ªË¶Å„Å™Áµ±Âêà„Éù„Ç§„É≥„Éà„ÅÆ100%„ÉÜ„Çπ„Éà

#### 3. E2E„ÉÜ„Çπ„ÉàÔºàEnd-to-End TestsÔºâ
- **ÁõÆÁöÑ**: „É¶„Éº„Ç∂„ÉºË¶ñÁÇπ„Åß„ÅÆÂãï‰ΩúÁ¢∫Ë™ç
- **ÂØæË±°**: Ë™çË®º„Éï„É≠„Éº„ÄÅ„Éá„É¢„É¢„Éº„Éâ„ÄÅÁí∞Â¢ÉÂà•Ë°®Á§∫
- **„ÉÑ„Éº„É´**: Playwright, Cypress
- **ÁõÆÊ®ô**: ‰∏ªË¶Å„Å™„É¶„Éº„Ç∂„Éº„Éï„É≠„Éº„ÅÆ100%„ÉÜ„Çπ„Éà

#### 4. „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„ÉàÔºàSecurity TestsÔºâ
- **ÁõÆÁöÑ**: „Çª„Ç≠„É•„É™„ÉÜ„Ç£ËÑÜÂº±ÊÄß„ÅÆÁ¢∫Ë™ç
- **ÂØæË±°**: Ë™çË®º„ÄÅË™çÂèØ„ÄÅ„Éá„Éº„Çø‰øùË≠∑
- **„ÉÑ„Éº„É´**: OWASP ZAP, Snyk
- **ÁõÆÊ®ô**: „Çª„Ç≠„É•„É™„ÉÜ„Ç£Ë¶Å‰ª∂„ÅÆ100%Ê∫ÄË∂≥

#### 5. „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„ÉàÔºàPerformance TestsÔºâ
- **ÁõÆÁöÑ**: „Ç∑„Çπ„ÉÜ„É†„ÅÆÊÄßËÉΩÁ¢∫Ë™ç
- **ÂØæË±°**: Ë™çË®ºÂá¶ÁêÜ„ÄÅAPIÂøúÁ≠î„ÄÅ„Çª„ÉÉ„Ç∑„Éß„É≥ÁÆ°ÁêÜ
- **„ÉÑ„Éº„É´**: k6, Artillery
- **ÁõÆÊ®ô**: „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπË¶Å‰ª∂„ÅÆ100%ÈÅîÊàê

---

## üß™ „ÉÜ„Çπ„Éà„Ç±„Éº„ÇπË©≥Á¥∞

### 1. Âçò‰Ωì„ÉÜ„Çπ„Éà

#### 1.1 „Éï„É≠„É≥„Éà„Ç®„É≥„ÉâÂçò‰Ωì„ÉÜ„Çπ„Éà

##### AuthenticationRequired„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà

```typescript
// AuthenticationRequired.test.tsx
describe('AuthenticationRequired Component', () => {
  describe('Áí∞Â¢ÉÂà•„Çø„Ç§„Éà„É´Ë°®Á§∫', () => {
    it('Êú¨Áï™Áí∞Â¢É„ÅßShopifyË™çË®º„Çø„Ç§„Éà„É´„ÇíË°®Á§∫„Åô„Çã', () => {
      // Arrange
      mockEnvironmentConfig({
        environment: 'production',
        authMode: 'oauth_required'
      })
      
      // Act
      render(<AuthenticationRequired />)
      
      // Assert
      expect(screen.getByText('ShopifyË™çË®º„ÅåÂøÖË¶Å„Åß„Åô')).toBeInTheDocument()
    })
    
    it('„Çπ„ÉÜ„Éº„Ç∏„É≥„Ç∞Áí∞Â¢É„ÅßÊ±éÁî®Ë™çË®º„Çø„Ç§„Éà„É´„ÇíË°®Á§∫„Åô„Çã', () => {
      // Arrange
      mockEnvironmentConfig({
        environment: 'staging',
        authMode: 'demo_allowed'
      })
      
      // Act
      render(<AuthenticationRequired />)
      
      // Assert
      expect(screen.getByText('Ë™çË®º„ÅåÂøÖË¶Å„Åß„Åô')).toBeInTheDocument()
    })
  })
  
  describe('„Éú„Çø„É≥Ë°®Á§∫Âà∂Âæ°', () => {
    it('Êú¨Áï™Áí∞Â¢É„ÅßOAuthË™çË®º„Éú„Çø„É≥„ÅÆ„ÅøË°®Á§∫„Åô„Çã', () => {
      // Arrange
      mockEnvironmentConfig({
        environment: 'production',
        authMode: 'oauth_required'
      })
      
      // Act
      render(<AuthenticationRequired />)
      
      // Assert
      expect(screen.getByText('Shopify„ÅßË™çË®º„Åô„Çã')).toBeInTheDocument()
      expect(screen.queryByText('„Éá„É¢„Çµ„Ç§„Éà„ÇíÈñã„Åè')).not.toBeInTheDocument()
    })
    
    it('„Çπ„ÉÜ„Éº„Ç∏„É≥„Ç∞Áí∞Â¢É„ÅßOAuthË™çË®º„Éú„Çø„É≥„Å®„Éá„É¢„É™„É≥„ÇØ„ÇíË°®Á§∫„Åô„Çã', () => {
      // Arrange
      mockEnvironmentConfig({
        environment: 'staging',
        authMode: 'demo_allowed'
      })
      
      // Act
      render(<AuthenticationRequired />)
      
      // Assert
      expect(screen.getByText('Shopify„ÅßË™çË®º„Åô„Çã')).toBeInTheDocument()
      expect(screen.getByText('„Éá„É¢„Çµ„Ç§„Éà„ÇíÈñã„Åè')).toBeInTheDocument()
    })
  })
  
  describe('„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É™„É≥„Ç∞', () => {
    it('OAuthË™çË®º„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØÊôÇ„Å´„Ç≥„Éº„É´„Éê„ÉÉ„ÇØ„ÇíÂëº„Å≥Âá∫„Åô', () => {
      // Arrange
      const onShopifyAuth = jest.fn()
      mockEnvironmentConfig({
        environment: 'staging',
        authMode: 'demo_allowed'
      })
      
      // Act
      render(<AuthenticationRequired onShopifyAuth={onShopifyAuth} />)
      fireEvent.click(screen.getByText('Shopify„ÅßË™çË®º„Åô„Çã'))
      
      // Assert
      expect(onShopifyAuth).toHaveBeenCalledTimes(1)
    })
    
    it('„Éá„É¢„É™„É≥„ÇØ„ÇØ„É™„ÉÉ„ÇØÊôÇ„Å´„Ç≥„Éº„É´„Éê„ÉÉ„ÇØ„ÇíÂëº„Å≥Âá∫„Åô', () => {
      // Arrange
      const onDemoAuth = jest.fn()
      mockEnvironmentConfig({
        environment: 'staging',
        authMode: 'demo_allowed'
      })
      
      // Act
      render(<AuthenticationRequired onDemoAuth={onDemoAuth} />)
      fireEvent.click(screen.getByText('„Éá„É¢„Çµ„Ç§„Éà„ÇíÈñã„Åè'))
      
      // Assert
      expect(onDemoAuth).toHaveBeenCalledTimes(1)
    })
  })
})
```

##### DeveloperModeBanner„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà

```typescript
// DeveloperModeBanner.test.tsx
describe('DeveloperModeBanner Component', () => {
  describe('„Çª„ÉÉ„Ç∑„Éß„É≥ÊôÇÈñìË°®Á§∫', () => {
    it('ÊÆã„ÇäÊôÇÈñì„ÇíÊ≠£„Åó„ÅèË°®Á§∫„Åô„Çã', () => {
      // Arrange
      const expiresAt = new Date(Date.now() + 30 * 60 * 1000) // 30ÂàÜÂæå
      
      // Act
      render(<DeveloperModeBanner sessionExpiresAt={expiresAt} onLogout={jest.fn()} />)
      
      // Assert
      expect(screen.getByText(/„Çª„ÉÉ„Ç∑„Éß„É≥ÊÆã„Çä: \d+ÂàÜ/)).toBeInTheDocument()
    })
    
    it('ÊúüÈôêÂàá„ÇåÊôÇ„Å´ÈÅ©Âàá„Å™„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫„Åô„Çã', () => {
      // Arrange
      const expiresAt = new Date(Date.now() - 1000) // 1ÁßíÂâç
      
      // Act
      render(<DeveloperModeBanner sessionExpiresAt={expiresAt} onLogout={jest.fn()} />)
      
      // Assert
      expect(screen.getByText('„Çª„ÉÉ„Ç∑„Éß„É≥ÊÆã„Çä: ÊúüÈôêÂàá„Çå')).toBeInTheDocument()
    })
  })
  
  describe('„É≠„Ç∞„Ç¢„Ç¶„ÉàÊ©üËÉΩ', () => {
    it('„É≠„Ç∞„Ç¢„Ç¶„Éà„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØÊôÇ„Å´„Ç≥„Éº„É´„Éê„ÉÉ„ÇØ„ÇíÂëº„Å≥Âá∫„Åô', () => {
      // Arrange
      const onLogout = jest.fn()
      const expiresAt = new Date(Date.now() + 30 * 60 * 1000)
      
      // Act
      render(<DeveloperModeBanner sessionExpiresAt={expiresAt} onLogout={onLogout} />)
      fireEvent.click(screen.getByText('„É≠„Ç∞„Ç¢„Ç¶„Éà'))
      
      // Assert
      expect(onLogout).toHaveBeenCalledTimes(1)
    })
  })
})
```

#### 1.2 „Éê„ÉÉ„ÇØ„Ç®„É≥„ÉâÂçò‰Ωì„ÉÜ„Çπ„Éà

##### AuthModeMiddleware

```csharp
// AuthModeMiddlewareTests.cs
[TestFixture]
public class AuthModeMiddlewareTests
{
    private Mock<RequestDelegate> _mockNext;
    private Mock<IConfiguration> _mockConfig;
    private Mock<ILogger<AuthModeMiddleware>> _mockLogger;
    private Mock<IMemoryCache> _mockCache;
    private AuthModeMiddleware _middleware;

    [SetUp]
    public void Setup()
    {
        _mockNext = new Mock<RequestDelegate>();
        _mockConfig = new Mock<IConfiguration>();
        _mockLogger = new Mock<ILogger<AuthModeMiddleware>>();
        _mockCache = new Mock<IMemoryCache>();
        
        _middleware = new AuthModeMiddleware(
            _mockNext.Object, 
            _mockConfig.Object, 
            _mockLogger.Object,
            _mockCache.Object
        );
    }

    [Test]
    public async Task InvokeAsync_ProductionWithDemoMode_ShouldReturn500()
    {
        // Arrange
        _mockConfig.Setup(c => c["Environment"]).Returns("Production");
        _mockConfig.Setup(c => c["Authentication:Mode"]).Returns("DemoAllowed");
        
        var context = new DefaultHttpContext();
        context.Response.Body = new MemoryStream();
        
        // Act
        await _middleware.InvokeAsync(context);
        
        // Assert
        Assert.AreEqual(500, context.Response.StatusCode);
    }

    [Test]
    public async Task InvokeAsync_ValidOAuthToken_ShouldCallNext()
    {
        // Arrange
        _mockConfig.Setup(c => c["Environment"]).Returns("Development");
        _mockConfig.Setup(c => c["Authentication:Mode"]).Returns("AllAllowed");
        
        var context = new DefaultHttpContext();
        context.Request.Cookies = new RequestCookieCollection(new Dictionary<string, string>
        {
            ["shopify_oauth_token"] = "valid-token"
        });
        
        // Act
        await _middleware.InvokeAsync(context);
        
        // Assert
        _mockNext.Verify(n => n(context), Times.Once);
    }

    [Test]
    public async Task InvokeAsync_InvalidDemoToken_ShouldReturn401()
    {
        // Arrange
        _mockConfig.Setup(c => c["Environment"]).Returns("Staging");
        _mockConfig.Setup(c => c["Authentication:Mode"]).Returns("DemoAllowed");
        
        var context = new DefaultHttpContext();
        context.Request.Cookies = new RequestCookieCollection(new Dictionary<string, string>
        {
            ["demo_auth_token"] = "invalid-token"
        });
        
        // Act
        await _middleware.InvokeAsync(context);
        
        // Assert
        Assert.AreEqual(401, context.Response.StatusCode);
    }
}
```

##### DemoAuthService

```csharp
// DemoAuthServiceTests.cs
[TestFixture]
public class DemoAuthServiceTests
{
    private Mock<IConfiguration> _mockConfig;
    private Mock<IMemoryCache> _mockCache;
    private Mock<ILogger<DemoAuthService>> _mockLogger;
    private Mock<AuthDbContext> _mockContext;
    private DemoAuthService _service;

    [SetUp]
    public void Setup()
    {
        _mockConfig = new Mock<IConfiguration>();
        _mockCache = new Mock<IMemoryCache>();
        _mockLogger = new Mock<ILogger<DemoAuthService>>();
        _mockContext = new Mock<AuthDbContext>();
        
        _service = new DemoAuthService(
            _mockConfig.Object,
            _mockCache.Object,
            _mockLogger.Object,
            _mockContext.Object
        );
    }

    [Test]
    public async Task AuthenticateAsync_ValidPassword_ShouldReturnSuccess()
    {
        // Arrange
        var hashedPassword = BCrypt.HashPassword("test-password");
        _mockConfig.Setup(c => c["Demo:PasswordHash"]).Returns(hashedPassword);
        _mockConfig.Setup(c => c["Demo:SessionTimeoutHours"]).Returns("1");
        
        // Act
        var result = await _service.AuthenticateAsync("test-password");
        
        // Assert
        Assert.IsTrue(result.Success);
        Assert.IsNotNull(result.Token);
        Assert.IsNotNull(result.SessionId);
    }

    [Test]
    public async Task AuthenticateAsync_InvalidPassword_ShouldReturnFailure()
    {
        // Arrange
        var hashedPassword = BCrypt.HashPassword("correct-password");
        _mockConfig.Setup(c => c["Demo:PasswordHash"]).Returns(hashedPassword);
        
        // Act
        var result = await _service.AuthenticateAsync("wrong-password");
        
        // Assert
        Assert.IsFalse(result.Success);
        Assert.AreEqual("Invalid password", result.ErrorMessage);
    }

    [Test]
    public async Task ValidateTokenAsync_ValidToken_ShouldReturnTrue()
    {
        // Arrange
        var sessionId = Guid.NewGuid().ToString();
        var session = new DemoSession
        {
            SessionId = sessionId,
            ExpiresAt = DateTime.UtcNow.AddHours(1),
            IsActive = true
        };
        
        _mockCache.Setup(c => c.TryGetValue($"demo_session_{sessionId}", out session))
                  .Returns(true);
        
        // Act
        var result = await _service.ValidateTokenAsync("valid-token");
        
        // Assert
        Assert.IsTrue(result);
    }
}
```

### 2. Áµ±Âêà„ÉÜ„Çπ„Éà

#### 2.1 Ë™çË®º„Éï„É≠„ÉºÁµ±Âêà„ÉÜ„Çπ„Éà

```csharp
// AuthenticationFlowIntegrationTests.cs
[TestFixture]
public class AuthenticationFlowIntegrationTests
{
    private WebApplicationFactory<Program> _factory;
    private HttpClient _client;

    [SetUp]
    public void Setup()
    {
        _factory = new WebApplicationFactory<Program>()
            .WithWebHostBuilder(builder =>
            {
                builder.ConfigureServices(services =>
                {
                    // „ÉÜ„Çπ„ÉàÁî®„ÅÆË®≠ÂÆö
                    services.Configure<AuthConfig>(config =>
                    {
                        config.Mode = AuthMode.DemoAllowed;
                        config.JwtSecret = "test-secret-key";
                    });
                });
            });
        
        _client = _factory.CreateClient();
    }

    [Test]
    public async Task DemoAuthentication_ShouldCreateValidSession()
    {
        // Arrange
        var request = new { password = "test-password" };
        
        // Act
        var response = await _client.PostAsJsonAsync("/api/auth/demo", request);
        
        // Assert
        Assert.AreEqual(HttpStatusCode.OK, response.StatusCode);
        
        var result = await response.Content.ReadFromJsonAsync<DemoAuthResult>();
        Assert.IsTrue(result!.Success);
        Assert.IsNotNull(result.Token);
        Assert.IsNotNull(result.SessionId);
    }

    [Test]
    public async Task DemoMode_ShouldRestrictShopifyApiAccess()
    {
        // Arrange
        var demoToken = await GetDemoTokenAsync();
        _client.DefaultRequestHeaders.Authorization = 
            new AuthenticationHeaderValue("Bearer", demoToken);
        
        // Act
        var response = await _client.GetAsync("/api/shopify/orders");
        
        // Assert
        Assert.AreEqual(HttpStatusCode.Forbidden, response.StatusCode);
        var content = await response.Content.ReadAsStringAsync();
        Assert.Contains("Forbidden in demo mode", content);
    }

    [Test]
    public async Task OAuthMode_ShouldAllowShopifyApiAccess()
    {
        // Arrange
        var oauthToken = await GetOAuthTokenAsync();
        _client.DefaultRequestHeaders.Authorization = 
            new AuthenticationHeaderValue("Bearer", oauthToken);
        
        // Act
        var response = await _client.GetAsync("/api/shopify/orders");
        
        // Assert
        Assert.AreEqual(HttpStatusCode.OK, response.StatusCode);
    }

    private async Task<string> GetDemoTokenAsync()
    {
        var response = await _client.PostAsJsonAsync("/api/auth/demo", new
        {
            password = "test-password"
        });
        
        var result = await response.Content.ReadFromJsonAsync<DemoAuthResult>();
        return result!.Token;
    }
}
```

#### 2.2 Áí∞Â¢ÉÂà•Ë®≠ÂÆöÁµ±Âêà„ÉÜ„Çπ„Éà

```typescript
// EnvironmentConfigIntegration.test.ts
describe('Environment Configuration Integration', () => {
  describe('Êú¨Áï™Áí∞Â¢ÉË®≠ÂÆö', () => {
    it('Êú¨Áï™Áí∞Â¢É„Åß„Éá„É¢„É¢„Éº„Éâ„ÅåÁÑ°ÂäπÂåñ„Åï„Çå„Çã', async () => {
      // Arrange
      process.env.NEXT_PUBLIC_ENVIRONMENT = 'production'
      process.env.NEXT_PUBLIC_AUTH_MODE = 'oauth_required'
      
      // Act
      const response = await fetch('/api/auth/demo', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: 'test-password' })
      })
      
      // Assert
      expect(response.status).toBe(403)
    })
  })
  
  describe('„Çπ„ÉÜ„Éº„Ç∏„É≥„Ç∞Áí∞Â¢ÉË®≠ÂÆö', () => {
    it('„Çπ„ÉÜ„Éº„Ç∏„É≥„Ç∞Áí∞Â¢É„Åß„Éá„É¢„É¢„Éº„Éâ„ÅåÊúâÂäπÂåñ„Åï„Çå„Çã', async () => {
      // Arrange
      process.env.NEXT_PUBLIC_ENVIRONMENT = 'staging'
      process.env.NEXT_PUBLIC_AUTH_MODE = 'demo_allowed'
      
      // Act
      const response = await fetch('/api/auth/demo', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: 'test-password' })
      })
      
      // Assert
      expect(response.status).toBe(200)
    })
  })
})
```

### 3. E2E„ÉÜ„Çπ„Éà

#### 3.1 Ë™çË®º„Éï„É≠„ÉºE2E„ÉÜ„Çπ„Éà

```typescript
// auth-flow.e2e.spec.ts
import { test, expect } from '@playwright/test'

test.describe('Authentication Flow E2E', () => {
  test('Êú¨Áï™Áí∞Â¢É„Åß„ÅÆOAuthË™çË®º„Éï„É≠„Éº', async ({ page }) => {
    // Arrange
    await page.goto('/?shop=test-store.myshopify.com')
    
    // Act
    await page.click('text=Shopify„ÅßË™çË®º„Åô„Çã')
    
    // Assert
    await expect(page).toHaveURL(/shopify\.com/)
    await expect(page.locator('text=ShopifyË™çË®º„ÅåÂøÖË¶Å„Åß„Åô')).toBeVisible()
  })
  
  test('„Çπ„ÉÜ„Éº„Ç∏„É≥„Ç∞Áí∞Â¢É„Åß„ÅÆ„Éá„É¢„É¢„Éº„ÉâË™çË®º„Éï„É≠„Éº', async ({ page }) => {
    // Arrange
    await page.goto('/dev-bookmarks')
    
    // Act
    await page.fill('input[type="password"]', 'test-password')
    await page.click('button[type="submit"]')
    
    // Assert
    await expect(page.locator('text=ÈñãÁô∫ËÄÖ„ÉÑ„Éº„É´ÊúâÂäπ')).toBeVisible()
    await expect(page.locator('text=„Çª„ÉÉ„Ç∑„Éß„É≥ÊÆã„Çä')).toBeVisible()
  })
  
  test('„Éá„É¢„É¢„Éº„Éâ„Åß„ÅÆ„Éá„Éº„ÇøÂ§âÊõ¥Âà∂Èôê', async ({ page }) => {
    // Arrange
    await page.goto('/dev-bookmarks')
    await page.fill('input[type="password"]', 'test-password')
    await page.click('button[type="submit"]')
    
    // Act
    await page.click('button:has-text("„Éá„Éº„Çø„ÇíÂ§âÊõ¥")')
    
    // Assert
    await expect(page.locator('text=„Éá„É¢„É¢„Éº„Éâ„Åß„ÅØ„Éá„Éº„Çø„ÅÆÂ§âÊõ¥„ÅØ„Åß„Åç„Åæ„Åõ„Çì')).toBeVisible()
  })
})
```

#### 3.2 Áí∞Â¢ÉÂà•Ë°®Á§∫E2E„ÉÜ„Çπ„Éà

```typescript
// environment-display.e2e.spec.ts
import { test, expect } from '@playwright/test'

test.describe('Environment Display E2E', () => {
  test('Êú¨Áï™Áí∞Â¢É„Åß„Éá„É¢„É™„É≥„ÇØ„ÅåË°®Á§∫„Åï„Çå„Å™„ÅÑ', async ({ page }) => {
    // Arrange
    await page.goto('/')
    
    // Assert
    await expect(page.locator('text=„Éá„É¢„Çµ„Ç§„Éà„ÇíÈñã„Åè')).not.toBeVisible()
    await expect(page.locator('text=Shopify„ÅßË™çË®º„Åô„Çã')).toBeVisible()
  })
  
  test('„Çπ„ÉÜ„Éº„Ç∏„É≥„Ç∞Áí∞Â¢É„Åß„Éá„É¢„É™„É≥„ÇØ„ÅåË°®Á§∫„Åï„Çå„Çã', async ({ page }) => {
    // Arrange
    await page.goto('/')
    
    // Assert
    await expect(page.locator('text=„Éá„É¢„Çµ„Ç§„Éà„ÇíÈñã„Åè')).toBeVisible()
    await expect(page.locator('text=Shopify„ÅßË™çË®º„Åô„Çã')).toBeVisible()
  })
  
  test('ÈñãÁô∫Áí∞Â¢É„ÅßÂÖ®„Éú„Çø„É≥„ÅåË°®Á§∫„Åï„Çå„Çã', async ({ page }) => {
    // Arrange
    await page.goto('/')
    
    // Assert
    await expect(page.locator('text=„Éá„É¢„Çµ„Ç§„Éà„ÇíÈñã„Åè')).toBeVisible()
    await expect(page.locator('text=Shopify„ÅßË™çË®º„Åô„Çã')).toBeVisible()
    await expect(page.locator('text=ÈñãÁô∫ËÄÖ„ÉÑ„Éº„É´')).toBeVisible()
  })
})
```

### 4. „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„Éà

#### 4.1 Ë™çË®º„Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„Éà

```csharp
// SecurityTests.cs
[TestFixture]
public class SecurityTests
{
    [Test]
    public void PasswordHash_ShouldUseBCrypt()
    {
        // Arrange
        var password = "test-password";
        
        // Act
        var hash = BCrypt.HashPassword(password);
        
        // Assert
        Assert.IsTrue(BCrypt.Verify(password, hash));
        Assert.IsTrue(hash.StartsWith("$2a$"));
    }
    
    [Test]
    public void JWTToken_ShouldBeSigned()
    {
        // Arrange
        var secret = "test-secret-key";
        var token = GenerateJWTToken(secret);
        
        // Act
        var isValid = ValidateJWTToken(token, secret);
        
        // Assert
        Assert.IsTrue(isValid);
    }
    
    [Test]
    public void SessionToken_ShouldExpire()
    {
        // Arrange
        var expiredToken = GenerateExpiredToken();
        
        // Act
        var isValid = ValidateToken(expiredToken);
        
        // Assert
        Assert.IsFalse(isValid);
    }
}
```

#### 4.2 „Ç¢„ÇØ„Çª„ÇπÂà∂Âæ°„Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„Éà

```typescript
// access-control.security.test.ts
describe('Access Control Security', () => {
  test('„Éá„É¢„É¢„Éº„Éâ„ÅßShopify API„Ç¢„ÇØ„Çª„Çπ„ÅåÂà∂Èôê„Åï„Çå„Çã', async () => {
    // Arrange
    const demoToken = await getDemoToken()
    
    // Act
    const response = await fetch('/api/shopify/orders', {
      headers: {
        'Authorization': `Bearer ${demoToken}`
      }
    })
    
    // Assert
    expect(response.status).toBe(403)
    expect(await response.text()).toContain('Forbidden in demo mode')
  })
  
  test('ÁÑ°Âäπ„Å™„Éà„Éº„ÇØ„É≥„Åß„Ç¢„ÇØ„Çª„Çπ„ÅåÊãíÂê¶„Åï„Çå„Çã', async () => {
    // Arrange
    const invalidToken = 'invalid-token'
    
    // Act
    const response = await fetch('/api/protected', {
      headers: {
        'Authorization': `Bearer ${invalidToken}`
      }
    })
    
    // Assert
    expect(response.status).toBe(401)
  })
  
  test('„Çª„ÉÉ„Ç∑„Éß„É≥ÊúüÈôêÂàá„Çå„Åß„Ç¢„ÇØ„Çª„Çπ„ÅåÊãíÂê¶„Åï„Çå„Çã', async () => {
    // Arrange
    const expiredToken = await getExpiredToken()
    
    // Act
    const response = await fetch('/api/protected', {
      headers: {
        'Authorization': `Bearer ${expiredToken}`
      }
    })
    
    // Assert
    expect(response.status).toBe(401)
  })
})
```

#### 4.3 „É¨„Éº„ÉàÂà∂Èôê„Éª„Éñ„É´„Éº„Éà„Éï„Ç©„Éº„ÇπÂØæÁ≠ñ„ÉÜ„Çπ„Éà

```typescript
// rate-limit-security.test.ts
describe('Rate Limiting and Brute Force Protection Tests', () => {
  test('„É¨„Éº„ÉàÂà∂Èôê„ÇíË∂Ö„Åà„ÅüË™çË®ºË©¶Ë°å„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Çã', async () => {
    // Arrange
    const ipAddress = '192.168.1.100'
    const maxAttempts = 5
    
    // Act: maxAttemptsÂõûÂ§±ÊïóË©¶Ë°å
    for (let i = 0; i < maxAttempts; i++) {
      await fetch('/api/auth/demo', {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json',
          'X-Forwarded-For': ipAddress
        },
        body: JSON.stringify({ password: 'wrong-password' })
      })
    }
    
    // Act: maxAttempts + 1ÂõûÁõÆ„ÅÆË©¶Ë°å
    const response = await fetch('/api/auth/demo', {
      method: 'POST',
      headers: { 
        'Content-Type': 'application/json',
        'X-Forwarded-For': ipAddress
      },
      body: JSON.stringify({ password: 'correct-password' })
    })
    
    // Assert
    expect(response.status).toBe(429) // Too Many Requests
    const result = await response.json()
    expect(result.error).toContain('Too many attempts')
  })
  
  test('„É≠„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÈñæÂÄ§Âà∞ÈÅîÂæå„Å´„Ç¢„Ç´„Ç¶„É≥„Éà„Åå„É≠„ÉÉ„ÇØ„Åï„Çå„Çã', async () => {
    // Arrange
    const ipAddress = '192.168.1.101'
    const lockoutThreshold = 10
    
    // Act: lockoutThresholdÂõûÂ§±ÊïóË©¶Ë°å
    for (let i = 0; i < lockoutThreshold; i++) {
      await fetch('/api/auth/demo', {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json',
          'X-Forwarded-For': ipAddress
        },
        body: JSON.stringify({ password: 'wrong-password' })
      })
    }
    
    // Act: „É≠„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÂæå„ÅÆË©¶Ë°å
    const response = await fetch('/api/auth/demo', {
      method: 'POST',
      headers: { 
        'Content-Type': 'application/json',
        'X-Forwarded-For': ipAddress
      },
      body: JSON.stringify({ password: 'correct-password' })
    })
    
    // Assert
    expect(response.status).toBe(403) // Forbidden
    const result = await response.json()
    expect(result.error).toContain('temporarily locked')
  })
  
  test('ÊàêÂäüË™çË®ºÂæå„Å´„É¨„Éº„ÉàÂà∂Èôê„Ç´„Ç¶„É≥„Çø„Éº„Åå„É™„Çª„ÉÉ„Éà„Åï„Çå„Çã', async () => {
    // Arrange
    const ipAddress = '192.168.1.102'
    
    // Act: Êï∞ÂõûÂ§±ÊïóË©¶Ë°å
    for (let i = 0; i < 3; i++) {
      await fetch('/api/auth/demo', {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json',
          'X-Forwarded-For': ipAddress
        },
        body: JSON.stringify({ password: 'wrong-password' })
      })
    }
    
    // Act: ÊàêÂäüË™çË®º
    await fetch('/api/auth/demo', {
      method: 'POST',
      headers: { 
        'Content-Type': 'application/json',
        'X-Forwarded-For': ipAddress
      },
      body: JSON.stringify({ password: 'correct-password' })
    })
    
    // Act: ÂÜçÂ∫¶Ë™çË®ºË©¶Ë°åÔºà„Ç´„Ç¶„É≥„Çø„Éº„Åå„É™„Çª„ÉÉ„Éà„Åï„Çå„Å¶„ÅÑ„Çã„ÅØ„ÅöÔºâ
    const response = await fetch('/api/auth/demo', {
      method: 'POST',
      headers: { 
        'Content-Type': 'application/json',
        'X-Forwarded-For': ipAddress
      },
      body: JSON.stringify({ password: 'correct-password' })
    })
    
    // Assert
    expect(response.status).toBe(200)
  })
  
  test('Âπ≥Êñá„Éë„Çπ„ÉØ„Éº„Éâ„Åå„É≠„Ç∞„Å´Ë®òÈå≤„Åï„Çå„Å™„ÅÑ', async () => {
    // Arrange
    const password = 'sensitive-password-123'
    
    // Act
    await fetch('/api/auth/demo', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ password })
    })
    
    // Assert: „É≠„Ç∞„Éï„Ç°„Ç§„É´„ÇíÁ¢∫Ë™ç
    const logs = await readAuthenticationLogs()
    expect(logs).not.toContain(password)
  })
})
```

#### 4.4 Áí∞Â¢ÉË®≠ÂÆöÊ§úË®º„ÉÜ„Çπ„Éà

```csharp
// EnvironmentConfigurationSecurityTests.cs
[TestFixture]
public class EnvironmentConfigurationSecurityTests
{
    [Test]
    public void Startup_ProductionWithDemoMode_ShouldThrowException()
    {
        // Arrange
        var config = new ConfigurationBuilder()
            .AddInMemoryCollection(new Dictionary<string, string>
            {
                ["ASPNETCORE_ENVIRONMENT"] = "Production",
                ["Authentication:Mode"] = "DemoAllowed"
            })
            .Build();
        
        // Act & Assert
        Assert.Throws<InvalidOperationException>(() =>
        {
            var startup = new Startup(config);
            startup.ConfigureServices(new ServiceCollection());
        });
    }
    
    [Test]
    public void Startup_ProductionWithOAuthRequired_ShouldSucceed()
    {
        // Arrange
        var config = new ConfigurationBuilder()
            .AddInMemoryCollection(new Dictionary<string, string>
            {
                ["ASPNETCORE_ENVIRONMENT"] = "Production",
                ["Authentication:Mode"] = "OAuthRequired"
            })
            .Build();
        
        // Act & Assert
        Assert.DoesNotThrow(() =>
        {
            var startup = new Startup(config);
            startup.ConfigureServices(new ServiceCollection());
        });
    }
    
    [Test]
    public void Startup_MissingJwtSecret_ShouldThrowException()
    {
        // Arrange
        var config = new ConfigurationBuilder()
            .AddInMemoryCollection(new Dictionary<string, string>
            {
                ["ASPNETCORE_ENVIRONMENT"] = "Development",
                ["Authentication:Mode"] = "AllAllowed"
                // JwtSecret„ÅåÊ¨†ËêΩ
            })
            .Build();
        
        // Act & Assert
        Assert.Throws<InvalidOperationException>(() =>
        {
            var startup = new Startup(config);
            startup.ConfigureServices(new ServiceCollection());
        });
    }
}
```

#### 4.5 „Ç∞„É≠„Éº„Éê„É´Ë™≠„ÅøÂèñ„ÇäÂ∞ÇÁî®„Éù„É™„Ç∑„Éº„ÉÜ„Çπ„Éà

```csharp
// DemoReadOnlyFilterTests.cs
[TestFixture]
public class DemoReadOnlyFilterTests
{
    [Test]
    public void DemoMode_PostRequest_ShouldBeBlocked()
    {
        // Arrange
        var filter = new DemoReadOnlyFilter(Mock.Of<ILogger<DemoReadOnlyFilter>>());
        var context = CreateActionExecutingContext("POST");
        context.HttpContext.Items["IsReadOnly"] = true;
        
        // Act
        filter.OnActionExecuting(context);
        
        // Assert
        Assert.IsInstanceOf<JsonResult>(context.Result);
        var jsonResult = (JsonResult)context.Result;
        Assert.AreEqual(403, jsonResult.StatusCode);
    }
    
    [Test]
    public void DemoMode_GetRequest_ShouldBeAllowed()
    {
        // Arrange
        var filter = new DemoReadOnlyFilter(Mock.Of<ILogger<DemoReadOnlyFilter>>());
        var context = CreateActionExecutingContext("GET");
        context.HttpContext.Items["IsReadOnly"] = true;
        
        // Act
        filter.OnActionExecuting(context);
        
        // Assert
        Assert.IsNull(context.Result);
    }
    
    [Test]
    public void DemoMode_PostRequestWithAllowDemoWrite_ShouldBeAllowed()
    {
        // Arrange
        var filter = new DemoReadOnlyFilter(Mock.Of<ILogger<DemoReadOnlyFilter>>());
        var context = CreateActionExecutingContext("POST");
        context.HttpContext.Items["IsReadOnly"] = true;
        context.ActionDescriptor.EndpointMetadata.Add(new AllowDemoWriteAttribute());
        
        // Act
        filter.OnActionExecuting(context);
        
        // Assert
        Assert.IsNull(context.Result);
    }
    
    [Test]
    public void OAuthMode_PostRequest_ShouldBeAllowed()
    {
        // Arrange
        var filter = new DemoReadOnlyFilter(Mock.Of<ILogger<DemoReadOnlyFilter>>());
        var context = CreateActionExecutingContext("POST");
        context.HttpContext.Items["IsReadOnly"] = false;
        
        // Act
        filter.OnActionExecuting(context);
        
        // Assert
        Assert.IsNull(context.Result);
    }
}
```

#### 4.6 Shopify App BridgeË™çË®º„ÉÜ„Çπ„Éà

```typescript
// shopify-app-bridge-auth.test.ts
describe('Shopify App Bridge Authentication Tests', () => {
  test('„Çª„ÉÉ„Ç∑„Éß„É≥„Éà„Éº„ÇØ„É≥„ÅåAuthorization„Éò„ÉÉ„ÉÄ„ÉºÁµåÁî±„ÅßÈÄÅ‰ø°„Åï„Çå„Çã', async () => {
    // Arrange
    const sessionToken = await getShopifySessionToken()
    
    // Act
    const response = await fetch('/api/protected', {
      headers: {
        'Authorization': `Bearer ${sessionToken}`
      }
    })
    
    // Assert
    expect(response.status).toBe(200)
  })
  
  test('Cookie„Éô„Éº„Çπ„ÅÆË™çË®º„Åå‰ΩøÁî®„Åï„Çå„Å™„ÅÑ', async () => {
    // Arrange
    const sessionToken = await getShopifySessionToken()
    
    // Act: Cookie„Å´„Éà„Éº„ÇØ„É≥„ÇíË®≠ÂÆö„Åó„Å¶„É™„ÇØ„Ç®„Çπ„Éà
    const response = await fetch('/api/protected', {
      headers: {
        'Cookie': `shopify_session=${sessionToken}`
      }
    })
    
    // Assert: Cookie„ÅÆ„Åø„Åß„ÅØË™çË®º„Åï„Çå„Å™„ÅÑ
    expect(response.status).toBe(401)
  })
  
  test('ÁÑ°Âäπ„Å™„Çª„ÉÉ„Ç∑„Éß„É≥„Éà„Éº„ÇØ„É≥„ÅåÊãíÂê¶„Åï„Çå„Çã', async () => {
    // Arrange
    const invalidToken = 'invalid-session-token'
    
    // Act
    const response = await fetch('/api/protected', {
      headers: {
        'Authorization': `Bearer ${invalidToken}`
      }
    })
    
    // Assert
    expect(response.status).toBe(401)
  })
  
  test('ÊúüÈôêÂàá„Çå„Çª„ÉÉ„Ç∑„Éß„É≥„Éà„Éº„ÇØ„É≥„ÅåÊãíÂê¶„Åï„Çå„Çã', async () => {
    // Arrange
    const expiredToken = await getExpiredShopifySessionToken()
    
    // Act
    const response = await fetch('/api/protected', {
      headers: {
        'Authorization': `Bearer ${expiredToken}`
      }
    })
    
    // Assert
    expect(response.status).toBe(401)
  })
})
```

#### 4.7 ÂàÜÊï£„Çª„ÉÉ„Ç∑„Éß„É≥„Çπ„Éà„É¨„Éº„Ç∏„ÉÜ„Çπ„Éà

```csharp
// DistributedSessionStorageTests.cs
[TestFixture]
public class DistributedSessionStorageTests
{
    [Test]
    public async Task DemoSession_ShouldPersistInDatabase()
    {
        // Arrange
        var session = new DemoSession
        {
            Id = Guid.NewGuid(),
            SessionId = Guid.NewGuid().ToString(),
            ExpiresAt = DateTime.UtcNow.AddHours(1),
            CreatedAt = DateTime.UtcNow,
            IsActive = true
        };
        
        // Act
        await _dbContext.DemoSessions.AddAsync(session);
        await _dbContext.SaveChangesAsync();
        
        // Assert
        var retrieved = await _dbContext.DemoSessions
            .FirstOrDefaultAsync(s => s.SessionId == session.SessionId);
        Assert.IsNotNull(retrieved);
        Assert.AreEqual(session.SessionId, retrieved.SessionId);
    }
    
    [Test]
    public async Task DemoSession_ShouldBeCachedInRedis()
    {
        // Arrange
        var session = new DemoSession
        {
            SessionId = Guid.NewGuid().ToString(),
            ExpiresAt = DateTime.UtcNow.AddHours(1)
        };
        
        var cacheOptions = new DistributedCacheEntryOptions
        {
            AbsoluteExpiration = session.ExpiresAt
        };
        
        // Act
        await _distributedCache.SetStringAsync(
            $"demo_session_{session.SessionId}",
            JsonSerializer.Serialize(session),
            cacheOptions
        );
        
        // Assert
        var cached = await _distributedCache.GetStringAsync($"demo_session_{session.SessionId}");
        Assert.IsNotNull(cached);
        var deserializedSession = JsonSerializer.Deserialize<DemoSession>(cached);
        Assert.AreEqual(session.SessionId, deserializedSession.SessionId);
    }
    
    [Test]
    public async Task ExpiredSessions_ShouldBeCleanedUp()
    {
        // Arrange
        var expiredSession = new DemoSession
        {
            Id = Guid.NewGuid(),
            SessionId = Guid.NewGuid().ToString(),
            ExpiresAt = DateTime.UtcNow.AddHours(-1), // 1ÊôÇÈñìÂâç„Å´ÊúüÈôêÂàá„Çå
            CreatedAt = DateTime.UtcNow.AddHours(-2),
            IsActive = true
        };
        
        await _dbContext.DemoSessions.AddAsync(expiredSession);
        await _dbContext.SaveChangesAsync();
        
        // Act
        var cleanupService = new SessionCleanupService(_dbContext, _logger);
        await cleanupService.CleanupExpiredSessionsAsync();
        
        // Assert
        var retrieved = await _dbContext.DemoSessions
            .FirstOrDefaultAsync(s => s.SessionId == expiredSession.SessionId);
        Assert.IsNull(retrieved);
    }
}
```

### 5. „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà

#### 5.1 Ë™çË®ºÂá¶ÁêÜ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà

```javascript
// auth-performance.test.js
import http from 'k6/http'
import { check, sleep } from 'k6'

export let options = {
  stages: [
    { duration: '2m', target: 10 }, // 2ÂàÜÈñì„Åß10„É¶„Éº„Ç∂„Éº„Åæ„ÅßÂ¢óÂä†
    { duration: '5m', target: 10 }, // 5ÂàÜÈñì10„É¶„Éº„Ç∂„Éº„ÇíÁ∂≠ÊåÅ
    { duration: '2m', target: 0 },  // 2ÂàÜÈñì„Åß0„É¶„Éº„Ç∂„Éº„Åæ„ÅßÊ∏õÂ∞ë
  ],
  thresholds: {
    http_req_duration: ['p(95)<3000'], // 95%„ÅÆ„É™„ÇØ„Ç®„Çπ„Éà„Åå3Áßí‰ª•ÂÜÖ
    http_req_failed: ['rate<0.1'],     // „Ç®„É©„ÉºÁéá10%Êú™Ê∫Ä
  },
}

export default function () {
  // OAuthË™çË®º„ÉÜ„Çπ„Éà
  let oauthResponse = http.post('http://localhost:5000/api/auth/oauth', {
    shop: 'test-store.myshopify.com',
  })
  
  check(oauthResponse, {
    'OAuthË™çË®º„ÅåÊàêÂäü„Åô„Çã': (r) => r.status === 200,
    'OAuthË™çË®º„Åå3Áßí‰ª•ÂÜÖ': (r) => r.timings.duration < 3000,
  })
  
  // „Éá„É¢Ë™çË®º„ÉÜ„Çπ„Éà
  let demoResponse = http.post('http://localhost:5000/api/auth/demo', {
    password: 'test-password',
  })
  
  check(demoResponse, {
    '„Éá„É¢Ë™çË®º„ÅåÊàêÂäü„Åô„Çã': (r) => r.status === 200,
    '„Éá„É¢Ë™çË®º„Åå2Áßí‰ª•ÂÜÖ': (r) => r.timings.duration < 2000,
  })
  
  sleep(1)
}
```

#### 5.2 „Çª„ÉÉ„Ç∑„Éß„É≥ÁÆ°ÁêÜ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà

```javascript
// session-performance.test.js
import http from 'k6/http'
import { check, sleep } from 'k6'

export let options = {
  stages: [
    { duration: '1m', target: 50 },  // 1ÂàÜÈñì„Åß50„É¶„Éº„Ç∂„Éº„Åæ„ÅßÂ¢óÂä†
    { duration: '3m', target: 50 },  // 3ÂàÜÈñì50„É¶„Éº„Ç∂„Éº„ÇíÁ∂≠ÊåÅ
    { duration: '1m', target: 0 },   // 1ÂàÜÈñì„Åß0„É¶„Éº„Ç∂„Éº„Åæ„ÅßÊ∏õÂ∞ë
  ],
  thresholds: {
    http_req_duration: ['p(95)<1000'], // 95%„ÅÆ„É™„ÇØ„Ç®„Çπ„Éà„Åå1Áßí‰ª•ÂÜÖ
    http_req_failed: ['rate<0.05'],    // „Ç®„É©„ÉºÁéá5%Êú™Ê∫Ä
  },
}

export default function () {
  // „Çª„ÉÉ„Ç∑„Éß„É≥‰ΩúÊàê
  let createResponse = http.post('http://localhost:5000/api/auth/demo', {
    password: 'test-password',
  })
  
  check(createResponse, {
    '„Çª„ÉÉ„Ç∑„Éß„É≥‰ΩúÊàê„ÅåÊàêÂäü„Åô„Çã': (r) => r.status === 200,
    '„Çª„ÉÉ„Ç∑„Éß„É≥‰ΩúÊàê„Åå1Áßí‰ª•ÂÜÖ': (r) => r.timings.duration < 1000,
  })
  
  if (createResponse.status === 200) {
    let token = JSON.parse(createResponse.body).token
    
    // „Çª„ÉÉ„Ç∑„Éß„É≥Ê§úË®º
    let validateResponse = http.get('http://localhost:5000/api/auth/validate', {
      headers: {
        'Authorization': `Bearer ${token}`,
      },
    })
    
    check(validateResponse, {
      '„Çª„ÉÉ„Ç∑„Éß„É≥Ê§úË®º„ÅåÊàêÂäü„Åô„Çã': (r) => r.status === 200,
      '„Çª„ÉÉ„Ç∑„Éß„É≥Ê§úË®º„Åå500ms‰ª•ÂÜÖ': (r) => r.timings.duration < 500,
    })
  }
  
  sleep(1)
}
```

---

## üìä „ÉÜ„Çπ„ÉàÂÆüË°åË®àÁîª

### „ÉÜ„Çπ„ÉàÂÆüË°å„Çπ„Ç±„Ç∏„É•„Éº„É´

#### Phase 1: Âçò‰Ωì„ÉÜ„Çπ„ÉàÔºà1Êó•Ôºâ
- **ÊúüÈñì**: ÂÆüË£ÖÂÆå‰∫ÜÂæå
- **ÂØæË±°**: ÂÖ®„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
- **ÂÆüË°åËÄÖ**: ÈñãÁô∫ËÄÖ
- **ÁõÆÊ®ô**: „Ç≥„Éº„Éâ„Ç´„Éê„É¨„ÉÉ„Ç∏80%‰ª•‰∏ä

#### Phase 2: Áµ±Âêà„ÉÜ„Çπ„ÉàÔºà1Êó•Ôºâ
- **ÊúüÈñì**: Âçò‰Ωì„ÉÜ„Çπ„ÉàÂÆå‰∫ÜÂæå
- **ÂØæË±°**: ‰∏ªË¶Å„Å™Áµ±Âêà„Éù„Ç§„É≥„Éà
- **ÂÆüË°åËÄÖ**: ÈñãÁô∫ËÄÖ
- **ÁõÆÊ®ô**: ÂÖ®Áµ±Âêà„Éù„Ç§„É≥„Éà„ÅÆ100%„ÉÜ„Çπ„Éà

#### Phase 3: E2E„ÉÜ„Çπ„ÉàÔºà1Êó•Ôºâ
- **ÊúüÈñì**: Áµ±Âêà„ÉÜ„Çπ„ÉàÂÆå‰∫ÜÂæå
- **ÂØæË±°**: ‰∏ªË¶Å„Å™„É¶„Éº„Ç∂„Éº„Éï„É≠„Éº
- **ÂÆüË°åËÄÖ**: „ÉÜ„Çπ„Éà„Ç®„É≥„Ç∏„Éã„Ç¢
- **ÁõÆÊ®ô**: ÂÖ®„É¶„Éº„Ç∂„Éº„Éï„É≠„Éº„ÅÆ100%„ÉÜ„Çπ„Éà

#### Phase 4: „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„ÉàÔºà1Êó•Ôºâ
- **ÊúüÈñì**: E2E„ÉÜ„Çπ„ÉàÂÆå‰∫ÜÂæå
- **ÂØæË±°**: Ë™çË®º„ÉªË™çÂèØ„Éª„Éá„Éº„Çø‰øùË≠∑
- **ÂÆüË°åËÄÖ**: „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç®„É≥„Ç∏„Éã„Ç¢
- **ÁõÆÊ®ô**: „Çª„Ç≠„É•„É™„ÉÜ„Ç£Ë¶Å‰ª∂„ÅÆ100%Ê∫ÄË∂≥

#### Phase 5: „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„ÉàÔºà1Êó•Ôºâ
- **ÊúüÈñì**: „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„ÉàÂÆå‰∫ÜÂæå
- **ÂØæË±°**: Ë™çË®ºÂá¶ÁêÜ„Éª„Çª„ÉÉ„Ç∑„Éß„É≥ÁÆ°ÁêÜ
- **ÂÆüË°åËÄÖ**: „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„Ç®„É≥„Ç∏„Éã„Ç¢
- **ÁõÆÊ®ô**: „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπË¶Å‰ª∂„ÅÆ100%ÈÅîÊàê

### „ÉÜ„Çπ„ÉàÁí∞Â¢É

#### ÈñãÁô∫Áí∞Â¢É
- **Áî®ÈÄî**: Âçò‰Ωì„ÉÜ„Çπ„Éà„ÉªÁµ±Âêà„ÉÜ„Çπ„Éà
- **Ë®≠ÂÆö**: ÂÖ®Ë™çË®º„É¢„Éº„ÉâÊúâÂäπ
- **„Éá„Éº„Çø**: „ÉÜ„Çπ„Éà„Éá„Éº„Çø„Çª„ÉÉ„Éà

#### „Çπ„ÉÜ„Éº„Ç∏„É≥„Ç∞Áí∞Â¢É
- **Áî®ÈÄî**: E2E„ÉÜ„Çπ„Éà„Éª„Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„Éà
- **Ë®≠ÂÆö**: Êú¨Áï™Áí∞Â¢É„Å®ÂêåÁ≠â
- **„Éá„Éº„Çø**: ÂåøÂêçÂåñ„Éá„Éº„Çø

#### Êú¨Áï™Áí∞Â¢É
- **Áî®ÈÄî**: „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„ÉàÔºàÈôêÂÆöÁöÑÔºâ
- **Ë®≠ÂÆö**: Êú¨Áï™Ë®≠ÂÆö
- **„Éá„Éº„Çø**: Êú¨Áï™„Éá„Éº„ÇøÔºàË™≠„ÅøÂèñ„ÇäÂ∞ÇÁî®Ôºâ

---

## üìà „ÉÜ„Çπ„ÉàÁµêÊûúË©ï‰æ°

### ÊàêÂäüÂü∫Ê∫ñ

#### Âçò‰Ωì„ÉÜ„Çπ„Éà
- **„Ç≥„Éº„Éâ„Ç´„Éê„É¨„ÉÉ„Ç∏**: 80%‰ª•‰∏ä
- **„ÉÜ„Çπ„ÉàÊàêÂäüÁéá**: 95%‰ª•‰∏ä
- **ÂÆüË°åÊôÇÈñì**: 5ÂàÜ‰ª•ÂÜÖ

#### Áµ±Âêà„ÉÜ„Çπ„Éà
- **„ÉÜ„Çπ„ÉàÊàêÂäüÁéá**: 100%
- **ÂÆüË°åÊôÇÈñì**: 10ÂàÜ‰ª•ÂÜÖ
- **„Ç®„É©„ÉºÁéá**: 0%

#### E2E„ÉÜ„Çπ„Éà
- **„ÉÜ„Çπ„ÉàÊàêÂäüÁéá**: 95%‰ª•‰∏ä
- **ÂÆüË°åÊôÇÈñì**: 30ÂàÜ‰ª•ÂÜÖ
- **„É¶„Éº„Ç∂„Éì„É™„ÉÜ„Ç£„Çπ„Ç≥„Ç¢**: 4.0/5.0‰ª•‰∏ä

#### „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„Éà
- **ËÑÜÂº±ÊÄß**: 0‰ª∂
- **„Çª„Ç≠„É•„É™„ÉÜ„Ç£Ë¶Å‰ª∂**: 100%Ê∫ÄË∂≥
- **Ë™çË®ºÂº∑Â∫¶**: È´ò

#### „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà
- **Ë™çË®ºÂá¶ÁêÜÊôÇÈñì**: 3Áßí‰ª•ÂÜÖ
- **„Çª„ÉÉ„Ç∑„Éß„É≥ÁÆ°ÁêÜÊôÇÈñì**: 1Áßí‰ª•ÂÜÖ
- **ÂêåÊôÇÊé•Á∂öÊï∞**: 100„É¶„Éº„Ç∂„Éº‰ª•‰∏ä

### Â§±ÊïóÊôÇ„ÅÆÂØæÂøú

#### Âçò‰Ωì„ÉÜ„Çπ„ÉàÂ§±Êïó
1. **ÂéüÂõ†ÂàÜÊûê**: „Ç≥„Éº„Éâ„É¨„Éì„É•„Éº„Éª„É≠„Ç∞ÂàÜÊûê
2. **‰øÆÊ≠£ÂÆüË£Ö**: ÂïèÈ°åÁÆáÊâÄ„ÅÆ‰øÆÊ≠£
3. **ÂÜç„ÉÜ„Çπ„Éà**: ‰øÆÊ≠£Âæå„ÅÆ„ÉÜ„Çπ„ÉàÂÆüË°å
4. **ÂõûÂ∏∞„ÉÜ„Çπ„Éà**: Èñ¢ÈÄ£Ê©üËÉΩ„ÅÆ„ÉÜ„Çπ„Éà

#### Áµ±Âêà„ÉÜ„Çπ„ÉàÂ§±Êïó
1. **Áí∞Â¢ÉÁ¢∫Ë™ç**: „ÉÜ„Çπ„ÉàÁí∞Â¢É„ÅÆË®≠ÂÆöÁ¢∫Ë™ç
2. **‰æùÂ≠òÈñ¢‰øÇÁ¢∫Ë™ç**: Â§ñÈÉ®„Çµ„Éº„Éì„ÇπÈÄ£Êê∫Á¢∫Ë™ç
3. **‰øÆÊ≠£ÂÆüË£Ö**: Áµ±ÂêàÈÉ®ÂàÜ„ÅÆ‰øÆÊ≠£
4. **ÂÜç„ÉÜ„Çπ„Éà**: ‰øÆÊ≠£Âæå„ÅÆ„ÉÜ„Çπ„ÉàÂÆüË°å

#### E2E„ÉÜ„Çπ„ÉàÂ§±Êïó
1. **„É¶„Éº„Ç∂„Éº„Éï„É≠„ÉºÂàÜÊûê**: Â§±Êïó„Åó„Åü„Éï„É≠„Éº„ÅÆÂàÜÊûê
2. **UI/UXÁ¢∫Ë™ç**: ÁîªÈù¢Ë°®Á§∫„ÉªÊìç‰Ωú„ÅÆÁ¢∫Ë™ç
3. **‰øÆÊ≠£ÂÆüË£Ö**: UI/UX„ÅÆ‰øÆÊ≠£
4. **ÂÜç„ÉÜ„Çπ„Éà**: ‰øÆÊ≠£Âæå„ÅÆ„ÉÜ„Çπ„ÉàÂÆüË°å

#### „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„ÉàÂ§±Êïó
1. **ËÑÜÂº±ÊÄßÂàÜÊûê**: „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Éõ„Éº„É´„ÅÆÂàÜÊûê
2. **Á∑äÊÄ•ÂØæÂøú**: „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Éë„ÉÉ„ÉÅ„ÅÆÈÅ©Áî®
3. **‰øÆÊ≠£ÂÆüË£Ö**: „Çª„Ç≠„É•„É™„ÉÜ„Ç£Âº∑Âåñ
4. **ÂÜç„ÉÜ„Çπ„Éà**: „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„Éà„ÅÆÂÜçÂÆüË°å

#### „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„ÉàÂ§±Êïó
1. **„Éú„Éà„É´„Éç„ÉÉ„ÇØÂàÜÊûê**: ÊÄßËÉΩÂïèÈ°å„ÅÆÁâπÂÆö
2. **ÊúÄÈÅ©ÂåñÂÆüË£Ö**: „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊîπÂñÑ
3. **ÂÜç„ÉÜ„Çπ„Éà**: „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà„ÅÆÂÜçÂÆüË°å
4. **Áõ£Ë¶ñË®≠ÂÆö**: Êú¨Áï™Áí∞Â¢É„Åß„ÅÆÁõ£Ë¶ñË®≠ÂÆö

---

## üìö „ÉÜ„Çπ„Éà„Éâ„Ç≠„É•„É°„É≥„Éà

### „ÉÜ„Çπ„Éà„Ç±„Éº„ÇπÁÆ°ÁêÜ

#### „ÉÜ„Çπ„Éà„Ç±„Éº„ÇπID‰ΩìÁ≥ª
```
UT-{Ê©üËÉΩ}-{Áï™Âè∑}    # Âçò‰Ωì„ÉÜ„Çπ„Éà
IT-{Ê©üËÉΩ}-{Áï™Âè∑}    # Áµ±Âêà„ÉÜ„Çπ„Éà
E2E-{Ê©üËÉΩ}-{Áï™Âè∑}   # E2E„ÉÜ„Çπ„Éà
SEC-{Ê©üËÉΩ}-{Áï™Âè∑}   # „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„Éà
PERF-{Ê©üËÉΩ}-{Áï™Âè∑}  # „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà
```

#### „ÉÜ„Çπ„Éà„Ç±„Éº„Çπ‰æã
- `UT-AUTH-001`: Êú¨Áï™Áí∞Â¢É„ÅßShopifyË™çË®º„Çø„Ç§„Éà„É´„ÇíË°®Á§∫„Åô„Çã
- `IT-AUTH-001`: „Éá„É¢Ë™çË®º„Åß„Çª„ÉÉ„Ç∑„Éß„É≥„Åå‰ΩúÊàê„Åï„Çå„Çã
- `E2E-AUTH-001`: Êú¨Áï™Áí∞Â¢É„Åß„ÅÆOAuthË™çË®º„Éï„É≠„Éº
- `SEC-AUTH-001`: „Éë„Çπ„ÉØ„Éº„Éâ„Éè„ÉÉ„Ç∑„É•„ÅåBCrypt„ÅßÊöóÂè∑Âåñ„Åï„Çå„Çã
- `PERF-AUTH-001`: Ë™çË®ºÂá¶ÁêÜ„Åå3Áßí‰ª•ÂÜÖ„ÅßÂÆå‰∫Ü„Åô„Çã

### „ÉÜ„Çπ„ÉàÁµêÊûú„É¨„Éù„Éº„Éà

#### Êó•Ê¨°„É¨„Éù„Éº„Éà
- „ÉÜ„Çπ„ÉàÂÆüË°åÁä∂Ê≥Å
- ÊàêÂäüÁéá„ÉªÂ§±ÊïóÁéá
- ÂÆüË°åÊôÇÈñì
- „Ç®„É©„ÉºË©≥Á¥∞

#### ÈÄ±Ê¨°„É¨„Éù„Éº„Éà
- „ÉÜ„Çπ„Éà„Éà„É¨„É≥„ÉâÂàÜÊûê
- ÂìÅË≥™ÊåáÊ®ô
- ÊîπÂñÑÊèêÊ°à
- Ê¨°ÈÄ±Ë®àÁîª

#### „É™„É™„Éº„ÇπÂâç„É¨„Éù„Éº„Éà
- ÂÖ®„ÉÜ„Çπ„ÉàÁµêÊûú„Çµ„Éû„É™„Éº
- ÂìÅË≥™Ë©ï‰æ°
- „É™„É™„Éº„ÇπÂèØÂê¶Âà§ÂÆö
- „É™„Çπ„ÇØË©ï‰æ°

---

## üìù Êõ¥Êñ∞Â±•Ê≠¥

| Êó•‰ªò | ÂÜÖÂÆπ | ÊãÖÂΩìËÄÖ |
|------|------|--------|
| 2025-10-25 | ÂàùÁâà‰ΩúÊàê | Kenji |

---

**ÊúÄÁµÇÊõ¥Êñ∞**: 2025Âπ¥10Êúà25Êó•  
**Ê¨°Âõû„É¨„Éì„É•„Éº**: 2025Âπ¥11Êúà1Êó•ÔºàÈÄ±Ê¨°Ôºâ
