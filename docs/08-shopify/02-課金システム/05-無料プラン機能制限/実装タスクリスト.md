# 無料プラン機能制限 実装タスクリスト

> **作成日**: 2025年8月24日  
> **作成者**: Kenji（AIプロジェクトマネージャー）  
> **バージョン**: 1.0  
> **総工数見積もり**: 5人日（バックエンド2.5日 + フロントエンド2.5日）

## 1. 実装概要とスケジュール

### タイムライン
```
Day 1 (8/26): データベース構築とAPI基盤実装
Day 2 (8/27): ビジネスロジックとフロントエンド基盤
Day 3 (8/28): UI実装と統合
Day 4 (8/29): テストとバグ修正
Day 5 (8/30): 最終調整とドキュメント完成
```

## 2. Phase 1: データベース実装（Day 1 AM）

### 担当: Takashi
**工数**: 0.5日

#### Task 1.1: テーブル作成 [2時間]
- [ ] UserFeatureSelections テーブル作成
- [ ] FeatureUsageLogs テーブル作成
- [ ] FeatureLimits マスタテーブル作成
- [ ] インデックス設定
- [ ] 制約（外部キー、チェック制約）設定

```sql
-- マイグレーションスクリプトを作成
-- docs/04-development/03-データベース/マイグレーション/2025-08-26-free-plan-feature-selection.sql
```

#### Task 1.2: ストアドプロシージャ作成 [1時間]
- [ ] sp_ChangeFeatureSelection 作成
- [ ] sp_GetFeatureUsageStats 作成
- [ ] sp_CheckFeatureAccess 作成

#### Task 1.3: 初期データ投入 [1時間]
- [ ] FeatureLimits テーブルへの制限値投入
- [ ] テストデータの準備
- [ ] 開発環境での動作確認

**成果物**:
- データベースマイグレーションスクリプト
- 実行確認ログ
- ERD更新

---

## 3. Phase 2: バックエンドAPI実装（Day 1 PM - Day 2 AM）

### 担当: Takashi
**工数**: 1日

#### Task 2.1: モデルクラス作成 [1時間]
- [ ] UserFeatureSelection エンティティ
- [ ] FeatureUsageLog エンティティ
- [ ] FeatureLimit エンティティ
- [ ] DbContext への追加

```csharp
// Models/UserFeatureSelection.cs
// Models/FeatureUsageLog.cs
// Models/FeatureLimit.cs
```

#### Task 2.2: DTOとレスポンスモデル作成 [1時間]
- [ ] FeatureSelectionResponse
- [ ] SelectFeatureRequest/Result
- [ ] AvailableFeature
- [ ] FeatureUsageResponse

#### Task 2.3: サービス層実装 [3時間]
- [ ] IFeatureSelectionService インターフェース定義
- [ ] FeatureSelectionService 実装
  - [ ] GetCurrentSelectionAsync
  - [ ] SelectFeatureAsync
  - [ ] CheckFeatureAccessAsync
  - [ ] LogFeatureUsageAsync
- [ ] キャッシング実装（IMemoryCache）
- [ ] エラーハンドリング

#### Task 2.4: コントローラー実装 [2時間]
- [ ] FeatureSelectionController 作成
- [ ] エンドポイント実装
  - [ ] GET /api/feature-selection/current
  - [ ] POST /api/feature-selection/select
  - [ ] GET /api/feature-selection/available-features
  - [ ] GET /api/feature-selection/usage/{feature}
- [ ] 認証・認可設定
- [ ] Swagger ドキュメント追加

#### Task 2.5: ミドルウェア実装 [1時間]
- [ ] FeatureAccessMiddleware 作成
- [ ] 機能アクセス制御の自動チェック
- [ ] 使用状況の自動記録

**成果物**:
- 動作するAPIエンドポイント
- Postmanコレクション
- API仕様書更新

---

## 4. Phase 3: フロントエンド基盤実装（Day 2 PM）

### 担当: Yuki
**工数**: 0.5日

#### Task 3.1: API クライアント実装 [1時間]
- [ ] featureSelection.ts API クライアント作成
- [ ] 型定義ファイル作成
- [ ] エラーハンドリング実装

```typescript
// lib/api/featureSelection.ts
// types/featureSelection.ts
```

#### Task 3.2: Zustand Store 実装 [2時間]
- [ ] featureSelectionStore.ts 作成
- [ ] 状態管理ロジック実装
- [ ] persist ミドルウェア設定
- [ ] devtools 設定

#### Task 3.3: カスタムフック作成 [1時間]
- [ ] useFeatureSelection フック
- [ ] useFeatureAccess フック
- [ ] useFeatureUsage フック

**成果物**:
- 動作する状態管理システム
- 再利用可能なフック
- TypeScript型定義

---

## 5. Phase 4: UIコンポーネント実装（Day 3）

### 担当: Yuki
**工数**: 1日

#### Task 4.1: 機能選択画面実装 [3時間]
- [ ] FeatureSelector.tsx メインコンポーネント
- [ ] FeatureCard.tsx 機能カード
- [ ] FeatureComparison.tsx 比較表
- [ ] レスポンシブデザイン対応

#### Task 4.2: モーダル・ダイアログ実装 [2時間]
- [ ] ChangeFeatureModal.tsx 変更確認モーダル
- [ ] FirstSelectionWizard.tsx 初回選択ウィザード
- [ ] アニメーション実装

#### Task 4.3: アラート・通知実装 [1時間]
- [ ] UsageLimitAlert.tsx 使用制限アラート
- [ ] UpgradePrompt.tsx アップグレード促進
- [ ] Toast通知実装

#### Task 4.4: 統合とルーティング [2時間]
- [ ] ページコンポーネント作成
- [ ] ルーティング設定
- [ ] ナビゲーション更新
- [ ] 権限チェック実装

**成果物**:
- 完成したUI画面
- Storybookストーリー
- スクリーンショット

---

## 6. Phase 5: 機能別実装（Day 3-4）

### 6.1 休眠顧客分析機能の制限実装

#### 担当: Takashi
**工数**: 0.5日

- [ ] DormantCustomerService の制限チェック追加
- [ ] 顧客数制限（1,000名）の実装
- [ ] データ期間制限（180日）の実装
- [ ] レポート生成回数制限（月2回）の実装
- [ ] エラーメッセージのローカライゼーション

### 6.2 前年同月比分析機能の制限実装

#### 担当: Takashi
**工数**: 0.5日

- [ ] YearOverYearService の制限チェック追加
- [ ] 比較期間制限（12ヶ月）の実装
- [ ] カテゴリ数制限（10個）の実装
- [ ] セグメント数制限（5個）の実装
- [ ] グラフ表示制限の実装

### 6.3 購入回数詳細分析機能の制限実装

#### 担当: Yuki
**工数**: 0.5日

- [ ] PurchaseFrequencyService の制限チェック追加
- [ ] 分析期間制限（6ヶ月）の実装
- [ ] 顧客数制限（2,000名）の実装
- [ ] 予測期間制限（30日）の実装
- [ ] UIでの制限表示実装

---

## 7. Phase 6: テスト実装（Day 4）

### 7.1 バックエンドテスト

#### 担当: Takashi
**工数**: 0.5日

#### Task 7.1.1: 単体テスト [2時間]
- [ ] FeatureSelectionService テスト
- [ ] 機能変更ロジックのテスト
- [ ] 制限チェックロジックのテスト
- [ ] エッジケーステスト

#### Task 7.1.2: 統合テスト [2時間]
- [ ] API エンドポイントテスト
- [ ] データベース連携テスト
- [ ] キャッシュ動作テスト
- [ ] 認証・認可テスト

### 7.2 フロントエンドテスト

#### 担当: Yuki
**工数**: 0.5日

#### Task 7.2.1: コンポーネントテスト [2時間]
- [ ] React Testing Library でのユニットテスト
- [ ] カスタムフックのテスト
- [ ] Store のテスト

#### Task 7.2.2: E2Eテスト [2時間]
- [ ] Playwright での E2E テストシナリオ
- [ ] 初回選択フローテスト
- [ ] 機能変更フローテスト
- [ ] 制限到達時の動作テスト

---

## 8. Phase 7: 最終調整とドキュメント（Day 5）

### 担当: 全員
**工数**: 1日

#### Task 8.1: バグ修正と改善 [Takashi: 2時間]
- [ ] テストで発見されたバグの修正
- [ ] パフォーマンス最適化
- [ ] エラーハンドリング改善

#### Task 8.2: UI/UX改善 [Yuki: 2時間]
- [ ] ユーザビリティ改善
- [ ] アニメーション調整
- [ ] レスポンシブデザイン調整

#### Task 8.3: ドキュメント作成 [Kenji: 4時間]
- [ ] 技術ドキュメント完成
- [ ] 運用マニュアル作成
- [ ] FAQ作成
- [ ] リリースノート準備

#### Task 8.4: デモ準備 [全員: 2時間]
- [ ] デモシナリオ作成
- [ ] デモデータ準備
- [ ] プレゼンテーション資料作成

---

## 9. リスクと対策

### リスク1: スケジュール遅延
**対策**: 
- 毎日の進捗確認ミーティング
- ブロッカーの早期発見と解決
- 必要に応じて優先度調整

### リスク2: 技術的課題
**対策**:
- 早期のプロトタイプ作成
- ペアプログラミングの活用
- 外部リソースの活用検討

### リスク3: 品質問題
**対策**:
- コードレビューの徹底
- 自動テストの充実
- 段階的リリース

---

## 10. 成功基準

### 技術面
- [ ] すべてのAPIエンドポイントが正常動作
- [ ] レスポンスタイム < 500ms
- [ ] テストカバレッジ > 80%
- [ ] エラー率 < 0.1%

### ビジネス面
- [ ] 3つの機能が選択・切り替え可能
- [ ] 制限が正しく適用される
- [ ] ユーザーフレンドリーなUI
- [ ] 明確なアップグレードパス

---

## 11. 役割分担サマリー

### Takashi（バックエンド担当）
- データベース構築
- API実装
- ビジネスロジック実装
- バックエンドテスト
- 合計: 2.5日

### Yuki（フロントエンド担当）
- UI/UXデザイン実装
- 状態管理実装
- コンポーネント開発
- フロントエンドテスト
- 合計: 2.5日

### Kenji（PM/調整担当）
- 全体進捗管理
- ドキュメント作成
- ステークホルダー調整
- 品質管理
- 合計: 継続的

---

## 12. 次のアクション

1. **本日中（8/24）**:
   - このタスクリストのレビューと承認
   - チームメンバーへの作業割り当て確認

2. **明日（8/25）**:
   - 開発環境の準備
   - 必要なツール・ライブラリの確認

3. **週明け（8/26）**:
   - Phase 1 開始
   - 日次進捗ミーティング開始

---

**最終更新**: 2025年8月24日 19:30  
**承認者**: 待機中  
**開始予定日**: 2025年8月26日