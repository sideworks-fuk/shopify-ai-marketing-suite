# å‰å¹´åŒæœˆæ¯”ã€å•†å“ã€‘æ©Ÿèƒ½ - è©³ç´°è¨­è¨ˆæ›¸

ä½œæˆæ—¥: 2025å¹´6æœˆ10æ—¥  
æ›´æ–°æ—¥: 2025å¹´6æœˆ10æ—¥  
ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: è¨­è¨ˆä¸­  

## ğŸ“‹ 1. æ©Ÿèƒ½æ¦‚è¦ã¨å®Ÿè£…å„ªå…ˆåº¦è©•ä¾¡

### 1.1 æ©Ÿèƒ½æ¦‚è¦
å•†å“åˆ¥ã®å£²ä¸Šã‚’å‰å¹´åŒæœˆã¨æ¯”è¼ƒã—ã€æˆé•·ç‡ãƒ»é‡‘é¡å·®ã‚’å¯è¦–åŒ–ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚å­£ç¯€æ€§ã®æŠŠæ¡ã¨å•†å“æˆ¦ç•¥ã®æœ€é©åŒ–ã«æ´»ç”¨ã•ã‚Œã¾ã™ã€‚

### 1.2 4æ©Ÿèƒ½ã®å®Ÿè£…å„ªå…ˆåº¦æ¯”è¼ƒ

| æ©Ÿèƒ½å | è¤‡é›‘åº¦ | ãƒ‡ãƒ¼ã‚¿å–å¾—é›£æ˜“åº¦ | UIè¤‡é›‘åº¦ | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è² è· | æ¨å¥¨é †ä½ |
|--------|--------|------------------|----------|------------------|----------|
| **å‰å¹´åŒæœˆæ¯”ã€å•†å“ã€‘** | â­â­ | â­â­ | â­â­ | â­â­ | **1ä½** |
| ä¼‘çœ é¡§å®¢ã€é¡§å®¢ã€‘ | â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­ | 2ä½ |
| çµ„ã¿åˆã‚ã›å•†å“ã€å•†å“ã€‘ | â­â­â­â­ | â­â­ | â­â­â­ | â­â­â­â­ | 3ä½ |
| Féšå±¤å‚¾å‘ã€è³¼è²·ã€‘ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | 4ä½ |

### 1.3 å‰å¹´åŒæœˆæ¯”æ©Ÿèƒ½ãŒæœ€é©ãªç†ç”±
1. **ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãŒã‚·ãƒ³ãƒ—ãƒ«**: å•†å“Ã—æœˆÃ—å£²ä¸Šã®3æ¬¡å…ƒãƒ‡ãƒ¼ã‚¿ã®ã¿
2. **è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ãŒæ˜ç¢º**: å˜ç´”ãªå‰å¹´æ¯”è¼ƒæ¼”ç®—
3. **Shopify APIã®æ¨™æº–ãƒ‡ãƒ¼ã‚¿**: è¿½åŠ ã®ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãŒä¸è¦
4. **UIè¦ä»¶ãŒã‚·ãƒ³ãƒ—ãƒ«**: æ—¢å­˜å®Ÿè£…ã‚’æ´»ç”¨å¯èƒ½
5. **åŸºç›¤æŠ€è¡“ã®ç¢ºç«‹**: ä»–æ©Ÿèƒ½ã®åŸºç›¤ã¨ãªã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ§‹ç¯‰

## ğŸ“Š 2. ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³åˆ†æ

### 2.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…çŠ¶æ³
- âœ… UIå®Œæˆåº¦: 90%ï¼ˆæœˆåˆ¥è©³ç´°è¡¨ç¤ºã€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€CSVå‡ºåŠ›ï¼‰
- ğŸŸ¡ ãƒ‡ãƒ¼ã‚¿é€£æº: 0%ï¼ˆãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨ä¸­ï¼‰
- ğŸŸ¡ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: 30%ï¼ˆåŸºæœ¬çš„ãªå‡¦ç†ã®ã¿ï¼‰

### 2.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…çŠ¶æ³
- âŒ .NET Web API: æœªå®Ÿè£…
- âŒ Shopify APIé€£æº: æœªå®Ÿè£…
- âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ: æœªå®Ÿè£…
- âŒ ãƒ‡ãƒ¼ã‚¿é›†è¨ˆå‡¦ç†: æœªå®Ÿè£…

### 2.3 ç¾åœ¨ã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Next.js 15.1.0 + React 18.2.0 + TypeScript
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: .NET 8 C#ï¼ˆäºˆå®šï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: PostgreSQLï¼ˆäºˆå®šï¼‰
- **èªè¨¼**: Clerk
- **å¤–éƒ¨API**: Shopify GraphQL Admin API

## ğŸ—ï¸ 3. ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ

### 3.1 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦
```
[Next.js Frontend] â†” [.NET Web API] â†” [PostgreSQL] â†” [Shopify API]
```

### 3.2 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ
```
1. ãƒãƒƒãƒå‡¦ç†ï¼ˆæ—¥æ¬¡ï¼‰: Shopify API â†’ ãƒ‡ãƒ¼ã‚¿é›†è¨ˆ â†’ PostgreSQLä¿å­˜
2. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º: Frontend â†’ .NET API â†’ PostgreSQL â†’ Frontend
3. æœŸé–“æŒ‡å®šåˆ†æ: Frontend â†’ .NET API â†’ å‹•çš„é›†è¨ˆ â†’ Frontend
```

## ğŸ’¾ 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 4.1 ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆï¼ˆPostgreSQLï¼‰

```sql
-- å•†å“ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE products (
    product_id VARCHAR(50) PRIMARY KEY,
    shopify_product_id BIGINT UNIQUE NOT NULL,
    product_title VARCHAR(500) NOT NULL,
    product_type VARCHAR(100),
    vendor VARCHAR(100),
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ—¥æ¬¡å£²ä¸Šé›†è¨ˆãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE daily_product_sales (
    id SERIAL PRIMARY KEY,
    product_id VARCHAR(50) REFERENCES products(product_id),
    sale_date DATE NOT NULL,
    quantity_sold INTEGER DEFAULT 0,
    total_sales DECIMAL(12,2) DEFAULT 0.00,
    order_count INTEGER DEFAULT 0,
    avg_order_value DECIMAL(10,2) DEFAULT 0.00,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(product_id, sale_date)
);

-- æœˆæ¬¡é›†è¨ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆé«˜é€ŸåŒ–ç”¨ï¼‰
CREATE TABLE monthly_product_sales (
    id SERIAL PRIMARY KEY,
    product_id VARCHAR(50) REFERENCES products(product_id),
    year INTEGER NOT NULL,
    month INTEGER NOT NULL CHECK (month >= 1 AND month <= 12),
    quantity_sold INTEGER DEFAULT 0,
    total_sales DECIMAL(12,2) DEFAULT 0.00,
    order_count INTEGER DEFAULT 0,
    avg_order_value DECIMAL(10,2) DEFAULT 0.00,
    days_with_sales INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(product_id, year, month)
);

-- å‰å¹´åŒæœˆæ¯”ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE year_over_year_cache (
    id SERIAL PRIMARY KEY,
    product_id VARCHAR(50) REFERENCES products(product_id),
    current_year INTEGER NOT NULL,
    current_month INTEGER NOT NULL,
    current_sales DECIMAL(12,2) DEFAULT 0.00,
    previous_sales DECIMAL(12,2) DEFAULT 0.00,
    growth_rate DECIMAL(8,2) DEFAULT 0.00,
    growth_amount DECIMAL(12,2) DEFAULT 0.00,
    current_quantity INTEGER DEFAULT 0,
    previous_quantity INTEGER DEFAULT 0,
    quantity_growth_rate DECIMAL(8,2) DEFAULT 0.00,
    last_calculated TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(product_id, current_year, current_month)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
CREATE INDEX idx_daily_sales_date ON daily_product_sales(sale_date);
CREATE INDEX idx_daily_sales_product_date ON daily_product_sales(product_id, sale_date);
CREATE INDEX idx_monthly_sales_year_month ON monthly_product_sales(year, month);
CREATE INDEX idx_monthly_sales_product_year ON monthly_product_sales(product_id, year);
CREATE INDEX idx_yoy_cache_year_month ON year_over_year_cache(current_year, current_month);
```

## ğŸ”§ 5. .NET Web APIè¨­è¨ˆ

### 5.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 
```
ShopifyAnalytics.API/
â”œâ”€â”€ Controllers/
â”‚   â””â”€â”€ YearOverYearController.cs
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ IShopifyService.cs
â”‚   â”œâ”€â”€ ShopifyService.cs
â”‚   â”œâ”€â”€ IAnalyticsService.cs
â”‚   â””â”€â”€ AnalyticsService.cs
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ DTOs/
â”‚   â”‚   â”œâ”€â”€ YearOverYearRequestDto.cs
â”‚   â”‚   â””â”€â”€ YearOverYearResponseDto.cs
â”‚   â””â”€â”€ Entities/
â”‚       â”œâ”€â”€ Product.cs
â”‚       â”œâ”€â”€ DailyProductSales.cs
â”‚       â””â”€â”€ MonthlyProductSales.cs
â”œâ”€â”€ Data/
â”‚   â”œâ”€â”€ AnalyticsDbContext.cs
â”‚   â””â”€â”€ Repositories/
â”‚       â”œâ”€â”€ IProductRepository.cs
â”‚       â””â”€â”€ ProductRepository.cs
â””â”€â”€ Background/
    â””â”€â”€ DataAggregationService.cs
```

### 5.2 APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¨­è¨ˆ

```csharp
// Controllers/YearOverYearController.cs
[ApiController]
[Route("api/analytics/year-over-year")]
public class YearOverYearController : ControllerBase
{
    private readonly IAnalyticsService _analyticsService;

    [HttpGet("products")]
    public async Task<ActionResult<YearOverYearResponse>> GetYearOverYearProducts(
        [FromQuery] YearOverYearRequest request)
    {
        var result = await _analyticsService.GetYearOverYearAnalysisAsync(request);
        return Ok(result);
    }

    [HttpPost("refresh")]
    public async Task<ActionResult> RefreshData([FromBody] RefreshRequest request)
    {
        await _analyticsService.RefreshYearOverYearDataAsync(request);
        return Ok(new { message = "ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚’é–‹å§‹ã—ã¾ã—ãŸ" });
    }
}
```

### 5.3 DTOã‚¯ãƒ©ã‚¹è¨­è¨ˆ

```csharp
// Models/DTOs/YearOverYearRequestDto.cs
public class YearOverYearRequest
{
    public int Year { get; set; } = DateTime.Now.Year;
    public int? StartMonth { get; set; } = 1;
    public int? EndMonth { get; set; } = 12;
    public List<string>? ProductTypes { get; set; }
    public string? SortBy { get; set; } = "growth_rate";
    public string? SortOrder { get; set; } = "desc";
    public int? Limit { get; set; } = 50;
    public int? Offset { get; set; } = 0;
    public string? SearchTerm { get; set; }
    public string? GrowthFilter { get; set; } = "all";
}

// Models/DTOs/YearOverYearResponseDto.cs
public class YearOverYearResponse
{
    public List<YearOverYearProductData> Products { get; set; } = new();
    public YearOverYearSummary Summary { get; set; } = new();
    public YearOverYearMetadata Metadata { get; set; } = new();
}

public class YearOverYearProductData
{
    public string ProductId { get; set; } = string.Empty;
    public string ProductTitle { get; set; } = string.Empty;
    public string ProductType { get; set; } = string.Empty;
    public decimal CurrentYearSales { get; set; }
    public decimal PreviousYearSales { get; set; }
    public decimal GrowthRate { get; set; }
    public decimal GrowthAmount { get; set; }
    public List<MonthlyComparisonData> MonthlyData { get; set; } = new();
}

public class MonthlyComparisonData
{
    public int Month { get; set; }
    public decimal CurrentSales { get; set; }
    public decimal PreviousSales { get; set; }
    public decimal GrowthRate { get; set; }
    public int CurrentQuantity { get; set; }
    public int PreviousQuantity { get; set; }
}
```

## ğŸ”„ 6. ãƒãƒƒãƒå‡¦ç†è¨­è¨ˆ

### 6.1 ãƒ‡ãƒ¼ã‚¿é›†è¨ˆæˆ¦ç•¥

```csharp
// Background/DataAggregationService.cs
public class DataAggregationService : BackgroundService
{
    private readonly IServiceProvider _serviceProvider;
    private readonly ILogger<DataAggregationService> _logger;

    protected override async Task ExecuteAsync(CancellationToken stoppingToken)
    {
        while (!stoppingToken.IsCancellationRequested)
        {
            try
            {
                using var scope = _serviceProvider.CreateScope();
                var shopifyService = scope.ServiceProvider.GetRequiredService<IShopifyService>();
                var analyticsService = scope.ServiceProvider.GetRequiredService<IAnalyticsService>();

                // æ¯æ—¥åˆå‰2æ™‚ã«å‰æ—¥ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†
                var now = DateTime.Now;
                var targetDate = now.Date.AddDays(-1);

                // 1. Shopifyã‹ã‚‰æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                var orders = await shopifyService.GetOrdersAsync(targetDate, targetDate.AddDays(1));

                // 2. å•†å“åˆ¥é›†è¨ˆã‚’å®Ÿè¡Œ
                await analyticsService.AggregateProductSalesAsync(orders, targetDate);

                // 3. æœˆæ¬¡é›†è¨ˆã‚’æ›´æ–°
                if (targetDate.Day == DateTime.DaysInMonth(targetDate.Year, targetDate.Month))
                {
                    await analyticsService.UpdateMonthlyAggregationAsync(targetDate);
                }

                // 4. å‰å¹´åŒæœˆæ¯”ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°
                await analyticsService.UpdateYearOverYearCacheAsync(targetDate);

                _logger.LogInformation($"ãƒ‡ãƒ¼ã‚¿é›†è¨ˆå®Œäº†: {targetDate:yyyy-MM-dd}");

                // 24æ™‚é–“å¾…æ©Ÿ
                await Task.Delay(TimeSpan.FromHours(24), stoppingToken);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "ãƒ‡ãƒ¼ã‚¿é›†è¨ˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
                await Task.Delay(TimeSpan.FromMinutes(30), stoppingToken);
            }
        }
    }
}
```

### 6.2 Shopify APIé€£æº

```csharp
// Services/ShopifyService.cs
public class ShopifyService : IShopifyService
{
    private readonly HttpClient _httpClient;
    private readonly IConfiguration _configuration;

    public async Task<List<ShopifyOrder>> GetOrdersAsync(DateTime startDate, DateTime endDate)
    {
        var query = $@"
        {{
          orders(
            first: 250
            query: ""created_at:>={startDate:yyyy-MM-dd} AND created_at:<{endDate:yyyy-MM-dd}""
            sortKey: CREATED_AT
          ) {{
            edges {{
              node {{
                id
                createdAt
                totalPriceSet {{
                  shopMoney {{
                    amount
                    currencyCode
                  }}
                }}
                lineItems(first: 100) {{
                  edges {{
                    node {{
                      id
                      product {{
                        id
                        title
                        productType
                        vendor
                      }}
                      quantity
                      originalTotalSet {{
                        shopMoney {{
                          amount
                        }}
                      }}
                    }}
                  }}
                }}
              }}
            }}
            pageInfo {{
              hasNextPage
              endCursor
            }}
          }}
        }}";

        var response = await ExecuteGraphQLQuery(query);
        return ParseOrdersResponse(response);
    }

    private async Task<string> ExecuteGraphQLQuery(string query)
    {
        var shopifyUrl = _configuration["Shopify:AdminApiUrl"];
        var accessToken = _configuration["Shopify:AccessToken"];

        var request = new HttpRequestMessage(HttpMethod.Post, shopifyUrl)
        {
            Headers = { { "X-Shopify-Access-Token", accessToken } },
            Content = new StringContent(
                JsonSerializer.Serialize(new { query }),
                Encoding.UTF8,
                "application/json"
            )
        };

        var response = await _httpClient.SendAsync(request);
        response.EnsureSuccessStatusCode();
        
        return await response.Content.ReadAsStringAsync();
    }
}
```

## ğŸš€ 7. å®Ÿè£…è¨ˆç”»

### 7.1 Phase 1: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰åŸºç›¤æ§‹ç¯‰ï¼ˆ1é€±é–“ï¼‰
- [ ] .NET Web APIãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
- [ ] PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
- [ ] Entity Framework Coreè¨­å®š
- [ ] åŸºæœ¬çš„ãªCRUDæ“ä½œå®Ÿè£…
- [ ] Shopify APIé€£æºåŸºç›¤å®Ÿè£…

### 7.2 Phase 2: ãƒ‡ãƒ¼ã‚¿é›†è¨ˆæ©Ÿèƒ½å®Ÿè£…ï¼ˆ1é€±é–“ï¼‰
- [ ] æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿é›†è¨ˆãƒãƒƒãƒå‡¦ç†
- [ ] æœˆæ¬¡é›†è¨ˆå‡¦ç†
- [ ] å‰å¹´åŒæœˆæ¯”è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½
- [ ] ãƒ­ã‚°æ©Ÿèƒ½ãƒ»ç›£è¦–è¨­å®š

### 7.3 Phase 3: APIå®Ÿè£…ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é€£æºï¼ˆ1é€±é–“ï¼‰
- [ ] YearOverYearControllerã®å®Ÿè£…
- [ ] AnalyticsServiceã®å®Ÿè£…
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®APIé€£æºä¿®æ­£
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ”¹å–„
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 7.4 Phase 4: ãƒ†ã‚¹ãƒˆã¨æœ€é©åŒ–ï¼ˆ1é€±é–“ï¼‰
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè£…
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™

## ğŸ“‹ 8. æŠ€è¡“çš„è€ƒæ…®äº‹é …

### 8.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥**: æ—¥ä»˜ãƒ»å•†å“IDã§ã®è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥**: å‰å¹´åŒæœˆæ¯”ãƒ‡ãƒ¼ã‚¿ã®äº‹å‰è¨ˆç®—
- **ãƒãƒƒãƒå‡¦ç†**: å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®åŠ¹ç‡çš„ãªé›†è¨ˆ
- **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³**: å¤§é‡å•†å“ã¸ã®å¯¾å¿œ

### 8.2 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **Shopify APIãƒ¬ãƒ¼ãƒˆåˆ¶é™**: æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ãƒªãƒˆãƒ©ã‚¤
- **ãƒ‡ãƒ¼ã‚¿ä¸æ•´åˆ**: è‡ªå‹•ä¿®å¾©æ©Ÿèƒ½
- **éƒ¨åˆ†çš„å¤±æ•—**: ç¶™ç¶šå¯èƒ½ãªå‡¦ç†è¨­è¨ˆ
- **ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ**: å¤±æ•—æ™‚ã®è‡ªå‹•é€šçŸ¥

### 8.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **APIèªè¨¼**: JWTãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹èªè¨¼
- **ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–**: æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–ä¿å­˜
- **å…¥åŠ›å€¤æ¤œè¨¼**: SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–
- **ç›£æŸ»ãƒ­ã‚°**: å…¨æ“ä½œã®è¿½è·¡å¯èƒ½æ€§

## ğŸ¯ 9. å—ã‘å…¥ã‚Œæ¡ä»¶

### 9.1 æ©Ÿèƒ½è¦ä»¶
- [ ] 2å¹´é–“ã®æœˆåˆ¥å£²ä¸Šæ¯”è¼ƒãŒæ­£ç¢ºã«è¡¨ç¤ºã§ãã‚‹
- [ ] æˆé•·ç‡è¨ˆç®—ãŒæ­£ç¢ºã§ã‚ã‚‹ï¼ˆå°æ•°ç‚¹ç¬¬1ä½ã¾ã§ï¼‰
- [ ] å•†å“æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] CSV/Excelå‡ºåŠ›ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] 1000å•†å“ä»¥ä¸Šã§ã‚‚2ç§’ä»¥å†…ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™

### 9.2 éæ©Ÿèƒ½è¦ä»¶
- [ ] 99.9%ä»¥ä¸Šã®ç¨¼åƒç‡ã‚’ç¶­æŒã™ã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã®é…å»¶ã¯24æ™‚é–“ä»¥å†…
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ãŒãªã„
- [ ] åŒæ™‚ã‚¢ã‚¯ã‚»ã‚¹100ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ã§å¯¾å¿œ

### 9.3 é‹ç”¨è¦ä»¶
- [ ] ãƒãƒƒãƒå‡¦ç†ã®å¤±æ•—ã‚’è‡ªå‹•æ¤œçŸ¥ãƒ»é€šçŸ¥
- [ ] ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®å®šæœŸãƒã‚§ãƒƒã‚¯
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- [ ] éšœå®³æ™‚ã®è‡ªå‹•å¾©æ—§æ©Ÿèƒ½

## ğŸ“ˆ 10. æˆåŠŸæŒ‡æ¨™ï¼ˆKPIï¼‰

### 10.1 æŠ€è¡“KPI
- **API ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“**: å¹³å‡1.5ç§’ä»¥å†…
- **ãƒ‡ãƒ¼ã‚¿ç²¾åº¦**: 99.9%ä»¥ä¸Š
- **ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒç‡**: 99.9%ä»¥ä¸Š
- **ãƒãƒƒãƒå‡¦ç†æˆåŠŸç‡**: 99.5%ä»¥ä¸Š

### 10.2 ãƒ“ã‚¸ãƒã‚¹KPI
- **æ©Ÿèƒ½åˆ©ç”¨ç‡**: æœˆæ¬¡80%ä»¥ä¸Š
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦**: 4.5/5.0ä»¥ä¸Š
- **åˆ†æç²¾åº¦**: äºˆæ¸¬ã¨å®Ÿç¸¾ã®å·®ç•°10%ä»¥å†…
- **æ„æ€æ±ºå®šåŠ¹ç‡**: åˆ†ææ™‚é–“50%çŸ­ç¸®

## ğŸ’¡ 11. çµè«–ã¨æ¨å¥¨äº‹é …

### 11.1 å®Ÿè£…æ¨å¥¨ç†ç”±
1. **æŠ€è¡“çš„ã‚·ãƒ³ãƒ—ãƒ«ã•**: ä»–æ©Ÿèƒ½ã®åŸºç›¤ã¨ãªã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¢ºç«‹
2. **ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤**: ç›´æ¥çš„ãªå£²ä¸Šåˆ†æã«ã‚ˆã‚‹é«˜ã„åˆ©ç”¨ä¾¡å€¤
3. **æ‹¡å¼µæ€§**: ä»–ã®å•†å“åˆ†ææ©Ÿèƒ½ã¸ã®å¿œç”¨å¯èƒ½
4. **ãƒªã‚¹ã‚¯**: æœ€ã‚‚å®Ÿè£…ãƒªã‚¹ã‚¯ãŒä½ã„

### 11.2 æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
1. **å³åº§ã«é–‹å§‹**: å‰å¹´åŒæœˆæ¯”æ©Ÿèƒ½ã‹ã‚‰å®Ÿè£…é–‹å§‹
2. **åŸºç›¤ç¢ºç«‹**: ã“ã®æ©Ÿèƒ½ã§æŠ€è¡“åŸºç›¤ã‚’å®Œæˆ
3. **æ®µéšçš„æ‹¡å¼µ**: æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä»–æ©Ÿèƒ½ã«é©ç”¨
4. **ç¶™ç¶šçš„æ”¹å–„**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«åŸºã¥ãæ©Ÿèƒ½å‘ä¸Š

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã§é«˜é€Ÿãªå‰å¹´åŒæœˆæ¯”åˆ†ææ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®æˆåŠŸåŸºç›¤ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

## âš ï¸ 3. Shopify ã‚¢ãƒ—ãƒªåˆ†é¡ã¨é…å¸ƒåˆ¶ç´„ï¼ˆé‡è¦æ›´æ–°ï¼‰

### 3.1 ç¾åœ¨ã®Shopifyã‚¢ãƒ—ãƒªåˆ†é¡ï¼ˆ2025å¹´ç¢ºèªæ¸ˆã¿ï¼‰

#### **æ­£ç¢ºãªã‚¢ãƒ—ãƒªã‚¿ã‚¤ãƒ—åˆ†é¡**
| ã‚¢ãƒ—ãƒªã‚¿ã‚¤ãƒ— | ä½œæˆå ´æ‰€ | é…å¸ƒç¯„å›² | å¯©æŸ» | read_all_orders | æ¨å¥¨åº¦ |
|-------------|----------|----------|------|-----------------|--------|
| **Public Apps** | Partner Dashboard | è¤‡æ•°ã‚¹ãƒˆã‚¢ï¼ˆç„¡åˆ¶é™ï¼‰ | å¿…è¦ | ç”³è«‹ãƒ»å¯©æŸ»å¿…è¦ | â­ |
| **Custom Apps** | Partner Dashboard | å˜ä¸€ã‚¹ãƒˆã‚¢ï¼ˆPlusçµ„ç¹”å†…ã¯è¤‡æ•°å¯ï¼‰ | ä¸è¦ | è‡ªå‹•ä»˜ä¸ | â­â­â­ |
| **Admin Custom Apps** | Shopify Admin | å˜ä¸€ã‚¹ãƒˆã‚¢ | ä¸è¦ | è‡ªå‹•ä»˜ä¸ | â­â­ |

#### **é‡è¦ãªäº‹å®Ÿç¢ºèª**
```typescript
// é‡è¦ï¼šPrivate Appsã¯2022å¹´1æœˆã«å»ƒæ­¢æ¸ˆã¿
interface ShopifyAppTypeHistory {
  private_apps: {
    status: 'DEPRECATED';
    deprecated_date: '2022-01-01';
    migration_date: '2023-01-20';
    migrated_to: 'Custom Apps';
  };
  
  current_types: ['Public Apps', 'Custom Apps', 'Admin Custom Apps'];
  // ã€ŒPrivate Appã€ã¨å‘¼ã°ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯å®Ÿéš›ã«ã¯ã€ŒCustom Appsã€
}
```

### 3.2 ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ—ãƒªé…å¸ƒã®æŠ€è¡“çš„åˆ¶ç´„

#### **é‡å¤§ãªåˆ¶ç´„äº‹é …**
```typescript
interface CustomAppLimitations {
  app_creation: {
    method: 'Manual only (Partner Dashboard)';
    automation_api: 'NOT AVAILABLE';
    per_customer_creation: 'Required manually';
  };
  
  installation_link: {
    generation: 'OAuth 2.0 dynamic generation possible';
    prerequisite: 'Existing app (API Key/Secret) required';
    format: 'https://{shop}.myshopify.com/admin/oauth/authorize?client_id={api_key}&scope={scopes}&redirect_uri={redirect_uri}&state={nonce}';
  };
  
  multi_customer_distribution: {
    single_custom_app: 'Single store only';
    multiple_customers: 'Requires separate Custom App per customer';
    plus_organization: 'Multiple stores within same Plus org allowed';
  };
}
```

#### **å®Ÿè£…å¯èƒ½ãªè‡ªå‹•åŒ–ç¯„å›²**
```typescript
// å¯èƒ½ãªè‡ªå‹•åŒ–
interface PossibleAutomation {
  oauth_link_generation: 'Fully automatable';
  installation_process: 'Merchant interaction required';
  app_configuration: 'Automatable via API after installation';
}

// ä¸å¯èƒ½ãªè‡ªå‹•åŒ–
interface ImpossibleAutomation {
  custom_app_creation: 'Manual Partner Dashboard operation required';
  bulk_app_distribution: 'No API for Custom App creation';
  silent_installation: 'Merchant consent required by Shopify policy';
}
```

### 3.3 è¤‡æ•°é¡§å®¢é…å¸ƒã®å®Ÿè£…æˆ¦ç•¥

#### **æˆ¦ç•¥A: ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆ Custom Appï¼ˆæ¨å¥¨ï¼‰**
```csharp
// åŒä¸€ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ãƒ»è¤‡æ•°Custom Appç®¡ç†
public class MultiTenantCustomAppManager
{
    public class CustomAppConfig
    {
        public string CustomerId { get; set; }
        public string ShopDomain { get; set; }
        public string ApiKey { get; set; }        // é¡§å®¢åˆ¥Custom App
        public string ApiSecret { get; set; }    // é¡§å®¢åˆ¥Custom App
        public string AccessToken { get; set; }  // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œå–å¾—
    }
    
    // é¡§å®¢åˆ¥è¨­å®šç®¡ç†
    public Dictionary<string, CustomAppConfig> CustomerConfigs { get; set; }
    
    // å‹•çš„ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒªãƒ³ã‚¯ç”Ÿæˆ
    public string GenerateInstallationLink(string customerId, string shopDomain)
    {
        var config = CustomerConfigs[customerId];
        var scopes = "read_orders,read_products,read_customers";
        var redirectUri = $"https://our-backend.com/oauth/callback/{customerId}";
        var nonce = GenerateSecureNonce();
        
        return $"https://{shopDomain}.myshopify.com/admin/oauth/authorize" +
               $"?client_id={config.ApiKey}" +
               $"&scope={scopes}" +
               $"&redirect_uri={redirectUri}" +
               $"&state={nonce}";
    }
}
```

#### **æˆ¦ç•¥B: Plusçµ„ç¹”æ´»ç”¨ï¼ˆå¤§ä¼æ¥­é¡§å®¢å‘ã‘ï¼‰**
```typescript
interface PlusOrganizationStrategy {
  target_customers: 'Enterprise customers with Shopify Plus';
  distribution_scope: 'Multiple stores within same Plus organization';
  setup_process: 'Contact Shopify support for multi-store enablement';
  advantages: ['Single Custom App for multiple stores', 'Simplified management'];
  limitations: ['Plus customers only', 'Shopify approval required'];
}
```

### 3.4 ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒªãƒ³ã‚¯è‡ªå‹•ç”Ÿæˆå®Ÿè£…

#### **OAuth 2.0ãƒ•ãƒ­ãƒ¼è‡ªå‹•åŒ–**
```csharp
public class ShopifyOAuthService
{
    public async Task<string> HandleOAuthCallback(string customerId, string code, string shop)
    {
        var config = GetCustomerConfig(customerId);
        
        // Step 1: Exchange authorization code for access token
        var tokenRequest = new
        {
            client_id = config.ApiKey,
            client_secret = config.ApiSecret,
            code = code
        };
        
        var response = await HttpClient.PostAsync(
            $"https://{shop}.myshopify.com/admin/oauth/access_token",
            JsonContent.Create(tokenRequest)
        );
        
        var tokenResponse = await response.Content.ReadFromJsonAsync<TokenResponse>();
        
        // Step 2: Store access token for customer
        await StoreAccessToken(customerId, shop, tokenResponse.AccessToken);
        
        return tokenResponse.AccessToken;
    }
    
    public async Task<bool> ValidateInstallation(string customerId, string shop)
    {
        var config = GetCustomerConfig(customerId);
        // Shopify API call to verify app installation
        return await VerifyAppInstalled(config.AccessToken, shop);
    }
}
```

### 3.5 å®Ÿè£…è¨ˆç”»ã¸ã®å½±éŸ¿

#### **ä¿®æ­£ã•ã‚ŒãŸå®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**
```typescript
interface RevisedImplementationPlan {
  phase_0: {
    title: 'Customer Onboarding Setup';
    duration: '1 week';
    tasks: [
      'Partner Dashboard: Manual Custom App creation per customer',
      'OAuth configuration and callback endpoint setup',
      'Customer-specific configuration database design'
    ];
  };
  
  phase_1: {
    title: 'Automated Installation System';
    duration: '2 weeks';
    tasks: [
      'OAuth link generation API implementation',
      'Installation callback handling',
      'Customer configuration management system'
    ];
  };
  
  scaling_strategy: {
    initial: 'Manual Custom App creation (acceptable for early customers)';
    growth: 'Standardized process with customer self-service portal';
    enterprise: 'Plus organization multi-store approach';
  };
}
```

ã“ã®åˆ¶ç´„ã‚’è¸ã¾ãˆã‚‹ã¨ã€**çœŸã®è‡ªå‹•åŒ–ã¯æŠ€è¡“çš„ã«ä¸å¯èƒ½**ã§ã™ãŒã€OAuthéƒ¨åˆ†ã®è‡ªå‹•åŒ–ã«ã‚ˆã‚Šé‹ç”¨è² è·ã¯å¤§å¹…ã«è»½æ¸›ã§ãã¾ã™ã€‚ 