# EC Ranger インストール〜アンインストール テスト計画書

作成日: 2025年8月5日  
作成者: Kenji（AI開発チーム）

## 概要
福田さんが実施するエンドツーエンドテストの計画書です。画面操作とデータベースの状態を確認しながら、インストールからアンインストールまでの全フローをテストします。

## テスト環境
- **Shopifyテストストア**: パートナーダッシュボードから作成
- **アプリURL**: https://ecrangerapp.azurewebsites.net
- **データベース**: Azure SQL Database（テスト環境）
- **ブラウザ**: Chrome最新版

## テスト手順

### 1. 事前準備（08:30〜09:00）

#### 1.1 テスト環境確認
- [ ] Shopifyパートナーダッシュボードにログイン
- [ ] テストストアが作成されていることを確認
- [ ] アプリのステータスが「開発中」であることを確認

#### 1.2 データベース初期状態確認
```sql
-- 実行するSQL
SELECT COUNT(*) FROM Stores;
SELECT COUNT(*) FROM ShopifyOrders;
SELECT COUNT(*) FROM DormantCustomers;
```
- [ ] 全テーブルが空であることを確認

#### 1.3 ログ監視準備
- [ ] Azure Portal > Application Insights を開く
- [ ] Live Metricsを開始

### 2. インストールテスト（09:00〜10:30）

#### 2.1 アプリインストール開始
1. **Shopifyパートナーダッシュボード操作**
   - [ ] 開発ストアを選択
   - [ ] アプリ管理 > 「EC Ranger」を検索
   - [ ] 「アプリをインストール」をクリック
   - [ ] スクリーンショット撮影: install_start.png

2. **権限承認画面**
   - [ ] 表示される権限一覧を確認
     - 顧客データの読み取り
     - 注文データの読み取り
     - 店舗情報の読み取り
   - [ ] 「アプリをインストール」ボタンをクリック
   - [ ] スクリーンショット撮影: permission_screen.png

#### 2.2 OAuth認証フロー確認
- [ ] リダイレクトURL確認（/api/auth/callback）
- [ ] エラーが発生していないことを確認
- [ ] Application Insightsでログ確認

#### 2.3 初期画面表示確認
- [ ] ダッシュボードが表示されることを確認
- [ ] 「EC Ranger」ロゴが表示されることを確認
- [ ] メニューが正しく表示されることを確認
- [ ] スクリーンショット撮影: dashboard_initial.png

#### 2.4 データベース状態確認
```sql
-- ストア情報確認
SELECT * FROM Stores WHERE Domain = 'テストストア名.myshopify.com';
```
- [ ] ストア情報が登録されていることを確認
- [ ] AccessTokenが保存されていることを確認
- [ ] CreatedAtが現在時刻であることを確認

### 3. データ同期テスト（10:30〜11:30）

#### 3.1 CSV アップロード機能
1. **テストデータ準備**
   - [ ] サンプルCSVファイルを用意（100件程度）

2. **アップロード実行**
   - [ ] 設定 > データインポートを開く
   - [ ] CSVファイルを選択
   - [ ] アップロードボタンをクリック
   - [ ] スクリーンショット撮影: csv_upload.png

3. **進捗表示確認**
   - [ ] プログレスバーが表示されることを確認
   - [ ] 処理件数が表示されることを確認
   - [ ] 完了メッセージが表示されることを確認

#### 3.2 データベース確認
```sql
-- インポートデータ確認
SELECT COUNT(*) FROM ShopifyOrders WHERE StoreId = 'ストアID';
SELECT TOP 10 * FROM ShopifyOrders WHERE StoreId = 'ストアID';
```
- [ ] データが正しくインポートされていることを確認

### 4. 機能動作テスト（13:00〜14:30）

#### 4.1 休眠顧客分析
- [ ] 休眠顧客分析ページを開く
- [ ] データが表示されることを確認
- [ ] フィルター機能が動作することを確認
- [ ] スクリーンショット撮影: dormant_analysis.png

#### 4.2 販売分析ダッシュボード
- [ ] 販売分析ページを開く
- [ ] グラフが表示されることを確認
- [ ] 期間選択が動作することを確認
- [ ] スクリーンショット撮影: sales_dashboard.png

#### 4.3 パフォーマンス確認
- [ ] 各ページの読み込み時間を計測（3秒以内）
- [ ] メモリ使用量を確認

### 5. アンインストールテスト（14:30〜15:30）

#### 5.1 アンインストール実行
1. **Shopify管理画面操作**
   - [ ] 設定 > アプリと販売チャネル
   - [ ] EC Rangerの「削除」をクリック
   - [ ] 確認ダイアログで「削除」をクリック
   - [ ] スクリーンショット撮影: uninstall_confirm.png

#### 5.2 GDPR Webhook確認
- [ ] Application InsightsでWebhook受信ログ確認
- [ ] shop/redactが受信されたことを確認

#### 5.3 データベース確認（即時）
```sql
-- ストア状態確認
SELECT IsActive, UninstalledAt FROM Stores WHERE Domain = 'テストストア名.myshopify.com';
```
- [ ] IsActiveがfalseになっていることを確認
- [ ] UninstalledAtが設定されていることを確認

#### 5.4 アプリアクセス確認
- [ ] アプリURLに直接アクセス
- [ ] 適切なエラーメッセージが表示されることを確認
- [ ] スクリーンショット撮影: uninstalled_error.png

### 6. データ削除確認（48時間後）

#### 6.1 スケジュールジョブ確認
- [ ] DataCleanupServiceのログ確認
- [ ] 削除予定日時の確認

#### 6.2 データ削除確認（テスト用に手動実行）
```sql
-- 削除前のデータ数確認
SELECT COUNT(*) FROM ShopifyOrders WHERE StoreId = 'ストアID';
SELECT COUNT(*) FROM DormantCustomers WHERE StoreId = 'ストアID';

-- DataCleanupService手動実行後
-- 削除後のデータ数確認（0件になっているはず）
```

## 問題報告フォーマット

発見した問題は以下の形式で報告してください：

```markdown
### 問題 #1: [問題のタイトル]
**発生箇所**: インストール/データ同期/機能/アンインストール
**重要度**: 高/中/低
**再現手順**:
1. 
2. 
3. 

**期待される動作**:

**実際の動作**:

**スクリーンショット**: 

**エラーログ**:
```

## チェックポイント

### 必須確認項目
- [ ] インストールが正常に完了する
- [ ] OAuth認証が正しく動作する
- [ ] データインポートが動作する
- [ ] 主要機能が表示・動作する
- [ ] アンインストールが正常に完了する
- [ ] GDPR Webhookが受信される
- [ ] データ削除スケジュールが設定される

### パフォーマンス基準
- [ ] 各ページ読み込み: 3秒以内
- [ ] CSVインポート: 1000件/分以上
- [ ] メモリ使用量: 500MB以下

## テスト完了基準

1. 全チェック項目が完了していること
2. 重要度「高」の問題が0件であること
3. スクリーンショットが全て撮影されていること
4. テスト結果レポートが作成されていること

---

以上のテスト計画に基づいて、福田さんが主導でテストを実施し、発見した問題をKenjiに報告してください。
その後、YukiさんとTakashiさんに修正を依頼する流れで進めましょう。