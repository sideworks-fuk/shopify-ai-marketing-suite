# 🔧 技術的負債改善ガイド

## 📋 目次

1. [技術的負債分析レポート](#技術的負債分析レポート)
2. [重複ファイル解消手順](#重複ファイル解消手順)
3. [大規模コンポーネント分割手順](#大規模コンポーネント分割手順)
4. [ハードコードデータ分離手順](#ハードコードデータ分離手順)
5. [パフォーマンス最適化手順](#パフォーマンス最適化手順)
6. [ベストプラクティス](#ベストプラクティス)
7. [優先対応タスク](#優先対応タスク)

---

## 📊 技術的負債分析レポート

### 概要
詳細な技術的負債分析を実施し、Critical 0件、High 5件、Medium 8件、Low 6件の問題を特定しました。

**📋 詳細レポート**: [TECHNICAL_DEBT_ANALYSIS.md](./TECHNICAL_DEBT_ANALYSIS.md)

### 緊急対応が必要な事項（High Priority）
1. **データ層の抽象化不足** - API切り替え準備
2. **重複したKPIカード実装** - 共通コンポーネント化
3. **型定義の重複と不整合** - 型安全性向上
4. **統一されていないエラー処理** - エラーハンドリング統一

### リファクタリング推奨順序
1. **Phase 1**: 基盤整備（データサービス層・型定義・エラーハンドリング）
2. **Phase 2**: コンポーネント最適化（共通化・状態管理・パフォーマンス）
3. **Phase 3**: 品質向上（テスト・ドキュメント・CI/CD）

---

## 🔴 重複ファイル解消手順

### 現状
- UI部品は `src/components/ui/` に集約済み。
- インポートパスは `@/components/ui/` で統一。
- 旧来の重複ディレクトリ・ファイルは削除済み。

### チェックリスト
- [x] 重複ファイルリストの作成
- [x] インポートパスの調査・修正
- [x] 重複ディレクトリの削除
- [x] ビルドテストの成功
- [ ] 本番環境でのテスト

---

## 🟡 大規模コンポーネント分割手順

### 現状
- `src/components/dashboards/` 配下でサブディレクトリ分割（`customers/`, `sales/`, `dormant/`等）を推進。
- 1000行超の大規模ファイルは段階的に分割中。
- サブコンポーネント・カスタムフック（例: `useCustomerTable.ts`）を抽出。

### チェックリスト
- [x] 分割計画の策定
- [x] カスタムフックの抽出
- [x] サブコンポーネントの作成
- [~] メインコンポーネントの簡素化
- [~] 型定義の整備
- [ ] テストの作成

---

## 🟡 ハードコードデータ分離手順

### 現状
- モックデータは `src/data/mock/customerData.ts` に集約。
- 型定義も同ファイルで一元管理。
- DataService/ShopifyAPIで開発/本番切替が可能。

### チェックリスト
- [x] モックデータディレクトリの作成
- [x] モックデータファイルの作成
- [x] データプロバイダーの実装
- [x] 環境変数の設定
- [ ] 開発/本番環境での動作確認

---

## 🟢 パフォーマンス最適化手順

### 現状
- 動的インポート（Next.js dynamic）・React.memo等を積極活用。
- サブコンポーネント単位でメモ化・useMemo/useCallbackを適用。

### チェックリスト
- [x] React.memoの適用
- [x] useMemo / useCallbackの適用
- [x] 動的インポートの追加
- [ ] 大規模リストの仮想化

---

## 📋 ベストプラクティス

- UI部品は `src/components/ui/` に集約し、再利用性・保守性を高める
- サブディレクトリ分割・型安全性・モックデータ管理を徹底
- コードレビュー時は重複・ハードコード・粒度・パフォーマンスを重点確認
- DataService/ShopifyAPIの役割分担を明確化し、API/データ層の責務を分離

---

## 🚨 優先対応タスク

### 即座に対応（今週中）
1. **DataService完全実装**
   ```typescript
   // services/dataService.ts
   interface IDataService {
     getCustomers(filters: CustomerFilters): Promise<CustomerResponse>;
     // 他のメソッド
   }
   ```

2. **共通KPICard作成**
   ```typescript
   // components/common/KPICard.tsx
   interface KPICardProps {
     title: string;
     value: string | number;
     change?: ChangeData;
     // 他のプロパティ
   }
   ```

### API実装前に対応（来週）
1. **型定義統一**
   - `types/models/` ディレクトリ作成
   - 重複型定義の削除
   - strict mode有効化

2. **エラーハンドリング統一**
   - ErrorBoundary実装
   - グローバルエラーハンドラー

### 段階的対応（今月中）
1. **状態管理最適化**
   - Zustand導入検討
   - Props Drilling解消

2. **パフォーマンス改善**
   - 仮想スクロール導入
   - メモ化強化

---

*最終更新: 2025年5月25日（技術的負債分析レポート連携）*
*作成者: AI Assistant*

## 🚀 実行チェックリスト

### 重複ファイル解消完了チェック
- [x] 重複ファイルリストの作成
- [x] インポートパスの調査・修正
- [x] 重複ディレクトリの削除
- [x] ビルドテストの成功
- [ ] 本番環境でのテスト

### コンポーネント分割完了チェック
- [x] 分割計画の策定
- [x] カスタムフックの抽出
- [x] サブコンポーネントの作成
- [~] メインコンポーネントの簡素化
- [~] 型定義の整備
- [ ] テストの作成

### データ分離完了チェック
- [x] モックデータディレクトリの作成
- [x] モックデータファイルの作成
- [x] データプロバイダーの実装
- [x] 環境変数の設定
- [ ] 開発/本番環境での動作確認

### 技術的負債対応チェック（新規）
- [ ] DataService完全実装
- [ ] 共通KPICard作成
- [ ] 型定義統一（types/models/作成）
- [ ] ErrorBoundary実装
- [ ] 状態管理最適化（Zustand検討）

---

*最終更新: 2025年5月25日*
*作成者: AI Assistant*
*次回レビュー: 月次* 