# Shopify OAuth インストールページ確認手順

**作成日**: 2025年7月29日  
**作成者**: ケンジ（Claude）  
**対象**: 開発・テスト担当者

## 1. 事前準備

### 1.1 環境起動
```bash
# バックエンド起動
cd backend/ShopifyAnalyticsApi
dotnet run

# フロントエンド起動
cd frontend
npm run dev
```

### 1.2 HTTPS証明書の承認
1. ブラウザで https://localhost:7088/swagger にアクセス
2. 証明書の警告を承認
3. Swagger UIが表示されることを確認

## 2. インストールページの確認

### 2.1 ページアクセス
```
URL: http://localhost:3000/install
```

### 2.2 UI確認項目

#### Tailwind版（デフォルト）
- [ ] ページタイトル「Shopify AI Marketing Suite」が表示される
- [ ] サブタイトル「ストアと連携して分析を開始」が表示される
- [ ] ストアドメイン入力フィールドが表示される
- [ ] 「.myshopify.com」のサフィックスが表示される
- [ ] 「アプリをインストール」ボタンが表示される
- [ ] レスポンシブデザインが機能する（モバイル/タブレット/デスクトップ）

#### Polaris版（URLパラメータで切り替え）
```
URL: http://localhost:3000/install?version=polaris
```
- [ ] Shopify Polarisデザインが適用される
- [ ] カード型レイアウトが表示される
- [ ] Polarisのボタンスタイルが適用される
- [ ] エラーメッセージがBannerコンポーネントで表示される

### 2.3 機能確認項目

#### 入力検証
1. **有効なストアドメイン**
   - 入力: `test-store`
   - 期待結果: エラーなし、ボタンが有効

2. **無効なストアドメイン（スペース含む）**
   - 入力: `test store`
   - 期待結果: エラーメッセージ「ストアドメインに無効な文字が含まれています」

3. **無効なストアドメイン（特殊文字）**
   - 入力: `test@store`
   - 期待結果: エラーメッセージ表示

4. **空のストアドメイン**
   - 入力: （空欄）
   - 期待結果: ボタンが無効化される

#### 自動補完機能
- [ ] 「test」と入力すると「test.myshopify.com」として処理される
- [ ] 「test.myshopify.com」と入力してもそのまま処理される
- [ ] 重複して「.myshopify.com」が追加されない

## 3. OAuth フロー確認

### 3.1 インストール開始
1. 有効なストアドメインを入力（例: `test-store`）
2. 「アプリをインストール」ボタンをクリック
3. ローディング状態の表示確認

### 3.2 リダイレクト確認
開発者ツールのネットワークタブで確認：
- [ ] `/api/shopify/install?shop=fuk-dev1.myshopify.com` へのリクエスト
- [ ] 302リダイレクトレスポンス
- [ ] Shopify認証URLへのリダイレクト

### 3.3 エラーハンドリング
1. **バックエンドAPI停止時**
   - バックエンドを停止した状態でインストールボタンをクリック
   - 期待結果: エラーメッセージ「インストールに失敗しました」

2. **ネットワークエラー**
   - 開発者ツールでネットワークをオフラインに設定
   - 期待結果: 適切なエラーメッセージ表示

## 4. アクセシビリティ確認

### 4.1 キーボード操作
- [ ] Tabキーでフォーカス移動が可能
- [ ] Enterキーでボタンクリックが可能
- [ ] エラーメッセージがスクリーンリーダーで読み上げられる

### 4.2 視覚的確認
- [ ] 十分なコントラスト比
- [ ] フォーカスインジケーターが明確
- [ ] エラーメッセージが視覚的に判別可能（赤色など）

## 5. パフォーマンス確認

### 5.1 ページロード時間
- [ ] 初回ロード: 3秒以内
- [ ] キャッシュ済み: 1秒以内

### 5.2 インタラクション
- [ ] 入力時の遅延なし
- [ ] ボタンクリック時の即座の反応

## 6. ブラウザ互換性

以下のブラウザで動作確認：
- [ ] Chrome（最新版）
- [ ] Firefox（最新版）
- [ ] Safari（最新版）
- [ ] Edge（最新版）

## 7. セキュリティ確認

### 7.1 XSS対策
- [ ] 入力値のサニタイゼーション
- [ ] HTMLインジェクション不可

### 7.2 CSRF対策
- [ ] State パラメータの生成
- [ ] セッション管理の確認

## 8. トラブルシューティング

### よくある問題と対処法

| 問題 | 原因 | 対処法 |
|------|------|--------|
| API接続エラー | バックエンド未起動 | バックエンドを起動 |
| CORS エラー | 設定不備 | appsettings.jsonのCORS設定確認 |
| 404 エラー | ルーティング問題 | Next.jsのルーティング確認 |
| HTTPS エラー | 証明書未承認 | ブラウザで証明書を承認 |

## 9. 確認完了チェックリスト

```
□ Tailwind版の表示確認
□ Polaris版の表示確認
□ 入力検証機能の動作確認
□ OAuth フローの開始確認
□ エラーハンドリングの確認
□ レスポンシブデザインの確認
□ アクセシビリティの確認
□ セキュリティ対策の確認
```

---

**注意**: この手順書は開発環境での確認用です。本番環境では異なる設定が必要になる場合があります。