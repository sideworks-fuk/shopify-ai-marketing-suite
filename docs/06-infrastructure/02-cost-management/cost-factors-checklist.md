# コスト影響要因 チェックリスト

## 1. 環境構成によるコスト影響

### 複数環境の運用
| 環境 | 用途 | 想定コスト倍率 | コスト削減策 |
|------|------|--------------|-------------|
| **開発環境** | 開発・単体テスト | 0.3x | ・夜間/週末自動停止<br>・最小スペック<br>・共有DB |
| **ステージング環境** | 結合テスト・受入テスト | 0.5x | ・本番の50%スペック<br>・定期的な起動/停止 |
| **本番環境** | 実運用 | 1.0x | ・24/365稼働<br>・冗長構成 |
| **DR環境** | 災害対策 | 0.8x | ・別リージョン<br>・コールドスタンバイ |

**想定追加コスト**: 本番環境の約1.6倍（開発0.3 + ステージング0.5 + DR0.8）

### 環境別推奨構成
```yaml
開発環境:
  PostgreSQL: B1s (¥1,435/月)
  Functions: Consumption Plan
  自動停止: 平日19時〜翌9時、土日終日
  実質コスト: 約¥600/月

ステージング環境:
  PostgreSQL: B1ms (¥2,870/月) 
  Functions: Consumption Plan
  稼働時間: テスト実施時のみ（月100時間想定）
  実質コスト: 約¥1,200/月

本番環境:
  PostgreSQL: B2s以上 (¥5,740/月〜)
  Functions: Premium Plan検討
  可用性: 99.9%以上
```

---

## 2. バックアップ・災害対策

### バックアップ戦略による追加コスト

| バックアップ種類 | 保持期間 | 追加コスト/月 | 備考 |
|----------------|---------|-------------|------|
| **PostgreSQL自動バックアップ** | 7日 | ¥0 | 標準機能 |
| **長期保存バックアップ** | 30日 | ¥459 | 32GB × ¥14.336 |
| **geo冗長バックアップ** | 7日 | ¥918 | 2倍の料金 |
| **Blobスナップショット** | 無制限 | ¥27/10GB | 増分料金 |

### ポイントインタイムリストア
- PostgreSQL: 最大35日間（追加料金発生）
- 1日あたり約¥15のストレージコスト

---

## 3. セキュリティ・コンプライアンス

### セキュリティ関連の追加コスト

| サービス/機能 | 月額コスト | 必要性 |
|--------------|-----------|--------|
| **Azure Key Vault** | ¥56/1万操作 | 必須（シークレット管理） |
| **Azure Firewall** | ¥17,472〜 | 大規模時 |
| **DDoS Protection** | ¥336,000 | エンタープライズ向け |
| **VPN Gateway** | ¥5,264〜 | オンプレ接続時 |
| **Private Endpoint** | ¥1,232/個 | セキュア接続 |
| **Log Analytics** | ¥336/GB | 監査ログ長期保存 |

### SSL証明書
- **Let's Encrypt**: ¥0（自動更新設定必要）
- **Azure管理証明書**: ¥9,856/年
- **EV SSL証明書**: ¥50,000〜/年

---

## 4. 監視・運用

### 監視ツールのコスト

| 項目 | データ量/月 | コスト/月 | 備考 |
|------|-----------|----------|------|
| **Application Insights** | 5GB超過分 | ¥336/GB | ログレベル調整重要 |
| **Log Analytics** | 10GB | ¥3,360 | 長期分析用 |
| **メトリクスアラート** | 10個 | ¥112 | 1個¥11.2 |
| **可用性テスト** | 10箇所×5分間隔 | ¥1,120 | Web監視 |

### 外部監視サービス（参考）
- **Datadog**: ¥2,000〜/ホスト
- **New Relic**: ¥10,000〜/月
- **PagerDuty**: ¥3,000〜/月

---

## 5. ネットワーク・データ転送

### 見落としがちなネットワークコスト

| 転送パターン | 料金 | 注意点 |
|------------|------|--------|
| **同一リージョン内** | ¥0 | VNet内は無料 |
| **リージョン間（国内）** | ¥1.12/GB | 東⇔西日本 |
| **可用性ゾーン間** | ¥1.12/GB | 冗長構成時 |
| **インターネット送信** | ¥13.44/GB | 5GB超過分 |
| **VPN接続** | ¥5.6/GB | オンプレ連携 |
| **ExpressRoute** | ¥56,000〜/月 | 専用線接続 |

### CDN利用時
- **Azure CDN Standard**: ¥2.8/GB〜
- **大量配信割引**: 10TB以上で割引適用

---

## 6. 開発・テスト関連

### CI/CD・開発ツール

| サービス | 無料枠 | 超過時料金 |
|---------|-------|-----------|
| **GitHub Actions** | 2,000分/月 | ¥0.9/分 |
| **Azure DevOps** | 5ユーザー | ¥672/ユーザー |
| **Container Registry** | 10GB | ¥5.6/GB/月 |
| **Load Testing** | - | ¥56/仮想ユーザー時 |

### 開発者ツール
- **Visual Studio サブスクリプション**: ¥6,000〜/月
- **JetBrains Tools**: ¥3,000〜/月

---

## 7. ライセンス・サブスクリプション

### ソフトウェアライセンス

| 項目 | コスト | 備考 |
|------|--------|------|
| **Windows Server CAL** | ¥5,000/ユーザー | Windows使用時 |
| **SQL Server** | ¥70,000〜/コア | PostgreSQL代替時 |
| **Redis Enterprise** | ¥50,000〜/月 | 高可用性要件時 |
| **Elastic (ELK)** | ¥10,000〜/月 | ログ分析 |

---

## 8. 予期せぬコスト要因

### トラブル・障害対応
- **緊急スケールアップ**: 通常の3-10倍
- **DDoS攻撃対応**: 帯域幅急増
- **データ漏洩対応**: フォレンジック調査費用

### 規制・コンプライアンス対応
- **GDPR対応**: データ保護責任者雇用
- **監査対応**: ログ長期保存（7年）
- **ペネトレーションテスト**: ¥500,000〜/回

### 為替変動
- **USD建て料金**: 円安で10-20%上昇リスク
- **年間契約**: 為替予約検討

---

## 9. コスト最適化チェックリスト

### 月次レビュー項目
- [ ] 未使用リソースの削除
- [ ] 開発環境の稼働時間確認
- [ ] ログレベルの適正化
- [ ] ストレージの不要データ削除
- [ ] 予約インスタンスの検討
- [ ] タグによるコスト配分確認

### 四半期レビュー項目
- [ ] スケールダウン可能性の検討
- [ ] 新サービス・価格改定の確認
- [ ] 利用パターン分析による最適化
- [ ] 代替サービスの検討

---

## 10. 3年間の総保有コスト（TCO）試算

### 小規模構成（基本）
```
初期費用:
- 環境構築: ¥500,000（人件費）
- 初期ライセンス: ¥100,000

年間運用費:
- Azure利用料: ¥44,160（月¥3,680）
- 運用保守: ¥600,000（0.5人月）
- 監視ツール: ¥120,000

3年間合計: ¥2,652,480
```

### 中規模構成（3環境 + DR）
```
初期費用:
- 環境構築: ¥2,000,000
- セキュリティ診断: ¥500,000

年間運用費:
- Azure利用料: ¥600,000（月¥50,000）
- 運用保守: ¥2,400,000（2人月）
- 監視・セキュリティ: ¥600,000
- ライセンス: ¥300,000

3年間合計: ¥14,200,000
```

---

## まとめ：想定外コストを防ぐための指針

1. **初期見積もりの1.5〜2倍を予算確保**
2. **四半期ごとの利用状況レビュー必須**
3. **タグによるコスト管理の徹底**
4. **自動スケーリングの上限設定**
5. **アラート設定（日次¥5,000、月次¥50,000等）**

---

## 関連ドキュメント

- [コスト監視計画（詳細版）](./cost-monitoring-plan-detailed.md)
- [月次コスト管理テンプレート](./cost-simulation-worksheet.md#月次コスト管理テンプレート)
- [Azureサービス コスト試算ガイド](./azure-cost-estimation-guide.md)
- [Azure価格情報・コストシミュレーション リソース集](./azure-pricing-resources.md) 