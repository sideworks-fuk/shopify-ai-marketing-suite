# 2025-08-18 定例 議事録

## 会議情報
- 会議日時: 2025年8月18日
- 参加者: 小野、浜地、福田

## 要約（1分で把握）
Shopifyアプリ「ECレンジャー」の早期申請を最優先に、課金システムの最小実装と申請要件を確認。
無料プランは1機能に限定。
課金APIは0ドル/1ドルで通し検証を実施し、素材（ロゴ/スクショ/説明文/規約）を並行準備する。

## 事前アジェンダ（配布資料）

- 前回合意事項の確認（サブスク＋無料トライアル、価格候補 $50/$80/$100）
- 進捗アップデート（Backend/DB/Docs/Frontend/OAuth）
- 価格と課金フローの最終確定（価格帯・トライアル日数・MVP・トリガー）
- 技術要件と未完タスク優先付け（GDPR 4種、マイグレーション、本番での開発用ルート遮断、App Listing 素材）
- リスクと対策（Webhook遅延・冪等・429、環境変数不整合）

## 決定事項（重要）
- 無料プランは（無料は1機能に限定）
- 有料プランは全機能（顧客/商品/購買分析）を提供
- 価格帯は $50/$80/$100 の3段階を候補として進行（最終確定は後続）
- 無料トライアルは 7日 or 14日 で検討継続（当日未確定）
- 申請は最小実装で先行し、公開後に拡充する（MVP優先）
- 公開申請の登録料 $19 はアクセスネット側で支払い（アプリラボから実施）
- DBマイグレーション適用計画（各環境）を確定し、適用直後に `tracking.md` を更新

## アクション・担当・期限
- 福田: アンインストール/GDPR 4種Webhook実装・検証、開発ページ本番除外再確認、インストール状態管理API（〜8/14）
- 小野: 価格帯最終決定、決済カード手当て、説明文・素材指示（〜8/13-15）
- 小野: ロゴ/スクショ初稿、サポートメール運用準備（〜8/15）
- 全体: マイグレーション適用と `tracking.md` 更新ルール順守（適用直後に記録）
- ToDo（継続）:
  - 課金APIの実装と検証（無料→有料の流れ確認）
  - 課金テストの実施（$0 または $1 での検証）
  - 規約・プライバシーポリシーのHTML作成とホスティング

## 進捗サマリー（抜粋）
- Backend: 課金API土台実装（`SubscriptionController`/`ShopifySubscriptionService`）、Webhook/GDPR用DBスキーマ追加、ngrok/AllowedOrigins更新
- DB/Docs: `2025-08-13-AddWebhookEventsTable.sql` 追加、`database-migration-tracking.md` 更新、課金技術ガイド一式更新
- Frontend: 本番で開発用ページ除外（`next.config.js`/`middleware.ts`）、`searchParams`/`pathname` ガード追加、初期セットアップUI強化
- OAuth/インストール: リダイレクト・HMAC・SSL 等の恒久対策は完了（再確認のみ）

## 議題と議論メモ
### 1) 価格と課金フローの最終確定
- 価格帯: $50/$80/$100 の3段階（最終決定）
- 無料トライアル日数: 7日/14日（最終決定）
- MVP範囲: 作成URL→承認→Webhook更新→機能解放の最短動線
- 課金トリガー: 初期同期完了時/高機能利用時 などの定義

### 2) 技術要件と未完タスクの優先付け
- 必須: アンインストール/GDPR 4種Webhook 実装・検証
- DBマイグレーション適用状況（Dev/Stg/Prod）と手順確認
- 本番での開発用ルート遮断確認（`middleware.ts` の DEV_PATHS）
- App Listing 素材（ロゴ/スクショ/説明文/サポートメール）準備状況

### 3) 申請プロセス
- 公開アプリ申請には登録料 $19 の支払いが必要
- アクセスネット アプリラボのアカウントから「ECレンジャー」を登録
- 最小実装で申請を先行し、公開後に機能拡充

## 議論ハイライト（文字起こし反映）
- 課金APIの通し検証は最優先。まず 0ドルオーソリで動線確認、必要なら $1 で課金→キャンセルの試験
- トライアル終了後の課金切替、再インストール時の扱いは追加調査（Shopifyドキュメント/コミュニティ）
- 顧客数上限のモニタリングでアップグレード誘導を実装予定
- 本番での開発用ルート遮断は `middleware.ts` の DEV_PATHS を再確認
- 規約/PPは暫定HTMLで可。レビューで修正前提で先行提出

### 4) 技術検討事項
- 無料トライアル終了後の課金処理（自動/手動の境界、キャンセル時の扱い）
- アンインストール後の再インストール時の課金再開/再契約の扱い
- 利用制限（顧客数など）の監視とアップグレード誘導
- Webhook処理の安定性、冪等性、再処理キュー
- Rate limit/429 対応（バックオフ・リトライ）

## 参考資料
- `docs/06-shopify/02-課金システム/` 一式（設計書・技術ガイド・フロー図解・チェックリスト）
- `docs/04-development/database-migration-tracking.md`
- 直近の議事録/ログ: `docs/01-project-management/00_meeting/250812_定例.md`, `docs/worklog/2025/08/`